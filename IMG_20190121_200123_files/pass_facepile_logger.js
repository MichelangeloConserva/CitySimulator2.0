define(["require","exports","tslib","modules/clean/ajax","modules/clean/react/file_viewer/models","modules/clean/react/pass/constants","modules/clean/react/pass/action_timestamps"],function(e,n,t,s,i,r,a){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),s=t.__importStar(s);var o={};o[r.EventTypes.PASS_SHOWN]="pass_shown",o[r.EventTypes.PASS_HOVER]="pass_hover",o[r.EventTypes.PASS_CLICK]="pass_click";var l=(function(){function e(){this.eventToHandlerStack={};for(var e=0,n=[r.EventTypes.PASS_SHOWN,r.EventTypes.PASS_HOVER,r.EventTypes.PASS_CLICK];e<n.length;e++){var t=n[e];this.eventToHandlerStack[t]=[]}}return e.prototype._log=function(e,n,t,r){var l=n?"BROWSE_FILE_FACEPILE":"PREVIEW_PAGE_FACEPILE",c={};if(!n){var _=i.FilePreviewSession.currentSession;r.file_viewer_session_id=_.fileViewerSession.id,r.file_preview_session_id=_.id,c=a.ActionTimestampsTracker.get(_.id)}var p=new Date,u={event_name:o[e],file_ns_id:t.ns_id,file_sjid:t.sjid,origin:l,extra:JSON.stringify(r),action_timestamps:JSON.stringify(c),client_ts:p.getTime()/1e3};s.SilentBackgroundRequest({url:"/log/pass_facepile",data:u})},e.prototype.listenTo=function(e){this._unlistenToTopOfHandlersStack(e),this._pushHandlers(),this._listenToTopOfHandlersStack(e)},e.prototype.unlistenTo=function(e){this._unlistenToTopOfHandlersStack(e),this._popHandlers(),this._listenToTopOfHandlersStack(e)},e.prototype._unlistenToTopOfHandlersStack=function(e){for(var n in this.eventToHandlerStack)if(this.eventToHandlerStack.hasOwnProperty(n)){if(0===this.eventToHandlerStack[n].length)continue;var t=this.eventToHandlerStack[n].slice(-1)[0];e.removeListener(n,t)}},e.prototype._listenToTopOfHandlersStack=function(e){for(var n in this.eventToHandlerStack)if(this.eventToHandlerStack.hasOwnProperty(n)){if(0===this.eventToHandlerStack[n].length)continue;var t=this.eventToHandlerStack[n].slice(-1)[0];e.addListener(n,t)}},e.prototype._pushHandlers=function(){for(var e in this.eventToHandlerStack)if(this.eventToHandlerStack.hasOwnProperty(e)){var n=this._createHandlerFn(e);this.eventToHandlerStack[e].push(n)}},e.prototype._popHandlers=function(){for(var e in this.eventToHandlerStack)this.eventToHandlerStack.hasOwnProperty(e)&&this.eventToHandlerStack[e].pop()},e.prototype._createHandlerFn=function(e){var n=this;return function(t,s,i){n._log(e,t,s,{num_accessors:i.numAccessors,num_current_viewers:i.numCurrentViewers,num_viewers:i.numViewers,num_guests:i.numGuests,num_in_team_editors:i.numInTeamEditors,num_in_team_viewers:i.numInTeamViewers,num_non_team_editors:i.numNonTeamEditors,num_non_team_viewers:i.numNonTeamViewers,can_see_viewer_history:i.canSeeViewerHistory})}},e})();n.passFacepileLogger=new l});
//# sourceMappingURL=pass_facepile_logger.min.js-vfl63MM-I.map