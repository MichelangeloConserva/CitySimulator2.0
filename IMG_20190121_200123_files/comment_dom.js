define(["require","exports","tslib","external/react-dom-factories","modules/clean/referrer_cleansing_redirect"],function(r,e,t,n,i){"use strict";function o(r,e){return void 0!==r&&null!==r?e(r):void 0}Object.defineProperty(e,"__esModule",{value:!0}),n=t.__importStar(n),i=t.__importStar(i);var a=function(r,e,t){void 0===e&&(e=!0),void 0===t&&(t=null);var o=/@\[(?:\s*(?:dbid:)?[^:\[\]]+):(?:[^\[]+)\]/i,a="(?:[-a-zA-Z0-9@:%_+~#=]+[.])+[a-z]{2,6}(?:[:./?#][-a-zA-Z0-9@%_+~&=]+)*(?=[^a-zA-Z0-9_]|$)",s=new RegExp("http://"+a+"|https://"+a+"|www."+a+"|"+a,"i"),l=[o,/\n/];e&&l.push(s);for(var p=RegExp("("+Array.from(l).map(function(r){return r.source}).join("|")+")","gi"),h=[],c=0,f=Array.from(r.split(p));c<f.length;c++){var d=f[c];if(d)if(d.match(o)){var m=d.match(/@\[(\s*(?:dbid:)?[^:\[\]]+):([^\[]+)\]/i),v=m[2].trim();h.push(n.span({className:"comment-mention"},v))}else if(Array.from(l).includes(s)&&d.match(s)){var _=d;_.indexOf("http://")<0&&_.indexOf("https://")<0&&(_="http://"+_);try{_=i.get_redirect_uri(_),h.push(n.a({href:_,target:"_blank",rel:"noopener noreferrer"},d))}catch(r){h.push(d)}}else d.match(/\n/)?h.push(n.br({})):h.push(d)}return u(h,t)};e.convertRawCommentTextToReactDom=a;var u=function(r,e){if(void 0===e&&(e=null),!e)return r;var t=0,n=[];if(e<=0)return r.length>0?"…":r;for(var i=0,a=Array.from(r);i<a.length;i++){var u=a[i];if("object"==typeof u){if(null!=(null!=u.props?u.props.children:void 0)&&(t+=o(null!=u.props?u.props.children:void 0,function(r){return r.length})),n.push(u),t>=e)return n.push("…"),n}else{if(t+u.length>=e){var s=e-t;return n.push(u.substring(0,s)),n.push("…"),n}t+=u.length,n.push(u)}}return r}});
//# sourceMappingURL=comment_dom.min.js-vfl5GJ8sP.map