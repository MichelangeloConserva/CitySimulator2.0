define(["require","exports","tslib","react","spectrum-integrations/platform-interfaces","spectrum-integrations/error-helper","spectrum-integrations/share_form_body/share_form_body"],function(t,e,s,i,a,n,r){"use strict";function o(t){return/^[^@]+@[^@]+\.[^@]+$/.test(t)||/^#[a-zA-Z0-9-]+$/.test(t)}Object.defineProperty(e,"__esModule",{value:!0});var c=(function(t){function e(){var e=t.call(this)||this;return e.onPrimaryAction=function(){if(e.state.isTargetValid){var t=e.props.localization;e.sendMessage().then(function(s){e.showNotice({title:t.messageSentNotification,variant:"complete",actions:[{text:t.seeMessageActionLabel,onClick:function(t){e.props.openDeepLink(s.deep_link),t()}},a.getCloseAction(t)],timeout:a.DEFAULT_NOTICE_TIMEOUT}),e.props.onModalDismiss(!1)}).catch(function(s){console.error(s),e.showNotice(n.getErrorNotice(s,t,e.props.openDbxUrl))})}},e.onSecondaryAction=function(){e.props.onModalDismiss(!0)},e.handleTargetChange=function(t){e.setState({target:t.target.value,isTargetValid:o(t.target.value)})},e.handleMessageChange=function(t){e.setState({message:t.target.value})},e.state={isSending:!1,target:"",isTargetValid:!1,message:""},e}return s.__extends(e,t),e.prototype.componentDidMount=function(){var t=this.props.targetUser;t&&t.email&&this.setState({target:t.email,isTargetValid:o(t.email)})},e.prototype.render=function(){var t=this.state,e=t.target,s=t.isTargetValid,a=t.message,n=this.props.targetUser,o=this.props.localization,c=!(!n||!n.email||n.email!==e),l=(c&&n.display_name,"int-share-modal");return s||(l+=" int-share-modal-invalid"),i.createElement(r.IntegrationsShareFormBody,{className:l,isTargetValid:s,target:e,onTargetChanged:this.handleTargetChange,message:a,onMessageChanged:this.handleMessageChange,localization:o,onPrimaryAction:this.onPrimaryAction,onSecondaryAction:this.onSecondaryAction})},e.prototype.sendMessage=function(){return s.__awaiter(this,void 0,void 0,function(){var t,e,i,a,n,r;return s.__generator(this,function(s){switch(s.label){case 0:t=this.props,e=t.apiClient,i=t.localization,this.setState({isSending:!0}),this.showNotice({title:i.messageSendingNotification,variant:"sync",progress:0,actions:[]}),s.label=1;case 1:return s.trys.push([1,,4,5]),[4,this.getShareLink()];case 2:return a=s.sent(),n={target:this.state.target,message:this.state.message+" "+a},[4,e.ns("slack").rpc("send_direct_message",n,{})];case 3:return r=s.sent(),[2,r];case 4:return this.setState({isSending:!1}),[7];case 5:return[2]}})})},e.prototype.showNotice=function(t){this.state.activeNotice&&this.state.activeNotice.dismiss();var e=this.props.showNotice(t);this.setState({activeNotice:e})},e.prototype.getShareLink=function(){return s.__awaiter(this,void 0,void 0,function(){var t,e,i,a,n;return s.__generator(this,function(s){switch(s.label){case 0:return t=this.props.apiClient,e={path:this.props.fileId},[4,t.ns("sharing").rpc("list_shared_links",e,{})];case 1:return i=s.sent(),i.links.length?[2,i.links[0].url]:(a={path:this.props.fileId},[4,t.ns("sharing").rpc("create_shared_link_with_settings",a,{})]);case 2:return n=s.sent(),[2,n.url]}})})},e})(i.Component);e.IntegrationsStatefulShareBody=c});
//# sourceMappingURL=stateful_share_form_body.min.js-vfllgC8G_.map