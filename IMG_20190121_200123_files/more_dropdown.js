define(["require","exports","tslib","esignature_prototype/components/esignature_callout","esignature_prototype/components/esignature_popover_item","esignature_prototype/constants","esignature_prototype/data/actions","esignature_prototype/data/selectors","esignature_prototype/utils","react","external/react-redux","modules/clean/react/bubble_dropdown_v2","modules/clean/previews/util","spectrum/popover","modules/clean/react/file_action_button_type","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/data/selectors","modules/clean/react/file_viewer/utils","modules/clean/react/file_viewer/more_dropdown/more_option_registry","modules/clean/react/file_viewer/more_dropdown/views","modules/clean/react/size_class/constants","modules/clean/react/title_bar/overflow_menu","modules/core/browser","modules/core/i18n","modules/clean/react/paper/utils","react-dom","modules/clean/react/paper/open_in_paper_callout_loader","modules/clean/react/paper/open_in_paper_button","modules/clean/react/file_viewer/data/actions"],function(e,t,o,r,n,i,s,l,a,p,u,c,d,m,h,_,f,v,g,C,S,y,k,I,E,w,b,O,P,A){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),p=o.__importDefault(p),d=o.__importStar(d),b=o.__importStar(b);var R=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state=t.getStateFromRegistry(),t.onRegistryUpdate=function(){t.setState(t.getStateFromRegistry())},t.handleDownloadClick=function(e){return e.preventDefault(),A.download(t.props.file),_.logUserAction(f.UserAction.Download,f.UserActionContext.TitleBarMore)},t.handleRemoveLinkClick=function(e){e.preventDefault(),t.props.onRemoveShareLink&&(t.props.onRemoveShareLink(),_.logUserAction(f.UserAction.RemoveLink,f.UserActionContext.TitleBarMore))},t.handlePreviousVersionClick=function(e){if(e.preventDefault(),!t.props.user)throw new Error("User not specified");return d.redirectToVersionHistory(t.props.file,t.props.user),_.logUserAction(f.UserAction.ViewRevisions,f.UserActionContext.TitleBarMore)},t.handleSignInClick=function(e){e.preventDefault(),_.logUserAction(f.UserAction.SignIn,f.UserActionContext.TitleBarMore),I.redirect(g.getSharedLinkLoginUrl())},t.handleOpenInPaperClick=function(e){e.preventDefault();var o={file:t.props.file,user:t.props.user,sharedLink:t.props.sharedLink,fromModal:!1};w.openFileInPaper(o)},t.handleClick=function(){t.props.dismissCallout&&t.props.dismissCallout(),t.setState({hasBeenClicked:!0})},t}return o.__extends(t,e),t.prototype.componentDidMount=function(){this.removeRegistryListener=C.moreOptionRegistry.addListener(this.onRegistryUpdate)},t.prototype.componentWillUnmount=function(){this.removeRegistryListener()},t.prototype.getStateFromRegistry=function(){return{registeredItems:C.moreOptionRegistry.getOptionItems(),hasBeenClicked:!1}},t.prototype.getPopoverContent=function(){var e=this.props,t=e.allowRemoveLink,o=e.isPrivate,r=e.onRemoveShareLink,i=e.renderSignIn,s=e.shareDownloadOptions,l=e.sizeClass,u=e.showOpenInPaper,c=e.file,d=e.user,_=[],f=l===y.SizeClass.Small,v=l===y.SizeClass.Medium,g=l===y.SizeClass.Large;if(o&&v&&_.push(p.default.createElement(k.PopoverOrMobileItem,{className:"more-button__share",key:"more-button__share",onSelect:this.props.onClickShareLink},h.getFileActionButtonText(h.FileActionButtonType.SHARE))),null!=r&&t&&!f&&_.push(p.default.createElement(k.PopoverOrMobileItem,{className:"more-button__remove",key:"more-button__remove",onSelect:this.handleRemoveLinkClick},h.getFileActionButtonText(h.FileActionButtonType.REMOVE_LINK))),o&&_.push(p.default.createElement(k.PopoverOrMobileItem,{className:"more-button__download",key:"more-button__download",onSelect:this.handleDownloadClick},h.getFileActionButtonText(h.FileActionButtonType.DOWNLOAD))),s)for(var C=0,I=s;C<I.length;C++){var w=I[C];if(!w.isDisabled){var b="more-button-sl__"+w.userAction;_.push(p.default.createElement(T,{handler:w.handler,key:b,text:w.text,userAction:w.userAction}))}}if(o&&!f&&_.push(p.default.createElement(k.PopoverOrMobileItem,{className:"more-button__version-history",key:"more-button__version-history",onSelect:this.handlePreviousVersionClick},h.getFileActionButtonText(h.FileActionButtonType.PREVIOUS_VERSIONS))),g){var O=S.getPopoverOrMobileItemsForMoreOptions(this.state.registeredItems);_=_.concat(O)}return i&&_.push(p.default.createElement(k.PopoverOrMobileItem,{className:"more-button__sign-in",key:"more-button__sign-in",onSelect:this.handleSignInClick},E._("Sign in"))),u&&(g&&_.length&&this.state.registeredItems.length&&_.push(p.default.createElement(m.PopoverContentSeparator,{key:"more_button__separator2"})),_.push(p.default.createElement(k.PopoverOrMobileItem,{className:"more-button__open-in-paper",key:"more-button__open-in-paper",onSelect:this.handleOpenInPaperClick},p.default.createElement(P.OpenInPaperButtonInMoreDropdown,{file:c,handleOpenInPaperClick:this.handleOpenInPaperClick,sizeClass:l})))),this.props.isFileRendered&&d&&a.shouldIncludeEsignaturePopoverItem(c,d.id)&&!f&&(g&&_.length&&this.state.registeredItems.length&&_.push(p.default.createElement(m.PopoverContentSeparator,{key:"more_button__separator3"})),_.push(p.default.createElement(n.EsignaturePopoverItem,{file:c,userId:d.id}))),_},t.prototype.shouldShowEsignatureCallout=function(){return!this.props.isCalloutDismissed&&this.props.sizeClass!==y.SizeClass.Small&&this.props.user&&a.shouldShowIntroduceEsignatureCallout(this.props.file,this.props.user.id)},t.prototype.render=function(){var e=this,t=this.props,o=t.file,n=t.sizeClass,s=t.showOpenInPaper,l=t.user,a=this.state.hasBeenClicked;return p.default.createElement("div",{ref:function(t){e.ref=b.findDOMNode(t)},onClick:this.handleClick},p.default.createElement(k.OverflowMenu,{contentWrapperClassName:"react-file-viewer-dropdown"},this.getPopoverContent()),s?p.default.createElement(O.OpenInPaperCalloutLoader,{file:o,parentHasBeenClicked:a,sizeClass:n,targetNode:this.ref,user:l,variant:w.OpenInPaperButtonVariant.Ellipsis}):null,this.shouldShowEsignatureCallout()?p.default.createElement(r.EsignatureCallout,{title:i.INTRODUCE_ESIGNATURE_TITLE,message:i.INTRODUCE_ESIGNATURE_MESSAGE,onDismiss:this.props.dismissCallout,targetNode:this.ref,position:c.BubbleDropdownPositions.BOTTOM_LEFT}):null)},t})(p.default.Component);t._MoreDropdown=R;var M=function(e){return{isCalloutDismissed:l.getIsCalloutDismissed(e),isFileRendered:v.getRenderStatusForCurrentFile(e)===f.PreviewRenderStatus.Succeeded}},D={dismissCallout:s.dismissCallout},U=u.connect(M,D)(R);t.MoreDropdown=U;var T=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleClick=function(){var e=t.props,o=e.handler,r=e.userAction;_.logUserAction(r,f.UserActionContext.TitleBarMore),o()},t}return o.__extends(t,e),t.prototype.render=function(){var e=this.props.text;return p.default.createElement(k.PopoverOrMobileItem,{onSelect:this.handleClick},e)},t})(p.default.PureComponent)});
//# sourceMappingURL=more_dropdown.min.js-vflF1_fzf.map