define(["require","exports","tslib","react","external/react-redux","esignature/data/actions","esignature/data/selectors","esignature/public/utils","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/more_dropdown","modules/clean/react/file_viewer/open_button/open_button","modules/clean/react/file_viewer/share_helpers","modules/clean/react/title_bar/controls_container","modules/clean/react/user_notifications/dropdown","modules/clean/sharing/api/client","modules/clean/sharing/delete_link_modal","modules/clean/react/size_class/constants","modules/core/i18n","modules/core/browser_detection","modules/clean/react/paper/utils","modules/clean/react/paper/open_in_paper_button","modules/clean/web_timing_logger","modules/clean/react/app_actions/app_actions_menu","modules/clean/react/app_actions/app_actions_store","modules/clean/react/app_actions/gemini_actions"],function(e,t,n,i,o,a,s,r,l,c,u,p,h,d,f,m,_,g,w,A,C,v,S,k,I,B){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=n.__importDefault(i),h=n.__importStar(h);var E=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={linkMetadata:null,showGeminiActions:!1,extensionsConfig:I.emptyExtensionsConfig()},t.cancelGetSharedLinkInfo=function(){},t.handleShareClick=function(){h.share(t.props.file,t.props.user,null,"PREVIEW_PAGE"),l.logUserAction(c.UserAction.Share,c.UserActionContext.TitleBarMain)},t.removeShareLink=function(){var e=new m.ShareApiClient({userId:t.props.user.id}),n=t.state.linkMetadata,i=n.name,o=n.url;_.deleteLinkWithConfirm({client:e,contentName:i,onCancel:null,onDeleteLink:function(){return t.setState({linkMetadata:null})},url:o})},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.setupShare(this.props),this.getAppActions(this.props.file),this.getGeminiActions(),this.setState({openInPaperButtonVariant:C.getOpenInPaperButtonVariant({file:this.props.file,user:this.props.user})})},t.prototype.componentWillUnmount=function(){this.cancelGetSharedLinkInfo()},t.prototype.componentWillReceiveProps=function(e){e.file!==this.props.file&&(this.cancelGetSharedLinkInfo(),this.setState({linkMetadata:null}),this.setupShare(e),this.getAppActions(e.file),this.getGeminiActions())},t.prototype.setupShare=function(e){return n.__awaiter(this,void 0,void 0,function(){var t,i,o;return n.__generator(this,function(n){switch(n.label){case 0:return t=!1,this.cancelGetSharedLinkInfo=function(){t=!0},i=new m.ShareApiClient({userId:e.user.id}),[4,i.sharedLinkInfo({fileIdOrPath:e.file.fq_path})];case 1:return o=n.sent(),t||this.setState({linkMetadata:o}),this.cancelGetSharedLinkInfo=function(){},[2]}})})},t.prototype.getAppActions=function(e){return n.__awaiter(this,void 0,void 0,function(){var t;return n.__generator(this,function(n){switch(n.label){case 0:return[4,S.waitForTTI()];case 1:return n.sent(),[4,I.getAppActionsStore().getActionsForFile(e,this.props.user.id)];case 2:return t=n.sent(),this.setState({extensionsConfig:t}),[2]}})})},t.prototype.getGeminiActions=function(){return n.__awaiter(this,void 0,void 0,function(){var e;return n.__generator(this,function(t){switch(t.label){case 0:return[4,S.waitForTTI()];case 1:return t.sent(),[4,B.getGeminiActionsStore().getGeminiExtensionsEnabledForUser(this.props.user.id)];case 2:return e=t.sent(),this.setState({showGeminiActions:e}),[2]}})})},t.prototype.logUserActionInTitleBarFactory=function(e){return function(){return l.logUserAction(e,c.UserActionContext.TitleBarMain)}},t.prototype.getExtraOptions=function(){var e=this.props,t=e.file,n=e.user,i=e.formMode,o=e.enableFormCreationMode,a=r.getEsignatureOpenButtonOption(t,o,i,n.id);return a?[a]:void 0},t.prototype.render=function(){var e=!!this.state.linkMetadata&&this.state.linkMetadata.link_permissions.can_revoke,t=this.props,o=t.file,a=t.sizeClass,s=t.shouldDisplayActionButtons,r=t.user,l=a===g.SizeClass.Small,h={allowRemoveLink:e,isPrivate:!0,file:o,onClickShareLink:this.handleShareClick,onRemoveShareLink:this.removeShareLink,sizeClass:a,user:r,showOpenInPaper:this.state.openInPaperButtonVariant===C.OpenInPaperButtonVariant.Ellipsis&&!l};if(a!==g.SizeClass.Large){var m=null;return s&&!A.is_mobile_or_tablet()&&a!==g.SizeClass.Small&&(m=this.state.extensionsConfig.showMenu?i.default.createElement("div",{className:"control__button"},i.default.createElement(k.AppActionsMenu,{file:o,extensionsConfig:this.state.extensionsConfig,user:r,showAsButtonIfDownloadOnly:!0,hasOpenInPaperSupport:this.state.openInPaperButtonVariant===C.OpenInPaperButtonVariant.Dropdown,telemetryContext:{surface:"previews"},showEduTooltip:!0,showGeminiActions:this.state.showGeminiActions})):i.default.createElement(p.OpenButton,{file:o,location:c.FileViewerPane.TitleBar,user:r,showGeminiActions:this.state.showGeminiActions})),i.default.createElement(d.TitleBarControlsContainer,null,m,i.default.createElement(u.MoreDropdown,n.__assign({},h)))}var _;return s&&(_=[i.default.createElement("button",{className:"share-button button-primary control__button",onClick:this.handleShareClick,key:0},w._("Share"))],this.state.openInPaperButtonVariant===C.OpenInPaperButtonVariant.Button&&_.push(i.default.createElement(v.OpenInPaperButton,{key:"openinpaper",file:o,user:r,hideCallout:!1})),this.state.extensionsConfig.showMenu?_.push(i.default.createElement("div",{className:"control__button"},i.default.createElement(k.AppActionsMenu,{file:o,extensionsConfig:this.state.extensionsConfig,user:r,showAsButtonIfDownloadOnly:!0,hasOpenInPaperSupport:this.state.openInPaperButtonVariant===C.OpenInPaperButtonVariant.Dropdown,telemetryContext:{surface:"previews"},showEduTooltip:!0,extraOptions:this.getExtraOptions(),showGeminiActions:this.state.showGeminiActions}))):_.push(i.default.createElement(p.OpenButton,{file:o,location:c.FileViewerPane.TitleBar,user:r,key:2,sizeClass:this.props.sizeClass,hasOpenInPaperSupport:this.state.openInPaperButtonVariant===C.OpenInPaperButtonVariant.Dropdown,extraOptions:this.getExtraOptions(),showGeminiActions:this.state.showGeminiActions}))),i.default.createElement(d.TitleBarControlsContainer,null,_,i.default.createElement(u.MoreDropdown,n.__assign({},h)),i.default.createElement("div",{className:"react-title-bar__divider"}),i.default.createElement(f.UserNotificationsDropdown,{isPagelet:!1,onClick:this.logUserActionInTitleBarFactory(c.UserAction.ClickNotifications),displayBell:!r.is_guest_admin}))},t})(i.default.Component);t.UnconnectedMountedFileActions=E;var P=function(e){return{formMode:s.getFormMode(e)}},b={enableFormCreationMode:a.enableFormCreationMode};t.MountedFileActions=o.connect(P,b)(E)});
//# sourceMappingURL=mounted_file_actions.min.js-vflJSMW9V.map