define(["require","exports","tslib","modules/clean/ajax","external/lodash","modules/core/i18n","modules/clean/api_v2/user_client","modules/core/notify"],function(e,t,r,n,i,o,a,c){"use strict";function s(e,t,s,u){return r.__awaiter(this,void 0,void 0,function(){function l(){return r.__awaiter(this,void 0,void 0,function(){var n,i,o;return r.__generator(this,function(r){switch(r.label){case 0:n=new a.UserApiV2Client,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,n.ns("app_actions").rpc("redirect",{action_id:t,file_id:u},{subjectUserId:e})];case 2:return i=r.sent(),[2,i.redirect_url];case 3:return o=r.sent(),m=!0,[2,"/aa/error"];case 4:return[2]}})})}var d,_,m,p,f,h,w;return r.__generator(this,function(r){switch(r.label){case 0:return d="action_redirect_"+Math.random().toString(16).substring(2),_=window.open("",d),_&&(_.document.open("text/html","replace"),_.document.write("<html><head><title>"+i.escape(s)+"</title></head></html>"),_.document.close()),m=!1,p=new Promise(function(r){n.SilentBackgroundRequest({url:"/aa/loading",subject_user:e,data:{file_id:u,action_id:t},success:function(e){!m&&_?(_.document.open("text/html","replace"),_.document.write(e),_.document.close(),_.document.title=s,setTimeout(r,1500)):r()},error:function(){r()}})}),[4,Promise.all([p,l()])];case 1:return f=r.sent(),h=f[1],_?_.location.replace(h):(w=window.open(h,"_blank"),w||c.Notify.error(o._("Failed to open %(app_name)s").format(s))),[2]}})})}Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),i=r.__importStar(i),t.redirectToAction=s});
//# sourceMappingURL=redirect.min.js-vfl1xGzvw.map