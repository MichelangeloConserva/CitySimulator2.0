define(["require","exports","tslib","esignature_prototype/constants","react","external/prop-types","modules/clean/avatar/avatar_with_default","modules/clean/avatar/initials_avatar","modules/clean/avatar/style","modules/clean/avatar/viewer_avatar","modules/clean/datetime","modules/clean/em_string","modules/clean/previews/util","modules/clean/react/pass/constants","modules/clean/react/pass/utils","modules/clean/react/title_bubble","modules/clean/react_format","modules/core/browser_detection","modules/core/user_i18n","modules/core/i18n","modules/clean/react/pass/upsell/tooltip/pass_upsell_tooltip","modules/clean/react/pass/upsell/simple_upsell","modules/clean/react/pass/integration/integration_tooltip"],function(e,t,o,n,a,r,i,s,l,p,u,c,m,d,f,h,_,g,w,b,v,T,I){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=o.__importDefault(a),r=o.__importStar(r),i=o.__importDefault(i),p=o.__importDefault(p),g=o.__importStar(g),w=o.__importStar(w);var y=(function(e){function t(t){var o=e.call(this,t)||this;return o.allowInteractingWithTooltip=function(){return!1},o.renderAvatarButton=function(){return a.default.createElement("button",{className:"pass-facepile-avatar"},o.getAvatar())},o.state={loadResult:"loaded"},o}return o.__extends(t,e),t.prototype.getBubbleBackgroundColor=function(){},t.prototype.render=function(){var e=this.wrapAvatarWithTooltip(),t="pending"===this.state.loadResult?"react-pass__face-no-display":"react-pass__face-container";return a.default.createElement("div",{className:t},e)},t.prototype.wrapAvatarWithTooltip=function(){return a.default.createElement(h.TitleBubble,{content:this.getTooltipElement(),position:h.TitleBubble.POSITIONS.BOTTOM,distanceFromTarget:9,isTargetPositionFixed:!0,onMouseEnter:this.props.onMouseEnter,className:this.getTooltipClass(),backgroundColor:this.getBubbleBackgroundColor(),allowInteractTooltip:this.allowInteractingWithTooltip()},this.renderAvatarButton())},t})(a.default.Component),C=(function(e){function t(t){var o=e.call(this,t)||this;return o.allowInteractingWithTooltip=function(){return o.context.isIntegrationTooltipEnabled()||o.showPassUpsell},o.state={loadResult:null==o.props.userInfo.photoUrl?"loaded":"pending"},o.boundOnLoad=o.onFinalize.bind(o,!0),o.boundOnError=o.onFinalize.bind(o,!1),o}return o.__extends(t,e),Object.defineProperty(t.prototype,"showPassUpsell",{get:function(){return this.context.isInSimpleUpsellExperiment()&&T.shouldShowSimpleUpsellForAvatar(this.props.userInfo)&&!!this.props.upsellInfo&&this.props.upsellInfo.isViewerEligibleForUpsell},enumerable:!0,configurable:!0}),t.prototype.offlineTooltipTemplate=function(){var e=b._("<b>%(user_name)s</b> <newline/> Viewed %(ago)s",{comment:'Format like "userName <newline> Viewed 5 days ago'});if(m.shouldShowPlatformInfo()){var t=this.props.userInfo.platformType;t===d.PASS_PLATFORM.DESKTOP?e=b._("<b>%(user_name)s</b> <newline/> Viewed %(ago)s <newline/> on desktop",{comment:'Format like "userName <newline> Viewed 5 days ago <newline> on desktop'}):t===d.PASS_PLATFORM.WEB?e=b._("<b>%(user_name)s</b> <newline/> Viewed %(ago)s <newline/> on web",{comment:'Format like "userName <newline> Viewed 5 days ago <newline> on web'}):t===d.PASS_PLATFORM.MOBILE&&(e=b._("<b>%(user_name)s</b> <newline/> Viewed %(ago)s <newline/> on mobile",{comment:'Format like "userName <newline> Viewed 5 days ago <newline> on mobile'}))}return e.replace("%(ago)s",u.ago(1e3*this.props.userInfo.whenLastSeen,!1,!0,!0))},t.prototype.onlineTooltipTemplate=function(){return b._("<b>%(user_name)s</b> <newline/> Viewing now",{comment:'Format like "user_name <newline> Viewing now"'})},t.prototype.accessNameTooltipTemplate=function(e){switch(e){case"owner":return b._("<b>%(user_name)s</b> <newline/> Owner",{comment:'Format like "user_name <newline> Owner"'});case"writer":return b._("<b>%(user_name)s</b> <newline/> Can edit",{comment:'Format like "user_name <newline> Can edit"'});case"reader":return b._("<b>%(user_name)s</b> <newline/> Can comment",{comment:'Format like "user_name <newline> Can comment"'});case"signer":return n.CAN_SIGN_PASS_TEMPLATE;case"reader_no_comment":case void 0:return b._("<b>%(user_name)s</b> <newline/> Can view",{comment:'Format like "user_name <newline> Can view"'})}},t.prototype.isGuestAvatar=function(){return this.props.userInfo.userId&&f.AnonymousViewerUtils.isAnonymousUserId(this.props.userInfo.userId)},t.prototype.getUserAvatarProps=function(){var e=this.props.userInfo,t=e.displayName,n=e.isActive,r=this.isGuestAvatar()?f.AnonymousViewerUtils.getAnonymousViewerInitials(t):w.getInitials(t),i={dimension:32,initials:r,color:this.getInitialsColor(),shape:"CIRCLE"};n||(i.optionalClass="c-avatar--inactive",g.msie&&(i.color="#7B8994"));var l=a.default.createElement(s.InitialsAvatar,o.__assign({},i));return n||(l=a.default.createElement("span",{className:"c-avatar-initials-wrapper"},l)),{alt:t,dimension:32,photoUrl:this.getEffectivePhotoUrl(),defaultAvatar:l,optionalClass:i.optionalClass,shape:"CIRCLE",onLoad:this.boundOnLoad,onError:this.boundOnError}},t.prototype.getEffectivePhotoUrl=function(){return"error"===this.state.loadResult?void 0:this.props.userInfo.photoUrl},t.prototype.getAvatar=function(){var e=this.getUserAvatarProps();return this.props.userInfo.isViewer&&"error"!==this.state.loadResult?a.default.createElement(p.default,o.__assign({},e)):a.default.createElement(i.default,o.__assign({},e))},t.prototype.onFinalize=function(e){if(null!=this.getEffectivePhotoUrl()){this.setState({loadResult:e?"loaded":"error"});var t=this.props,o=t.userInfo.photoUrl,n=t.onLoad;n&&o&&n(o)}},t.prototype.getTooltipClass=function(){return this.context.isIntegrationTooltipEnabled()?"integration-tooltip-bubble":this.showPassUpsell?"seen-state-title-bubble-with-upsell":"seen-state-title-bubble"},t.prototype.getInitialsColor=function(){return this.isGuestAvatar()?l.colorValueForAvatarName(this.props.userInfo.userId):l.colorValueForAvatarName(this.props.userInfo.displayName)},t.prototype.getBubbleBackgroundColor=function(){return this.context.isIntegrationTooltipEnabled()?"transparent":this.getInitialsColor()},t.prototype.getTooltipElement=function(){var e=this.props,t=e.userInfo,o=e.integrationInfo,n=c.Emstring.em_snippet(t.displayName,10);if(this.context.isIntegrationTooltipEnabled())return a.default.createElement(I.IntegrationTooltip,{userInfo:t,fileInfo:{file_id:o.fileId},avatarColor:this.getInitialsColor()});if(this.showPassUpsell&&this.context.getTracker()&&this.context.getUpsellUrl()&&this.context.getVariant()&&this.props.upsellInfo)return a.default.createElement(v.PassUpsellTooltip,{displayName:n,baseColor:this.getInitialsColor(),tracker:this.context.getTracker(),info:this.props.upsellInfo,upsellUrl:this.context.getUpsellUrl(),variant:this.context.getVariant()});var r=void 0;r=t.isActive?this.onlineTooltipTemplate():null!=t.whenLastSeen?this.offlineTooltipTemplate():this.accessNameTooltipTemplate(t.accessLevel);var i=_.reactFormat(r,{user_name:n,b:a.default.createElement("b",{key:"thebold"}),newline:a.default.createElement("br",null)});return a.default.createElement("span",null,i)},t.contextTypes={getTracker:r.func,getUpsellUrl:r.func,getVariant:r.func,isInSimpleUpsellExperiment:r.func,getApiV2Client:r.func,getDataStore:r.func,isIntegrationTooltipEnabled:r.func},t})(y);t.UserAvatar=C;var E=(function(e){function t(t){return e.call(this,t)||this}return o.__extends(t,e),t.prototype.getDisplayNum=function(){return this.props.moreFacepileCount>=d.MAX_OVERFLOW_BUTTON_INDICATOR?d.MAX_OVERFLOW_BUTTON_INDICATOR:this.props.moreFacepileCount},t.prototype.getMoreFacepileCountText=function(){return this.props.moreFacepileCount>=d.MAX_OVERFLOW_BUTTON_INDICATOR?d.MAX_OVERFLOW_BUTTON_INDICATOR+"+":""+this.props.moreFacepileCount},t.prototype.getAvatar=function(){return a.default.createElement(s.InitialsAvatar,{alt:this.getMoreFacepileCountText(),dimension:32,initials:this.getMoreFacepileCountText(),color:"#7B8994",shape:"CIRCLE",optionalClass:"c-avatar--overflow"})},t.prototype.getTooltipClass=function(){return"seen-state-title-bubble facepile-overflow"},t.prototype.getTooltipElement=function(){return b.ungettext("%(display_num)s other","%(display_num)s others",this.getDisplayNum()).format({display_num:this.getMoreFacepileCountText()})},t})(y);t.OverflowAvatar=E});
//# sourceMappingURL=avatars.min.js-vflXyO_Pw.map