define(["require","exports","tslib","external/react","external/lodash","external/react-redux","external/classnames","external/react-redux","modules/clean/react/css","spectrum/colorized_icon/colorized_icon","spectrum/icon_action","modules/clean/react/comments2/convert_annotation_coordinates","modules/clean/react/comments2/data/selectors","modules/clean/react/comments2/components/mouse_tooltip","modules/core/i18n","modules/clean/react/comments2/data/actions","modules/clean/react/comments2/data/store","modules/clean/react/comments2/position_utils"],function(t,e,n,o,i,r,s,a,c,u,l,d,m,p,v,h,_,g){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),o=n.__importStar(o),i=n.__importStar(i),s=n.__importDefault(s),m=n.__importStar(m);var C=(function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.state={},e.buttonElm=null,e.onButtonRef=function(t){return e.buttonElm=t},e.updateButtonPosition=function(){if(!e.shouldRenderTextSelectionButton())return void e.setState({textSelectionButtonPosition:void 0});var t=e.props,n=t.pending,o=t.containerEl;if(n&&o){var i=o.getBoundingClientRect();e.setState({textSelectionButtonPosition:g.computePositionForElementInContainer(i,d.convertFromComments2ToClientRect(n,i),e.buttonElm.getBoundingClientRect())})}},e.debouncedUpdateButtonPosition=i.debounce(e.updateButtonPosition,300),e.onMouseDown=function(t){t.stopPropagation()},e}return n.__extends(e,t),e.prototype.componentDidMount=function(){this.updateButtonPosition(),window.addEventListener("resize",this.debouncedUpdateButtonPosition)},e.prototype.componentDidUpdate=function(t){this.props.pending!==t.pending&&this.updateButtonPosition()},e.prototype.componentWillUnmount=function(){window.removeEventListener("resize",this.debouncedUpdateButtonPosition)},e.prototype.shouldRenderTextSelectionButton=function(){var t=this.props,e=t.pending,n=t.pageIndex;return!(!e||"document"!==e.type||"highlight"!==e.regionType)&&e.regions[0].page===n+1},e.prototype.render=function(){var t=this.props,e=t.actAsAbsoluteContainer,n=t.isAnnotationRegionEnabled,i=t.isActiveAnnotation,r=t.pending,a=t.renderAsEmpty,c=this.state.textSelectionButtonPosition,d=s.default("comments2-annotation-overlay",{"comments2-annotation-overlay__act-as-absolute-container":e,"comments2-annotations-disabled":a});if(a)return o.createElement("div",{className:d});var m=s.default("comments2-text-selection-button",{"comments2-text-selection-button__is-visible":this.shouldRenderTextSelectionButton()}),h=c&&g.convertPositionToCssStyle(c);return o.createElement("div",{className:d},o.createElement("button",{ref:this.onButtonRef,className:m,style:h,onClick:this.props.requestEditorFocus,onMouseDown:this.onMouseDown},o.createElement(u.ColorizedIcon,{color:"#C1C7CD"},o.createElement(l.IconAction,{name:"add-comment","aria-label":v._("Comment on text")}))),o.createElement(p.MouseTooltip,{containerEl:this.props.containerEl,body:v._("Click and drag to comment"),disabled:!!r||!n||i,directionsInPriorityOrder:["right","left"]}))},e.displayName="AnnotationOverlay",e})(o.Component);e.AnnotationOverlayConnectedWithoutCss=a.connect(function(t){return m.getState(t)?{pending:m.getPendingNumberedAnnotation(t),isActiveAnnotation:!!m.getActivatedThreadId(t)}:{}},{requestEditorFocus:h.Actions.requestEditorFocus})(C);var f=c.requireCssWithComponent(e.AnnotationOverlayConnectedWithoutCss,["/static/css/comments2_annotations-vflY-x25Z.css"]);e.AnnotationOverlayConnectedWithCssWithProvider=function(t){return o.createElement(r.Provider,{store:_.getStoreForComments2()},o.createElement(f,n.__assign({},t)))},e.AnnotationOverlay=e.AnnotationOverlayConnectedWithCssWithProvider});
//# sourceMappingURL=annotation_overlay.min.js-vflBfASNT.map