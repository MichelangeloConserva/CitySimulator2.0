define("modules/clean/react/browse/client_download_modal",["require","exports","tslib","modules/core/cookies","modules/clean/ajax","modules/clean/react/modal","modules/clean/static_urls","react","modules/core/i18n","modules/clean/react/css","modules/core/browser","modules/clean/analytics"],function(e,t,r,a,o,i,n,s,l,d,u,p){"use strict";function c(e){"y"!==a.Cookies.read("uj-pop")&&o.WebRequest({url:"/should_show_uj_popup",data:{is_download:e},success:function(t){JSON.parse(t).showModal&&(h.showInstance({isDownload:e}),a.Cookies.create("uj-pop","y",30))},error:function(){}})}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),s=r.__importDefault(s),u=r.__importStar(u);var h=(function(e){function t(t){var r=e.call(this,t)||this;return r.onAccept=function(){p.TeamsWebActionsLogger.log("uj_popup_modal_clicked",{},function(){u.redirect("/downloading")})},r.onDismiss=function(){p.TeamsWebActionsLogger.log("uj_popup_modal_dismissed")},r}return r.__extends(t,e),t.showInstance=function(e){i.Modal.showInstance(s.default.createElement(t.ClientDownloadModal,r.__assign({},e)))},t.prototype.getHeader=function(){return this.props.isDownload?l._("Download files just by opening them"):l._("No more uploads — how easy!")},t.prototype.getBody=function(){return this.props.isDownload?l._("With the Dropbox desktop app, you can access         everything in your account right from your desktop.         Save to the cloud instantly, and download         files when you need them just by opening them."):l._("With the Dropbox desktop app and selective sync,         you can open, edit, and save files right on your desktop.         Your changes sync automatically to all your devices,         so you save time and hard drive space.")},t.prototype.getCTA=function(){return l._("Download for free")},t.prototype.render=function(){return s.default.createElement(i.Modal,{className:"uj-popup-modal",acceptButtonText:null,onDismiss:this.onDismiss,style:"clean",width:640},s.default.createElement("div",{className:"uj-popup-modal__content"},s.default.createElement("img",{alt:"",src:n.static_url("/static/images/install/uj_popup_install-vflA_v5Lg.png")}),s.default.createElement("div",{className:"uj-popup-modal__header"},this.getHeader()),s.default.createElement("div",{className:"uj-popup-modal__body"},this.getBody()),s.default.createElement("button",{className:"mc-button mc-button-primary",onClick:this.onAccept},this.getCTA())))},t.ClientDownloadModal=d.requireCssWithComponent(t,["/static/css/browse/popup_modal-vfl5uk2Vp.css"]),t})(s.default.Component);t.ClientDownloadModalView=h,t.maybeShowClientDownloadModal=c}),define("modules/clean/react/browse/shared_with",["require","exports","tslib","external/lodash","react","external/prop-types","modules/clean/filepath","external/create-react-class","modules/clean/ajax","modules/clean/avatar/size","modules/clean/flux/base_store","modules/clean/flux/dispatcher","modules/clean/flux/store_mixin","modules/clean/react/browse/constants","modules/clean/react/files_view/types","modules/clean/react/browse/models","modules/clean/react/browse/data/store","modules/clean/react/browse/data/selectors","modules/clean/sharing/actions/sharing_actions","modules/clean/sharing/api","modules/clean/sharing/api/client","modules/clean/sharing/public_folder/public_folder","modules/clean/sharing/share_modal_util","modules/clean/react/browse/shared_with_view","modules/clean/sharing/stores/sharing_info","modules/clean/sharing/ui_util","modules/constants/sharing","modules/core/browser","modules/clean/react/browse/nav_actions","modules/clean/viewer"],function(e,t,r,a,o,i,n,s,l,d,u,p,c,h,m,_,f,g,S,E,y,b,v,T,A,I,R,D,w,C){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=r.__importStar(a),o=r.__importDefault(o),i=r.__importStar(i),n=r.__importStar(n),s=r.__importDefault(s),l=r.__importStar(l),c=r.__importDefault(c),g=r.__importStar(g),I=r.__importStar(I),D=r.__importStar(D);var F=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.initializeWith=function(e){var t=e.path,r=e.files;return this._pathLoaded(t,r)},t.prototype._init=function(){this._sharedFolderDataByTargetNs={},this._sharedLinkDataMapsByFolderFQPath={},this._sharedLinkInfoByPath={},this._filesWeHaveSharedLinkDataFor={},this._sharedFileDataByFileId={},this._hasSharedDataLoadedByContainingPath={}},t.prototype.hasLinkDataForFile=function(e){return e.fq_path in this._filesWeHaveSharedLinkDataFor},t.prototype.clearSharedLinkDataCache=function(){this._filesWeHaveSharedLinkDataFor={}},t.prototype.getDataForPath=function(e){var t={},r=this._getSharedLinkInfoByPath(e);return r&&(t.sharedLinkInfo=r),t},t.prototype.getDataForFile=function(e){var t={};if(e&&!e.target_ns&&this._canBeSharedFile(e)){var r=this._sharedFileDataByFileId[e.file_id||e.fq_path]||{},o=this._sharedFolderDataByTargetNs[g.context(f.getStoreForBrowse().getState()).currentNSID]||{};null!=r.joinedMembers&&r.joinedMembers.length||null!=r.groups&&r.groups.length||null!=r.invitations&&r.invitations.length||(t.audienceDescription=o.audienceDescription),t.groups=a.uniqBy(a.union(r.groups||[],o.groups||[]),function(e){return e.gid}),t.invitations=a.uniqBy(a.union(r.invitations||[],o.invitations||[]),function(e){return e.email_or_fbname}),t.joinedMembers=a.uniqBy(a.union(r.joinedMembers||[],o.joinedMembers||[]),function(e){return e.email}),t.numUndisplayableUsersAndInvites=(r.numUndisplayableUsersAndInvites||0)+(o.numUndisplayableUsersAndInvites||0);var i=(null!=t.joinedMembers?t.joinedMembers.length:0)+(null!=t.invitations?t.invitations.length:0)+(t.numUndisplayableUsersAndInvites||0);null!=t.groups&&(i+=t.groups.map(function(e){return e.num_users||1}).reduce(function(e,t){return e+t},0)),t.memberCount=i}else t=e&&e.target_ns?this._sharedFolderDataByTargetNs[e.target_ns]:this._sharedFolderDataByTargetNs[g.context(f.getStoreForBrowse().getState()).currentNSID];t=t||{};var n=this._getSharedLinkInfoByFile(e);return n?t.sharedLinkInfo=n:null!=t&&delete t.sharedLinkInfo,t.hasSharedDataLoaded=this._getHasSharedDataLoaded(),t},t.prototype._getSharedLinkInfoByPath=function(e){return this._sharedLinkInfoByPath[e]},t.prototype._getSharedLinkInfoByFile=function(e){var t,r=g.path(f.getStoreForBrowse().getState()),a=this._sharedLinkDataMapsByFolderFQPath[r];return a&&e&&(t=a[this._sharedLinkKey(e)]),t},t.prototype._sharedLinkKey=function(e){return e.fq_path+"_"+e.ns_id+"_"+e.sjid},t.prototype._new_payload=function(e){var t=e.action;switch(t.type){case h.SharedWithActionType.BROWSE_FILES_LOADED:return this._pathLoaded(t.data.parentPath,t.data.files);case h.SharedWithActionType.BROWSE_FILES_UPDATED:return this._filesChanged(t.data.parentPath,t.data.files);case h.SharedWithActionType.SIGNAL_SHARED_FILE_DATA_OUT_OF_DATE:return this._signalSharedFileDataOutOfDate(t.data.fileIds);case h.SharedWithActionType.SIGNAL_SHARED_FOLDER_DATA_OUT_OF_DATE:return this._signalSharedFolderDataOutOfDate(t.data.parentPath);case h.SharedWithActionType.SIGNAL_SHARED_LINK_DATA_OUT_OF_DATE:return this._signalSharedLinkDataOutOfDate(t.data.parentPath,t.data.fileFqPaths);case h.SharedWithActionType.SET_SHARED_FOLDER_DATA:return this._setNSSharedWithData(t.data.sharedFolderData,t.data.containingPath);case h.SharedWithActionType.SET_SHARED_LINK_DATA:return this._setSharedLinkData(t.data.parentPath,t.data.sharedLinkData);case h.SharedWithActionType.SET_SHARED_LINK_INFO_FOR_PARENT_PATH:return this._setSharedLinkInfoForParentPath(t.data.parentPath,t.data.sharedLinkInfo);case h.SharedWithActionType.SET_SHARED_FILE_DATA:return this._setSharedFileData(t.data.sharedFileData);case h.SharedWithActionType.CLEAR_SHARED_FOLDER_DATA_FOR_NS:return this._clearSharedFolderDataForNs(t.data.targetNs);case h.SharedWithActionType.REMOVE_SHARED_LINK_DATA:return this._removeSharedLinkData(t.data.parentPath,t.data.files)}},t.prototype._fillInMissingSharedLinkData=function(e){for(var t=e.parentPath,r=e.files,a=[],o=0,i=r;o<i.length;o++){var n=i[o];this.hasLinkDataForFile(n)||(this._filesWeHaveSharedLinkDataFor[n.fq_path]=!0,a.push(n))}return U.loadLinkDataForFiles({parentPath:t,fileFqPaths:a.map(function(e){return e.fq_path})}),U.loadLinkMetadata(a)},t.prototype._getHasSharedDataLoaded=function(){var e=g.path(f.getStoreForBrowse().getState());return e in this._hasSharedDataLoadedByContainingPath&&this._hasSharedDataLoadedByContainingPath[e]},t.prototype._setHasSharedDataLoaded=function(e){var t=g.path(f.getStoreForBrowse().getState());return this._hasSharedDataLoadedByContainingPath[t]=e},t.prototype._canBeSharedFile=function(e){return!(e.is_dir||e.isDeleted)},t.prototype._loadSharedFileData=function(e){void 0===e&&(e=!1),e&&(this._sharedFileDataByFileId={});for(var t=[],r=0,a=g.sortedFiles(f.getStoreForBrowse().getState()).toArray();r<a.length;r++){var o=a[r];!this._canBeSharedFile(o)||o.file_id in this._sharedFileDataByFileId||t.push(o.file_id)}return U.loadSharedFileDataForFiles({fileIds:t})},t.prototype._pathLoaded=function(e,t){this._setHasSharedDataLoaded(!1),U.loadSFDataForPath({parentPath:e,abortCurrentRequest:!0}),U.loadSFLinkDataForPath({parentPath:e}),this._loadSharedFileData(!0),this._filesAdded(e,t),this.emit_change()},t.prototype._filesAdded=function(e,t){this._fillInMissingSharedLinkData({parentPath:e,files:t}),this._loadSharedFileData(),this.emit_change()},t.prototype._filesChanged=function(e,t){e===g.path(f.getStoreForBrowse().getState())&&(U.loadSFDataForPath({parentPath:e}),U.loadSFLinkDataForPath({parentPath:e}),this.clearSharedLinkDataCache(),this._fillInMissingSharedLinkData({parentPath:e,files:t}),this._loadSharedFileData(!0),this.emit_change())},t.prototype._signalSharedFileDataOutOfDate=function(e){return U.loadSharedFileDataForFiles({fileIds:e})},t.prototype._signalSharedFolderDataOutOfDate=function(e){return null==e&&(e=g.path(f.getStoreForBrowse().getState())),U.loadSFDataForPath({parentPath:e})},t.prototype._signalSharedLinkDataOutOfDate=function(e,t){return null==e&&(e=g.path(f.getStoreForBrowse().getState())),U.loadSFLinkDataForPath({parentPath:e}),U.loadLinkDataForFiles({parentPath:e,fileFqPaths:t})},t.prototype._setNSSharedWithData=function(e,t){this._sharedFolderDataByTargetNs=e,this._hasSharedDataLoadedByContainingPath[t]=!0,this.emit_change()},t.prototype._setSharedLinkData=function(e,t){for(var r=this._sharedLinkDataMapsByFolderFQPath[e]||{},a=0,o=t;a<o.length;a++){var i=o[a],n=i.file,s=i.sharedLinkToken;r[this._sharedLinkKey(n)]=s}return this._sharedLinkDataMapsByFolderFQPath[e]=r,this.emit_change()},t.prototype._setSharedLinkInfoForParentPath=function(e,t){return this._sharedLinkInfoByPath[e]=t,this.emit_change()},t.prototype._setSharedFileData=function(e){this._sharedFileDataByFileId=r.__assign({},this._sharedFileDataByFileId,e),this.emit_change()},t.prototype._clearSharedFolderDataForNs=function(e){return delete this._sharedFolderDataByTargetNs[e],this.emit_change()},t.prototype._removeSharedLinkData=function(e,t){for(var r=this._sharedLinkDataMapsByFolderFQPath[e]||{},a=0,o=t;a<o.length;a++){var i=o[a];delete r[this._sharedLinkKey(i)]}return this._sharedLinkDataMapsByFolderFQPath[e]=r,this.emit_change()},t})(u.Store),L=new F;t.SharedWithStore=L,document.addEventListener(E.SharingApi.REQUEST_SUCCEEDED_EVENT,function(e,t){return t.request_url.indexOf("/share_ajax/leave")>-1?p.Dispatcher.dispatch({type:h.SharedWithActionType.CLEAR_SHARED_FOLDER_DATA_FOR_NS,data:{targetNs:t.ns_id}}):p.Dispatcher.dispatch({type:h.SharedWithActionType.SIGNAL_SHARED_FOLDER_DATA_OUT_OF_DATE,data:{parentPath:g.path(f.getStoreForBrowse().getState())}})});var U=(function(){function e(){}return e.loadLinkMetadata=function(e){var t=g.user(f.getStoreForBrowse().getState());if(R.TRUELINK.TRUELINK_BROWSE_LINK_ICON[t.id]&&R.TRUELINK.TRUELINK_UI[t.id]){var r=e.filter(function(e){return e.is_dir}).map(function(e){return"ns:"+e.ns_id+e.ns_path}),a=function(){if(0!==r.length){var e=r.slice(0,5);return r=r.slice(5),S.SharingActions.loadFolderLinkMetadataBatch(t,e,!1).then(a)}},o=e.filter(function(e){return!e.is_dir}).map(function(e){return e.file_id||e.fq_path}),i=function(){if(0!==o.length){var e=o.slice(0,5);o=o.slice(5),S.SharingActions.loadFileMetadataBatch(t,e).then(i)}};a(),i()}},e.loadSFDataForPath=function(t){var r=t.parentPath,a=t.abortCurrentRequest,o=void 0!==a&&a,i=g.user(f.getStoreForBrowse().getState());o&&null!=e._currentSFDataRequest&&e._currentSFDataRequest.abort(),e._currentSFDataRequest=l.WebRequest({url:"/share_ajax/shared_with",dataType:"json",subject_user:i,data:{max_results:5,fq_path_prefix:r,include_inherited:!0,sort_by_name:!0},success:function(e){for(var t={},a=0,o=e;a<o.length;a++){var i=o[a];t[i.ns_id]={numUndisplayableUsersAndInvites:i.num_avatars_not_shown,groups:i.groups,invitations:i.invitations,joinedMembers:i.joined_members,audienceDescription:i.audience_description,memberCount:i.num_users_and_invites}}return p.Dispatcher.dispatch({type:h.SharedWithActionType.SET_SHARED_FOLDER_DATA,data:{sharedFolderData:t,containingPath:r}})},complete:function(){e._currentSFDataRequest=null}})},e.loadSharedFileDataForFiles=function(e){var t=e.fileIds,r=g.user(f.getStoreForBrowse().getState());if(r.is_email_verified){var a=new y.FileShareApiClient({userId:r.id}),o=function(e){if(!e||0!==e.length){var t=e.slice(0,100),r=e.slice(100);return a.listMembersBatch({contentIds:t,limit:5}).then(function(e){var t={};if(e.forEach(function(e,r){return t[r]={numUndisplayableUsersAndInvites:0,groups:e.groups.valueSeq().map(I.apiGroupMemberToAvatarInfo).toArray(),invitations:e.invitees.valueSeq().map(I.apiInviteeMemberToAvatarInfo).toArray(),joinedMembers:e.users.valueSeq().map(I.apiUserMemberToAvatarInfo).toArray()}}),p.Dispatcher.dispatch({type:h.SharedWithActionType.SET_SHARED_FILE_DATA,data:{sharedFileData:t}}),r)return o(r)})}};return o(t)}},e.loadSFLinkDataForPath=function(e){var t=e.parentPath,r=g.user(f.getStoreForBrowse().getState());l.SilentBackgroundRequest({url:"/sm/get_token_info",dataType:"json",data:{paths:JSON.stringify([t])},subject_user:r,success:function(e){for(var r,a=0,o=e.shmodels;a<o.length;a++){var i=o[a];i.disabled||n.paths_are_equal(i.path,t)&&(r=i)}p.Dispatcher.dispatch({type:h.SharedWithActionType.SET_SHARED_LINK_INFO_FOR_PARENT_PATH,data:{parentPath:t,sharedLinkInfo:r}})}})},e.loadLinkDataForFiles=function(e){var t=e.parentPath,r=e.fileFqPaths,o=g.user(f.getStoreForBrowse().getState());if(!R.TRUELINK.TRUELINK_UI[o.id]){var i=function(e){if(0!==e.length){var r=e.slice(0,100),n=e.slice(100);l.SilentBackgroundRequest({url:"/sm/get_token_info",dataType:"json",data:{paths:JSON.stringify(r)},subject_user:o,success:function(e){for(var o,s=g.unsortedFiles(f.getStoreForBrowse().getState()),l=[],d=0,u=e.shmodels;d<u.length;d++){var c=u[d];c.disabled||(o=s.get(c.path),o&&l.push({file:o,sharedLinkToken:c}))}l.length&&p.Dispatcher.dispatch({type:h.SharedWithActionType.SET_SHARED_LINK_DATA,data:{parentPath:t,sharedLinkData:l}});for(var m,_=a.zipObject(a.map(e.shmodels,"path"),a.map(e.shmodels,function(){return!0})),S=[],E=0,y=r;E<y.length;E++){var b=y[E];b in _||(m=s.get(b),m&&S.push(m))}if(S.length&&p.Dispatcher.dispatch({type:h.SharedWithActionType.REMOVE_SHARED_LINK_DATA,data:{parentPath:t,files:S}}),n)return i(n)}})}};i(r)}},e._currentSFDataRequest=null,e})();t.SharedWithActions=U;var O=s.default({displayName:"SharedWithController",mixins:[c.default(L,A.sharingInfoStore)],propTypes:{browseContext:i.instanceOf(_.BrowseContext).isRequired,file:i.instanceOf(_.File),isInAudienceBox:i.bool,inSelectMode:i.bool,actionHandlers:i.object},_get_state_from_stores:function(e){var t,r=e.browseContext.currentFQPath,a=L.getDataForFile(e.file),o=L.getDataForPath(r);t=e.file?a.sharedLinkInfo:o.sharedLinkInfo;var i=A.sharingInfoStore.getSharingInfo(e.user.id,e.file&&e.file.fq_path),n=g.loadingState(f.getStoreForBrowse().getState())===m.LoadingState.LOADING_FIRST_PAGE;return{audienceDescription:null!=a&&a.audienceDescription,numUndisplayableUsersAndInvites:null!=a?a.numUndisplayableUsersAndInvites:0,groups:null!=a?a.groups:[],hasSharedDataLoaded:null!=a&&a.hasSharedDataLoaded&&!n,invitations:null!=a?a.invitations:[],joinedMembers:null!=a?a.joinedMembers:[],memberCount:null!=a?a.memberCount:0,sharedLinkInfo:null!=t?t:null,linkMetadata:null!=i&&i.linkMetadata()||null}},componentWillReceiveProps:function(e){return this.setState(this._get_state_from_stores(e))},handleMembershipClick:function(){var e=g.user(f.getStoreForBrowse().getState());if(!this.props.file&&g.context(f.getStoreForBrowse().getState()).isCurrentlyInRoot){var t=C.Viewer.get_viewer(),r=e.is_team&&!t.team_is_limited;return void(e.is_team_admin&&r?D.open_tab("/team/admin/members"):D.open_tab("/team#members"))}if((!this.props.file||!_.File.isTeamMemberFolder(this.props.file))&&(!this.props.file||_.File.canViewFileMembers(this.props.file,g.context(f.getStoreForBrowse().getState())))){var a=this.props.file||g.context(f.getStoreForBrowse().getState());return v.showShareModal(e,a,{browseContext:this.props.browseContext,origin:"BROWSE_FILE_ROW"},w.browseNavActions.setPath,w.browseNavActions.setUrl)}},handleSharedLinkClick:function(){var e=g.user(f.getStoreForBrowse().getState());return v.showShareModal(e,this.props.file,{browseContext:this.props.browseContext,origin:"BROWSE_FILE_ROW"},w.browseNavActions.setPath,w.browseNavActions.setUrl)},render:function(){var e=g.context(f.getStoreForBrowse().getState()),t=g.user(f.getStoreForBrowse().getState());if(e.isCurrentlyInRoot&&null==this.props.file&&!t.is_cdm_member)return null;var r=this.props.file?_.File.canViewFileMembers(this.props.file,e):e.canViewContainingNSMembers,a=t.is_cdm_member&&"/"===e.currentFQPath&&e.currentNSID===e.rootNSID;return o.default.createElement(T.SharedWithView,{user:t,file:this.props.file,onOverflowCountClick:this.handleMembershipClick,onAvatarClick:this.handleMembershipClick,groups:this.state.groups,invitations:this.state.invitations,joinedMembers:this.state.joinedMembers,numUndisplayableUsersAndInvites:this.state.numUndisplayableUsersAndInvites,memberCount:this.state.memberCount,parentFolderName:e.getNameOfTargetFolder(),animation:!1,avatarDimension:d.AVATAR_DIMENSION_BY_SIZE.MEDIUM,maxVisibleAvatars:5,sharedLinkInfo:this.state.sharedLinkInfo,onSharedLinkClick:this.handleSharedLinkClick,publicFolderSharing:this.props.file&&b.shouldUsePublicFolderSharing(this.props.browseContext||{},this.props.file.fq_path),isCdmRoot:a,inSelectMode:this.props.inSelectMode,isInAudienceBox:this.props.isInAudienceBox,audienceDescription:this.state.audienceDescription,hasSharedDataLoaded:this.state.hasSharedDataLoaded,canViewMembers:r&&!e.isInsideDeletedFolder,inContentManagerCdmRoot:!1,linkMetadata:this.state.linkMetadata})}});t.SharedWithController=O}),define("modules/clean/react/browse/shared_with_view",["require","exports","tslib","external/classnames","external/create-react-class","react","external/react-dom-factories","modules/clean/avatar/size","modules/clean/components/loading_indicator","modules/clean/components/title_bubble","modules/clean/em_string","modules/clean/sharing/api/types/metadata","modules/clean/sharing/constants","modules/clean/sharing/member_avatars","modules/clean/static_urls","modules/clean/user_education/react/user_education_effect","modules/constants/sharing","modules/core/i18n"],function(e,t,r,a,o,i,n,s,l,d,u,p,c,h,m,_,f,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=r.__importDefault(a),o=r.__importDefault(o),i=r.__importDefault(i),n=r.__importStar(n),d=r.__importDefault(d);var S=i.default.createElement,E=s.AVATAR_DIMENSION_BY_SIZE.SMALL,y=g._("No access"),b=g._("Limited access"),v=o.default({displayName:"SharedWithView",mixins:[h.MemberAvatarsMixin],getDefaultProps:function(){return{titleButtonDirection:"south",avatarDimension:E,maxVisibleAvatars:5,file:void 0,canViewMembers:!0,inContentManagerCdmRoot:!1,inSelectMode:!1,memberCount:0,isCdmRoot:!1,joinedMembers:[]}},render:function(){if(this.props.inContentManagerCdmRoot){if(0===this.props.groups.length)return n.div({});var e=this.props.groups[0].num_users;return n.div({className:"audience-description",onClick:function(e){return e.preventDefault(),e.stopPropagation()}},g.ungettext("%(num)s member","%(num)s members",e).format({num:e}))}return this.props.isInAudienceBox?this.props.canViewMembers?this.props.file&&this.props.file.isDeleted?null:n.div({className:this.getClassName()},this.props.hasSharedDataLoaded?S(_.UserEducationEffect,{containerName:this.constructor.displayName,name:"AudienceBoxAvatars"},this.renderAudienceBoxAvatars()):S(l.LoadingIndicator,{style:l.LoadingIndicator.LoadingIndicatorStyle.DOTS})):null:n.div({className:this.getClassName()},this._hasSharedLink()?this.renderSharedLinkInColumn():void 0,this.renderAudienceDescription())},getClassName:function(){return a.default({"shared-with-members":!0,clearfix:!0,"audience-box u-pad-top-xs u-pad-bottom-s u-mar-bottom-xs":this.props.isInAudienceBox})},renderSharedLinkInColumn:function(){var e=this.props.onSharedLinkClick,t=this.props.inSelectMode;return S(d.default,{key:"shared_link",text:this.getDescriptionForSharedLinkInfo(this.props.sharedLinkInfo,this.props.linkMetadata),direction:this.props.titleButtonDirection,className:"audience-description__link-avatar"},n.img({src:m.static_url("/static/images/avatar/shared-link-icon-vflHCU_m6.svg"),alt:this.props.alt||g._("Shared link"),width:12,height:12,onClick:function(r){if(!t)return e(),r.preventDefault(),r.stopPropagation()}}))},renderAudienceDescription:function(){var e,t;if(!this.props.hasSharedDataLoaded)return null;if(this.props.file&&this.props.file.isDeleted)e=g._("Deleted");else if(this.props.canViewMembers)this.props.audienceDescription&&(e=this.props.audienceDescription);else{var r=this.props.file._mount_access_perms,a=r&&r.includes("can_view");e=a?b:y}var o=(this.props.groups||[]).concat(this.props.joinedMembers||[]).concat(this.props.invitations||[]),i=o.length+(this.props.numUndisplayableUsersAndInvites||0),s=this.findOwnerAndMeInJoinedMembers(this.props.joinedMembers||[])[0];if(i>=0&&(1!==i||!s)){e||(e=g.ungettext("%(num)s member","%(num)s members",this.props.memberCount).format({num:this.props.memberCount}));var l=o.slice(0,this.props.maxVisibleAvatars),p=l.map(function(e){return u.Emstring.em_snippet(e.display_name||e.email||e.name||e.email_or_fbname,c.SNIPPET_SIZES.DISPLAY_NAME)});if(i>this.props.maxVisibleAvatars){p.pop();var h=i-(this.props.maxVisibleAvatars-1),m=g.ungettext("and %(num)s more...","and %(num)s more...",h,{comment:"Number of additional members in the file. Expected to be >= 2."}).format({num:h});p.push(m)}t=p.join("\n")}this.props.publicFolderSharing&&this.props.file&&!this.props.file.is_dir?e||(e=g._("Anyone")):e||(e=g._("Only you",{project:"sharing"}));var _=this.props.onAvatarClick,f=this.props.inSelectMode,E=null!=this.props.file?this.props.file.isDeleted:void 0,v=n.div({className:"audience-description",onClick:function(e){if(!f&&!E)return _(),e.preventDefault(),e.stopPropagation()}},e);return t?S(d.default,{key:"membership_column_bubble",respectLineBreaks:!0,text:t,direction:this.props.titleButtonDirection},v):v},renderAudienceBoxAvatars:function(){var e=[],t=this.props.joinedMembers?this.props.joinedMembers:[],r=this.props.groups?this.props.groups.slice():[],a=this.props.invitations?this.props.invitations.slice():[];this._addSharedLinkIfExists(e);var o=[],i=this.findOwnerAndMeInJoinedMembers(t),s=i[1];if(s&&(o.push(s.user_id),e.push(h.renderJoinedMember({arePairedUsersInSF:this.state.paired_users_in_sf,member:s,avatarArgs:{avatarDimension:this.props.avatarDimension,onAvatarClick:this.props.onAvatarClick,titleButtonDirection:this.props.titleButtonDirection}}))),this.addGroupsMembersInvitations(e,r,t,a,o),1===e.length&&s){if(this.props.user.is_team_admin&&this.props.isCdmRoot){for(var l=1;l<=this.props.maxVisibleAvatars-1;l++)e.push(h.renderPlaceholderAvatar({index:l,description:g._("Invite"),avatarArgs:{onAvatarClick:this.props.onAvatarClick,avatarDimension:this.props.avatarDimension,titleButtonDirection:this.props.titleButtonDirection}}));return this.renderAvatarList(e)}var d=void 0;return d=this._hasSharedLink()?this.getDescriptionForSharedLinkInfo(this.props.sharedLinkInfo,this.props.linkMetadata):g._("Only you have access"),n.div({className:"audience-box--text-only"},d)}return this.renderAvatarList(e)},_addSharedLinkIfExists:function(e){return this._hasSharedLink()?f.TRUELINK.TRUELINK_UI[this.props.user.id]?e.push(this.renderSharedLink(null,this.props.linkMetadata)):e.push(this.renderSharedLink(this.props.sharedLinkInfo)):null},_hasSharedLink:function(){return f.TRUELINK.TRUELINK_UI[this.props.user.id]?this.props.linkMetadata&&this.props.linkMetadata.current_audience!==p.LinkAudience.members:Boolean(this.props.sharedLinkInfo)}});t.SharedWithView=v}),define("modules/clean/react/file_modal_controller",["require","exports","tslib","react","modules/clean/filepath","modules/clean/react/file_modals","modules/clean/react/modal","modules/clean/sharing/browse_exports"],function(e,t,r,a,o,i,n,s){"use strict";function l(e,t,r){var o=a.default.createElement(i.PermanentlyDeleteModal,{files:t,userId:e.id,onDelete:r});n.Modal.showInstance(o)}function d(e,t,r,o,s){var l=r.isInsideSharedFolder||r.isNonUserRelativeContext&&r.isCurrentlyInRoot,d=r.isNonUserRelativeContext,u=a.default.createElement(i.DeleteFileModal,{files:t,user:e,isNonUserRelativeContext:d,parentSharedFolderName:l?o:null,onDelete:s});n.Modal.showInstance(u)}function u(e,t,r){var o=a.default.createElement(i.ContentManagerBridgeModal,{files:e,type:t,isLimitedTeam:r});n.Modal.showInstance(o)}function p(e,t,r){var l=a.default.createElement(i.NoAccessFolderModal,{folderName:o.filename(t.fq_path),folderPath:t.fq_path,userIsSameTeam:!(!e.team_dbtid||!r.teamFolderOwnerTeamApiId||e.team_dbtid!==r.teamFolderOwnerTeamApiId),userIsSuperAdmin:s.GoldenGate.hasContentManagerAndSuperAdmin(e.id)});n.Modal.showInstance(l)}function c(e){var t=a.default.createElement(i.ConfirmOwnershipTransferModal,{onAccept:e});n.Modal.showInstance(t)}function h(e){n.Modal.showInstance(a.default.createElement(i.FileSystemWarningsModal,r.__assign({},e)))}function m(e){n.Modal.showInstance(a.default.createElement(i.MoveErrorModal,r.__assign({},e)))}Object.defineProperty(t,"__esModule",{value:!0}),a=r.__importDefault(a),o=r.__importStar(o),t.showPermanentlyDelete=l,t.showDelete=d,t.showContentManagerBridge=u,t.showNoAccess=p,t.showConfirmOwnershipTransferModal=c,t.showFileSystemWarningsModal=h,t.showMoveErrorModal=m}),define("modules/clean/react/file_modals",["require","exports","tslib","react","spectrum/button","spectrum/modal","modules/clean/em_string","modules/clean/filepath","modules/clean/filetypes","modules/clean/react/browse/action_logger","modules/clean/react/css","modules/clean/react/modal","modules/clean/react_format","modules/clean/sharing/browse_exports","modules/clean/sharing/constants","modules/clean/web_user_action_events","modules/core/browser","modules/core/i18n","modules/clean/ux_analytics_utils","modules/clean/viewer"],function(e,t,r,a,o,i,n,s,l,d,u,p,c,h,m,_,f,g,S,E){"use strict";function y(){var e=document.querySelector(".mc-util-modal-actions-buttons .mc-button-primary");e&&e.focus()}function b(t){var a=function(){return I(t)},o=t.userId,i=t.context,n=t.files;new Promise(function(t,r){e(["modules/clean/react/trash/trash_modal_util"],t,r)}).then(r.__importStar).then(function(e){(0,e.openTrashModalFromBrowseFiles)({userId:o,context:i,files:n,onRestore:a})})}function v(t){var a=t.userId,o=t.context,i=t.files,n=function(){return A(t)};new Promise(function(t,r){e(["modules/clean/react/trash/trash_modal_util"],t,r)}).then(r.__importStar).then(function(e){(0,e.openPurgeModalFromBrowseFiles)({userId:a,context:o,files:i,onPurge:n})})}Object.defineProperty(t,"__esModule",{value:!0}),a=r.__importDefault(a),s=r.__importStar(s),f=r.__importStar(f);var T=(function(e){function t(t){var r=e.call(this,t)||this;return r.handleAccept=function(){d.logFileOperationModalClick({uid:r.props.userId,event_name:_.WebUserActionLogEvent.PERMANENT_DELETE_ACCEPT_CLICK}),r.props.onDelete()},r.handleCancel=function(){r.setState({isModalOpen:!1})},r.onModalReady=function(){y()},r.state={isModalOpen:!0},r}return r.__extends(t,e),t.prototype.isSingleSharedFolder=function(e){return 1===e.length&&e[0].type===l.FileTypes.SHARED_FOLDER},t.prototype.getTitle=function(e){var t=e.length;return this.isSingleSharedFolder(e)?g._("Remove access to folder?"):g.ungettext("Permanently delete %(num)s file?","Delete %(num)s items permanently?",t).format({num:t})},t.prototype.renderContent=function(e){var t=e.length;if(1===t){var r=s.filename(e[0].fq_path);return this.isSingleSharedFolder(e)?c.reactFormat(g._("Are you sure you want to remove your access to <strong>%(filename)s</strong>? It will no longer be viewable in your list of shared folders, and you won’t be able to re-add it to your Dropbox unless you’re re-invited."),{strong:a.default.createElement("strong",null),filename:r}):c.reactFormat(g._("Are you sure you want to delete <strong>%(filename)s</strong> from your Dropbox permanently?"),{strong:a.default.createElement("strong",null),filename:r})}return a.default.createElement("span",null,g.ungettext("Are you sure you want to permanently delete %(num)s item from your Dropbox?","Are you sure you want to permanently delete %(num)s items from your Dropbox?",t).format({num:t}))},t.prototype.render=function(){var e=this.getTitle(this.props.files);return a.default.createElement(i.UtilityModal,{ariaLabel:e,title:e,primaryAction:this.isSingleSharedFolder(this.props.files)?g._("Remove my access"):g._("Delete permanently"),secondaryAction:g._("Cancel"),onPrimaryAction:this.handleAccept,open:this.state.isModalOpen,shouldRequestCloseOnActions:!0,overlayClickClose:!0,onRequestClose:this.handleCancel,displayCloseButton:!0,onReady:this.onModalReady},this.renderContent(this.props.files))},t})(a.default.Component);t.PermanentlyDeleteModal=T;var A=function(e){var t=e.files,r=e.context,a=e.userId,o=e.onPurge;t||(t=[{fq_path:r.currentFQPath,ns_path:r.currentNSPath,ns_id:r.currentNSID}]),o(a,t)},I=function(e){var t=e.files,r=e.context,a=e.userId,o=e.onRestore;t||(t=[{fq_path:r.currentFQPath,ns_path:r.currentNSPath,ns_id:r.currentNSID}]),o(a,t)};t.showUnifiedTrashModal=b,t.showPurgeModal=v;var R=(function(e){function t(t){var r=e.call(this,t)||this;return r.getViewerTeamNameStr=function(){var e=E.Viewer.get_viewer().team_name;return e?"‘"+e+"’ ":""},r.handleAccept=function(){d.logFileOperationModalClick({uid:r.props.user.id,event_name:_.WebUserActionLogEvent.DELETE_ACCEPT_CLICK}),r.props.onDelete(),S.dispatchModalClosed()},r.handleCancel=function(){r.setState({isModalOpen:!1}),S.dispatchModalClosed()},r.onModalReady=function(){y(),S.dispatchModalOpened()},r.isRemovingSharedFolder=function(){return 1===r.props.files.length&&r.props.files[0].target_ns},r.getTitle=function(){var e=r.props.files;return e.length<1?"":1===e.length?e[0].is_dir?g._("Delete folder?"):g._("Delete file?"):g.ungettext("Delete %(item_count)s item?","Delete %(item_count)s items?",e.length).format({item_count:e.length})},r.isTsdPlusOne=function(){var e=r.props,t=e.user,a=e.files;return!(!t||!a||0===a.length)&&(t.is_cdm_member&&a[0].ns_id===t.root_ns_id&&2===a[0].ns_path.split("/").length)},r.getContents=function(){var e=r.props,t=e.user,o=e.files;if(!t||!o||0===o.length)return"";var i=t.is_cdm_member,n=s.filename(o[0].fq_path),l=o[0].target_ns,d=r.props,u=d.parentSharedFolderName,p=d.isNonUserRelativeContext,h=r.isTsdPlusOne(),m={filename:n,shared_folder_name:u,b:a.default.createElement("b",{className:"file-modal-file-name"}),item_count:o.length,team_name:r.getViewerTeamNameStr()},_=""
;return _=null!=r.props.parentSharedFolderName?1===o.length?h?g._("Are you sure you want to delete <b>%(filename)s</b> from your %(team_name)sworkspace?"):g._("Are you sure you want to delete <b>%(filename)s</b> from the shared folder ‘%(shared_folder_name)s’?"):h?g._("Are you sure you want to delete %(item_count)s items from your %(team_name)sworkspace?"):g._("Are you sure you want to delete %(item_count)s items from the shared folder ‘%(shared_folder_name)s’?"):1===o.length&&l&&!p?i?g._("Are you sure you want to remove the shared folder <b>%(filename)s</b> from your team member folder? This shared folder will stay shared with other members and you can re-add it later."):g._("Are you sure you want to remove the shared folder <b>%(filename)s</b> from your Dropbox? This shared folder will stay shared with other members and you can re-add it later."):1===o.length?i?g._("Are you sure you want to delete <b>%(filename)s</b> from your team member folder?"):g._("Are you sure you want to delete <b>%(filename)s</b> from your Dropbox?"):i?g._("Are you sure you want to delete %(item_count)s items from your team member folder?"):g._("Are you sure you want to delete %(item_count)s items from your Dropbox?"),c.reactFormat(_,m)},r.state={isModalOpen:!0},r}return r.__extends(t,e),t.prototype.render=function(){var e=this.getTitle();return a.default.createElement(i.UtilityModal,{ref:"modal",title:e,ariaLabel:e,primaryAction:this.isRemovingSharedFolder()&&!this.props.isNonUserRelativeContext?g._("Remove"):g._("Delete"),secondaryAction:g._("Cancel"),onPrimaryAction:this.handleAccept,shouldRequestCloseOnActions:!0,displayCloseButton:!0,overlayClickClose:!0,onRequestClose:this.handleCancel,open:this.state.isModalOpen,onReady:this.onModalReady},a.default.createElement("div",{className:"uxa-modal",id:"delete-file-modal"},this.getContents()))},t.defaultProps={parentSharedFolderName:null,isNonUserRelativeContext:!1},t})(a.default.Component);t.DeleteFileModalWithoutCss=R;var D=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleAccept=function(){var e=t.props.files[0].fq_path;h.asyncGoToContentManagerForPath({isLimitedTeam:t.props.isLimitedTeam,containingFolder:s.parent_dir(e),filenameToSelect:s.filename(e),isCDM:!1})},t}return r.__extends(t,e),t.prototype.getModalMessage=function(){return"archive"===this.props.type?g._("You can archive team folders in the Admin Console."):"rename"===this.props.type?g._("You can rename team folders in the Admin Console."):void 0},t.prototype.render=function(){return a.default.createElement(p.Modal,{ref:"modal",style:"clean",onAccept:this.handleAccept,acceptButtonText:g._("Go to Admin Console"),altAction:a.default.createElement("a",{onClick:function(){return p.Modal.close()}},g._("Cancel")),width:350,showX:!1,className:"content-manager-bridge-modal"},this.getModalMessage())},t})(a.default.Component);t.ContentManagerBridgeModal=D;var w=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleAcceptClick=function(){t.props.userIsSuperAdmin&&t.props.userIsSameTeam&&h.asyncGoToContentManagerForPath({isLimitedTeam:!1,containingFolder:t.props.folderPath,isCDM:!0})},t}return r.__extends(t,e),t.prototype.render=function(){var e=this.props.userIsSuperAdmin&&this.props.userIsSameTeam,t="";return t=e?g._("You aren’t a member of this folder. However, as an admin, you can access it via the content tab in the Admin Console."):this.props.userIsSameTeam?g._("You don’t have permission to open the folder “%(folder_name)s”. Contact your <admin_link>team admins</admin_link> to gain access."):g._("You don’t have permission to open the folder “%(folder_name)s”."),a.default.createElement(p.Modal,{ref:"modal",style:"default",acceptButtonText:e?g._("Go to the content tab"):g._("Done"),dismissButtonText:e?g._("Cancel"):null,onAccept:this.handleAcceptClick,title:g._("No access to the folder “%(folder_name)s”").format({folder_name:n.Emstring.em_snippet(this.props.folderName,m.SNIPPET_SIZES.FILENAME)})},a.default.createElement("div",null,c.reactFormat(t,{folder_name:n.Emstring.em_snippet(this.props.folderName,m.SNIPPET_SIZES.FILENAME),admin_link:a.default.createElement("a",{href:"/team?_tk=left_nav_team#members",target:"_blank",key:"admin_link",rel:"noopener noreferrer"})})))},t})(a.default.Component);t.NoAccessFolderModal=w;var C=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleAcceptAndCloseModal=function(){t.props.onAccept(),p.Modal.close()},t}return r.__extends(t,e),t.prototype.render=function(){var e=g._("If you make this move, you'll no longer be the owner of some of the folders.");return a.default.createElement(p.Modal,{ref:"modal",style:"default",onAccept:this.handleAcceptAndCloseModal,acceptButtonText:g._("Move items anyways"),dismissButtonText:g._("Cancel"),title:g._("Move items?")},a.default.createElement("div",null,e))},t})(a.default.Component);t.ConfirmOwnershipTransferModal=C;var F=(function(e){function t(t){var r=e.call(this,t)||this;return r.handleAccept=function(){r.state.fswIndex+1===r.props.fsws.length?(r.getCurrentFSW().blocking?r.props.onAbortAction&&r.props.onAbortAction():r.props.onFinalAccept(),r.setState({isModalOpen:!1})):r.setState({fswIndex:r.state.fswIndex+1})},r.handleCancel=function(){r.props.onAbortAction&&r.props.onAbortAction(),r.setState({isModalOpen:!1})},r.redirectToLearnMoreLink=function(){f.open_tab(r.getCurrentFSW().learn_more)},r.cancelButtonCreator=function(e){return r.getCurrentFSW().blocking?a.default.createElement("span",null):a.default.createElement(o.Button,{onClick:e,variant:"secondary"},g._("Cancel"))},r.state={isModalOpen:!0,fswIndex:0},r}return r.__extends(t,e),t.prototype.getCurrentFSW=function(){return this.props.fsws[this.state.fswIndex]},t.prototype.render=function(){if(this.state.fswIndex>this.props.fsws.length)return null;var e=this.getCurrentFSW(),t=e.confirm_text?e.confirm_text:this.props.confirmText;return a.default.createElement(i.UtilityModal,{ariaLabel:e.title,className:"fsw-modal",link:g._("Learn more"),onLink:this.redirectToLearnMoreLink,onPrimaryAction:this.handleAccept,onSecondaryAction:this.handleCancel,open:this.state.isModalOpen,overlayClassName:"fsw-modal--overlay",primaryAction:e.blocking?g._("Okay"):t,secondaryAction:this.cancelButtonCreator,title:e.title},e.text)},t})(a.default.Component);t.FileSystemWarningsModalWithoutCSS=F,t.FileSystemWarningsModal=u.requireCssWithComponent(F,["/static/css/react/file_modal-vflJkyHFy.css"]),t.DeleteFileModal=u.requireCssWithComponent(R,["/static/css/react/file_modal-vflJkyHFy.css"]);var L=(function(e){function t(t){var r=e.call(this,t)||this;return r.handleClose=function(){r.setState({isModalOpen:!1})},r.handleCancel=function(){null!=r.props.buttonString&&(r.setState({isModalOpen:!1}),r.props.onClick())},r.redirectToLearnMoreLink=function(){f.open_tab(r.props.learnMoreLink)},r.state={isModalOpen:!0},r}return r.__extends(t,e),t.prototype.render=function(){return a.default.createElement(i.UtilityModal,{ariaLabel:this.props.title,className:"move-error-modal",link:g._("Learn more"),onLink:this.redirectToLearnMoreLink,onPrimaryAction:this.handleClose,onSecondaryAction:this.handleCancel,open:this.state.isModalOpen,primaryAction:g._("OK"),secondaryAction:this.props.buttonString,title:this.props.title},this.props.content)},t})(a.default.Component);t.MoveErrorModalWithoutCss=L,t.MoveErrorModal=u.requireCssWithComponent(L,["/static/css/react/file_modal-vflJkyHFy.css"])}),define("modules/clean/react/file_uploader/actions",["require","exports","tslib","modules/core/cookies","modules/core/exception","modules/core/i18n","modules/clean/ajax","modules/clean/filepath","modules/clean/web_upload_action_events","modules/clean/flux/dispatcher","modules/clean/react/async_file_modal_controller","modules/clean/react/browse/action_logger","modules/clean/react/file_uploader/action_logger","modules/clean/react/file_uploader/constants","modules/clean/react/file_uploader/plu_wrapper","modules/clean/react/file_uploader/store","modules/clean/react/file_uploader/utils"],function(e,t,r,a,o,i,n,s,l,d,u,p,c,h,m,_,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),s=r.__importStar(s),u=r.__importStar(u),c=r.__importStar(c),m=r.__importDefault(m),t.UploaderDispatcher=d.Dispatcher;var g=["1password","abbu","agilekeychain","aplibrary","app","band","cmproj","dvdproj","fcpbundle","gameproj","graffle","imovielibrary","imovieproject","itlp","key","logic","logicx","lpdf","lrdata","mindnode","mindnode","mpkg","numbers","pages","photolibrary","rcproject","rtfd","screenflow","scriv","sketch","theater","xcodeproj","xd","ydevice","bundle","framework","plugin","kext","pkg"],S=(function(){function e(){}return e.prototype.initPLU=function(e){var t=this,r=e.chooseDestination,a=void 0!==r&&r,S=e.isContentManager,E=void 0!==S&&S,y=e.rootNSIDForCM,b=e.expUploadWithFolderPicker,v=void 0!==b&&b,T=e.expWebUploadsWithWaterfall,A=void 0!==T&&T,I=e.expWebUploadsInvalidExtensionWarningModal,R=void 0!==I&&I;if(this.useWaterfallUploads=!!A&&!E,!m.default.isInitialized){m.default.init(E,A,R);var D=a?function(e,r){t.setPath({path:e}),void 0!==r&&t.setFolderNsId({folderNsId:r})}:void 0,w=function(){t.setFolderNsId({folderNsId:null})};m.default.onBeforeFilesAdded(),m.default.onFilesAdded({isContentManager:E,rootNSIDForCM:y,setPathAndFolderNsId:D,resetFolderNsId:w,expUploadWithFolderPicker:v,cb:function(e){var r=_.uploaderStore.user();a&&t.setIsUploadModalOpen({isUploadModalOpen:!1});for(var o=[],n=0,u=e;n<u.length;n++){var p=u[n];null==p.size&&o.push(p)}for(var m=0,f=o;m<f.length;m++){var S=f[m];d.Dispatcher.dispatch({type:h.UploaderActionType.ADD_NEW_FAILED_FILE,data:{file:S,errorType:h.UploadErrorType.EMPTY_OR_FOLDER,errorMessage:i._("This folder or empty file could not be uploaded                             because of browser limitations. Try zipping up                             the content before uploading it, or use the                             Dropbox desktop client to sync it.")}}),t._broadcastUploadErrored(S);var E=_.uploaderStore.uploadById(S.uploadId);c.logUploadAction(r.id,l.WebUploadActionEvent.UPLOAD_FAILURE,E)}e=e.filter(function(e){return null!=e.size});for(var y=function(e){return g.includes(s.file_extension(e.name))&&e.size%34===0},b=[],v=0,T=e;v<T.length;v++){var p=T[v];y(p)&&b.push(p)}for(var A=0,I=b;A<I.length;A++){var R=I[A];d.Dispatcher.dispatch({type:h.UploaderActionType.ADD_NEW_FAILED_FILE,data:{file:R,errorType:h.UploadErrorType.PACKAGE_FILE,errorMessage:i._("This file is a package file and can’t be                             uploaded directly. To upload a package file via                             the web, try zipping it first.")}}),t._broadcastUploadErrored(R);var E=_.uploaderStore.uploadById(R.uploadId);c.logUploadAction(r.id,l.WebUploadActionEvent.UPLOAD_FAILURE,E)}e=e.filter(function(e){return!y(e)}),o.length&&t.cancelUploads({files:o}),b.length&&t.cancelUploads({files:b}),d.Dispatcher.dispatch({type:h.UploaderActionType.QUEUE_UPLOADS,data:{files:e}}),t._startNextUploadIfAvailable()}}),m.default.onUploadProgress(function(e,t){if(!_.uploaderStore.isUploadCancelled(e.uploadId)){var r=e.percentUploaded;o.assert(null!=_.uploaderStore.currentUpload(),"UploaderStore.currentUpload() is null");var a=r*_.uploaderStore.currentUpload().size/100,i=f.calculateSizeOfUploads(_.uploaderStore.fileList(),[h.FileStatusType.COMPLETE]),n=a+i,s=f.calculateSizeOfUploads(_.uploaderStore.fileList(),[h.FileStatusType.COMPLETE,h.FileStatusType.PENDING,h.FileStatusType.UPLOADING]),l=m.default.bytesPerSec(),u=_.uploaderStore.fileList().count(function(e){return e.status===h.FileStatusType.PENDING||e.status===h.FileStatusType.UPLOADING});d.Dispatcher.dispatch({type:h.UploaderActionType.SET_CURRENT_UPLOAD_PROGRESS,data:{percentComplete:r,numSecondsLeft:t?(s-n)/l+u:void 0}})}}),m.default.onFileUploaded(function(e,r){if(!_.uploaderStore.isUploadCancelled(e.uploadId)){t.setInlineStatusShouldBeDismissed({inlineStatusShouldBeDismissed:!1});var a=void 0,n=!1,s=!1,u=!1,p=!1,f=void 0,g=void 0,S=_.uploaderStore.user();try{a=JSON.parse(r.response),s=!!a&&!!a.error,u=!!a&&"ignored"===a.error,p=!!a&&"invalid_extension"===a.error}catch(e){o.reportException({err:e,severity:o.SEVERITY.NONCRITICAL}),n=!0}if(u?(f=h.UploadErrorType.IGNORED,g=i._("This file was skipped because it’s an internal system file.")):p?(f=h.UploadErrorType.INVALID_EXTENSION,g=i._("This file was skipped because files of this type cannot be uploaded.")):(f=h.UploadErrorType.GENERIC,g=void 0),n||s||u||p){m.default.removeFiles({files:[e]}),d.Dispatcher.dispatch({type:h.UploaderActionType.UPLOAD_ERROR,data:{uploadId:e.uploadId,errorType:f,errorMessage:g}}),t._broadcastUploadErrored(e);var y=_.uploaderStore.uploadById(e.uploadId);c.logUploadAction(S.id,l.WebUploadActionEvent.UPLOAD_FAILURE,y)}else o.assert(!!a,"unable to parse file uploaded response"),o.assert(!!a&&"complete"===a.status,"response status is not complete"),E&&(o.assert(!!a&&a.total_size===e.size,"response total size does not equal file size"),o.assert(!!a&&a.upload_id===e.uploadId,"response body upload ID does not equal the file uploadId")),d.Dispatcher.dispatch({type:h.UploaderActionType.COMPLETE_UPLOAD,data:{uploadId:e.uploadId}}),t._broadcastUploadComplete(e),c.logUploadAction(S.id,l.WebUploadActionEvent.UPLOAD_FILE,e);t._startNextUploadIfAvailable()}}),m.default.onUploadComplete(function(){var e=_.uploaderStore.fileList().valueSeq().filter(function(e){return e.status===h.FileStatusType.COMPLETE}).toArray();t._broadcastAllUploadsComplete(e)}),m.default.onError(function(e,r,a){_.uploaderStore.fileList().has(e.uploadId)?(d.Dispatcher.dispatch({type:h.UploaderActionType.UPLOAD_ERROR,data:{uploadId:e.uploadId,errorType:r,errorMessage:a}}),t._broadcastUploadErrored(e)):(d.Dispatcher.dispatch({type:h.UploaderActionType.ADD_NEW_FAILED_FILE,data:{file:e,errorType:r,errorMessage:a}}),t._broadcastUploadErrored(e)),r!==h.UploadErrorType.OVER_QUOTA_ERROR&&r!==h.UploadErrorType.LOCKED_TEAM_ERROR||d.Dispatcher.dispatch({type:h.UploaderActionType.SET_HAS_OVERQUOTA_ERROR,data:{hasOverquotaError:!0}}),t._startNextUploadIfAvailable()}),m.default.onBeforeUpload(function(e,r){var a=i._("Something went wrong while uploading this file. There was a       server error during the upload request.");if(_.uploaderStore.confirmedFSWBatchIds().filter(function(t){return e.batchId===t}).length)return void r();var o={path:e.dest,to_path:e.name,fsw_request:"check",_subject_uid:e.userId};return t.ajaxInterceptor&&(o=t.ajaxInterceptor.interceptUploadPrecheck(o)),n.SilentBackgroundRequest({url:"/cmd/upload_precheck",data:o,success:function(o){var n,s=!1,l=!1;try{n=JSON.parse(o),s=!(!n||!n.failure_details),l=!(!n||!n.error||"invalid_character"!==n.error)}catch(r){return void t.manuallySetInErrorState({file:e,errorType:h.UploadErrorType.UPLOAD_PRECHECK_ERROR,errorMessage:a})}if(l){var c=i._("Something went wrong while uploading this file. The filename             contains an invalid character.");return void t.manuallySetInErrorState({file:e,errorType:h.UploadErrorType.UPLOAD_PRECHECK_INVALID_CHAR_ERROR,errorMessage:c})}if(s){var m=n.failure_details.filter(function(e){return!_.uploaderStore.confirmedFSWs().includes(e.id)});if(0===m.length)return void r();p.logFileUploadFSWReturned({uid:e.userId,file_name:e.name,upload_id:e.uploadId,filtered_fsw_ids:m.map(function(e){return e.id}).join(","),all_fsw_ids:n.failure_details.map(function(e){return e.id}).join(",")});var f=function(){var e=_.uploaderStore.fileList().valueSeq().toArray().filter(function(e){return e.status===h.FileStatusType.PENDING||e.status===h.FileStatusType.UPLOADING});t.cancelUploads({files:e}),t.setIsUploadModalOpen({isUploadModalOpen:!1})},g=function(){t.setIsUploadModalOpen({isUploadModalOpen:!1}),r(),d.Dispatcher.dispatch({type:h.UploaderActionType.CONFIRM_FSW,data:{fswIds:m.map(function(e){return e.id}),batchId:e.batchId}})};u.showFileSystemWarningsModal({confirmText:i._("Upload"),fsws:m,onFinalAccept:g,onAbortAction:f})}else d.Dispatcher.dispatch({type:h.UploaderActionType.CONFIRM_FSW,data:{fswIds:[],batchId:e.batchId}}),r()},error:function(){t.manuallySetInErrorState({file:e,errorType:h.UploadErrorType.UPLOAD_PRECHECK_ERROR,errorMessage:a})}})})}},e.prototype.setPath=function(e){var t=e.path,r=e.hasPermissionToUploadToFolder,a=void 0===r||r;t===_.uploaderStore.path()&&a===_.uploaderStore.hasPermissionToUploadToFolder()||d.Dispatcher.dispatch({type:h.UploaderActionType.SET_PATH,data:{path:t,hasPermissionToUploadToFolder:a}})},e.prototype.setFolderNsId=function(e){var t=e.folderNsId;d.Dispatcher.dispatch({type:h.UploaderActionType.SET_FOLDER_NS_ID,data:{folderNsId:t}})},e.prototype.setUser=function(e){var t=e.user;d.Dispatcher.dispatch({type:h.UploaderActionType.SET_USER,data:{user:t}})},e.prototype.setNumDraggingFiles=function(e){var t=e.numDraggingFiles,r=e.isInternalTransfer,a=void 0!==r&&r;d.Dispatcher.dispatch({type:h.UploaderActionType.SET_NUM_DRAGGING_FILES,data:{numDraggingFiles:t,isInternalTransfer:a}})},e.prototype.addFilesToPLU=function(e){var t=e.files,r=e.path,a=e.dropTarget;m.default.addFiles({files:t,path:r}),this._broadcastUploadBegin(t,a),this.setInlineStatusShouldBeDismissed({inlineStatusShouldBeDismissed:!1})},e.prototype.addDirectoriesToPLU=function(e){for(var t=e.directoryEntries,r=e.batchId,a=e.onFinish,o=[],n=[],u=0,p=function(){var e=function(){if(o.length>0){var t=o.pop();if(t){var i=t.entry,s=t.dest;if(i&&i.file)return i.file(function(t){var a=t;a.batchId=r,n.push({entry:a,dest:s}),e()})}}else a(n)};e()},m=function(e){if(u+=1,e&&e.createReader){var t=e.createReader(),r=function(){return t.readEntries(function(t){if(t.length>0){for(var a=0,i=t;a<i.length;a++){var n=i[a];n.isDirectory?m(n):o.push({entry:n,dest:e.fullPath||""})}r()}else u-=1,0===u&&p()})};r()}},f=0,S=t;f<S.length;f++){var E=S[f];if(g.includes(s.file_extension(E.name))){var y=new h.FileUpload({name:E.name,dest:E.fullPath});d.Dispatcher.dispatch({type:h.UploaderActionType.ADD_NEW_FAILED_FILE,data:{file:y,errorType:h.UploadErrorType.PACKAGE_FILE,errorMessage:i._("Due to browser limitations, OSX package files                              files cannot be uploaded using drag-and-drop.                              Please try using the “Upload…“ dialog.")}}),this._broadcastUploadErrored(y);var b=_.uploaderStore.uploadById(y.uploadId);c.logUploadAction(_.uploaderStore.user().id,l.WebUploadActionEvent.UPLOAD_FAILURE,b)}else m(E)}},e.prototype.setIsUploadModalOpen=function(e){var t=e.isUploadModalOpen;d.Dispatcher.dispatch({type:h.UploaderActionType.SET_IS_UPLOAD_MODAL_OPEN,data:{isUploadModalOpen:t}})},e.prototype.setInlineStatusShouldBeDismissed=function(e){var t=e.inlineStatusShouldBeDismissed;d.Dispatcher.dispatch({type:h.UploaderActionType.SET_INLINE_STATUS_SHOULD_BE_DISMISSED,data:{inlineStatusShouldBeDismissed:t}})},e.prototype.setAjaxInterceptor=function(e){this.ajaxInterceptor=e,m.default.setAjaxInterceptor(e)},e.prototype.setIsContentManager=function(e){void 0===e&&(e=!1),this.isContentManager=e},e.prototype.cancelUploads=function(e){var t=this,r=e.files;m.default.removeFiles({files:r}),d.Dispatcher.dispatch({type:h.UploaderActionType.CANCEL_UPLOADS,data:{files:r}}),this._startNextUploadIfAvailable(),r.forEach(function(e){return t._broadcastUploadCancelled(e)})},e.prototype.manuallySetInErrorState=function(e){var t=e.file,r=e.errorType,a=e.errorMessage;m.default.removeFiles({files:[t]}),d.Dispatcher.dispatch({type:h.UploaderActionType.UPLOAD_ERROR,data:{uploadId:t.uploadId,errorType:r,errorMessage:a}});var o=_.uploaderStore.uploadById(t.uploadId);c.logUploadAction(_.uploaderStore.user().id,l.WebUploadActionEvent.UPLOAD_FAILURE,o),this.setInlineStatusShouldBeDismissed({inlineStatusShouldBeDismissed:!1}),this._startNextUploadIfAvailable(),this._broadcastUploadErrored(t)},e.prototype._startUpload=function(e){var t,r,o=e.file;return d.Dispatcher.dispatch({type:h.UploaderActionType.START_UPLOAD,data:{file:o}}),t=["url","webloc","website"].includes(s.file_extension(o.name))?0:1,r=this.isContentManager?{dest:o.dest,reported_total_size:o.size,upload_id:o.uploadId,_subject_uid:o.userId,offset:0,ns_id_for_routing:o.ns_id,overwrite:t,t:a.Cookies.read("__Host-js_csrf")}:(this.useWaterfallUploads,{_subject_uid:o.userId,t:a.Cookies.read("__Host-js_csrf"),dest:o.dest,overwrite:t,reported_total_size:o.size,ns_id_for_routing:o.ns_id}),m.default.setAjaxParams(o,r),m.default.start(),!0},e.prototype._startNextUploadIfAvailable=function(){var e=_.uploaderStore.nextUpload();null!=e&&null==_.uploaderStore.currentUpload()&&(o.assert(e instanceof h.FileUpload,"the nextUpload is not of type FileUpload"),this._startUpload({file:e}))},e.prototype._doBroadcast=function(e,t){if("function"==typeof CustomEvent)window.dispatchEvent(new CustomEvent(e,t));else{var r=document.createEvent("CustomEvent");r.initCustomEvent(e,!0,!0,t?t.detail:void 0),document.dispatchEvent(r)}},e.prototype._broadcastUploadBegin=function(e,t){if(e.length){var r={detail:{files:e.map(function(e){return{name:e.name,path:_.uploaderStore.path()}}),target:t}};this._doBroadcast(h.UPLOAD_BEGIN_EVENT,r)}},e.prototype._broadcastUploadCancelled=function(e){var t={detail:{file:{path:e.dest,name:e.name}}};this._doBroadcast(h.UPLOAD_CANCEL_EVENT,t)},e.prototype._broadcastUploadErrored=function(e){var t={detail:{file:{path:e.dest,name:e.name}}};this._doBroadcast(h.UPLOAD_ERROR_EVENT,t)},e.prototype._broadcastUploadComplete=function(e){var t={detail:{file:{path:e.dest,name:e.name}}};this._doBroadcast(h.UPLOAD_COMPLETE_EVENT,t)},e.prototype._broadcastAllUploadsComplete=function(e){if(e.length){var t={detail:{files:e.map(function(e){return{path:e.dest,name:e.name}})}};this._doBroadcast(h.ALL_UPLOADS_COMPLETE_EVENT,t)}},e})();t.UploaderActions=new S}),define("modules/clean/react/file_uploader/file_uploader_modal",["require","exports","tslib","external/classnames","react","external/react-dom","jquery","modules/core/browser","modules/clean/browse_interface","modules/clean/css","modules/clean/datetime","modules/clean/display_format","modules/clean/em_string","modules/clean/filepath","modules/clean/analytics","modules/clean/react/file_uploader/actions","modules/clean/react/file_uploader/utils","modules/clean/react/file_uploader/constants","modules/clean/react/file_uploader/nearquota_upload_alt_action","modules/clean/react/file_uploader/plu_wrapper","modules/clean/react/file_uploader/store","modules/clean/react/file_uploader/uploader_modal","modules/clean/react/flag","modules/clean/react/icon/icon_helper","modules/clean/react/image","modules/clean/react/modal","modules/clean/react/sprite","modules/clean/react/tooltip","modules/clean/react_format","modules/clean/static_urls","modules/clean/viewer","modules/constants/payments","modules/constants/trademark","modules/core/exception","modules/core/i18n","modules/core/uri"],function(e,t,r,a,o,i,n,s,l,d,u,p,c,h,m,_,f,g,S,E,y,b,v,T,A,I,R,D,w,C,F,L,U,O,P,N){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=r.__importDefault(a),o=r.__importDefault(o),i=r.__importStar(i),n=r.__importDefault(n),s=r.__importStar(s),d=r.__importStar(d),u=r.__importStar(u),p=r.__importStar(p),h=r.__importStar(h),E=r.__importDefault(E),T=r.__importStar(T),L=r.__importStar(L);var M=function(e){var t,r=e.user,a=e.path,o=e.maxLength,i=void 0===o?1e3:o,n=F.Viewer.get_viewer();n.is_paired&&r.is_team&&(t=n.team_name);var s;if("/"===a)s=n.is_paired?r.is_team?P._("upload to your %(team_name)s Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({team_name:t}):P._("upload to your personal Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}):P._("upload to your Dropbox");else{var l=c.Emstring.em_snippet(h.filename(a),i);s=n.is_paired?r.is_team?P._("upload to the folder ‘%(folder)s’ in your %(team_name)s Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({folder:l,team_name:t}):P._("upload to the folder ‘%(folder)s’ in your personal Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({folder:l}):P._("upload to the folder ‘%(folder)s’",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({folder:l})}return s},x=(function(e){function t(r){var s=e.call(this,r)||this;return s._onUploaderStoreChanged=function(){s.setState(s._get_state_from_store())},s._focusChooseButton=function(){var e=i.findDOMNode(s.refs.pluFileChooseButton);n.default(e).focus()},s._handleFileChoose=function(){E.default.showFilePicker()},s.isSomethingUploading=function(){return s.state.fileList.find(function(e){return e.status===g.FileStatusType.PENDING||e.status===g.FileStatusType.UPLOADING})},s._handleClose=function(){s.isSomethingUploading()||_.UploaderActions.setInlineStatusShouldBeDismissed({inlineStatusShouldBeDismissed:!0}),_.UploaderActions.setIsUploadModalOpen({isUploadModalOpen:!1}),I.Modal.close(),s.props.onModalDismissed&&s.props.onModalDismissed(),m.NQOQLogger.logCancelModal("wb_oq_upm",{modal_type:"utility"})},s._handleCancel=function(e){_.UploaderActions.cancelUploads({files:[e]})},s._handleOnDismiss=function(e){_.UploaderActions.setIsUploadModalOpen({isUploadModalOpen:!1}),m.NQOQLogger.logCloseModal("wb_oq_upm",{modal_type:"utility"})},s._limitedTeamOverquotaLink=function(e){var t,r=s.state.user;return r.is_cdm_member&&!r.is_team_admin&&s.props.numTeamAdmins>0?s.props.promptAdminToUpgradeEmailTemplateUrl:(t=1===s.props.numTeamMembers?"/plans":"/team/upgrade",new N.URI({path:t,query:{_tk:"over_quota",_camp:"upload_modal",oqa:e?"upl":"upl_b"}}).toString())},s.trackCTAClick=function(){var e=s.getButtonProps().tracking_upgrade_CTA;m.NQOQLogger.logAcceptModal("wb_oq_upm_"+s.OQALocationCode,{modal_type:"utility",cta_text:e})},s._renderIntroModalButtons=function(){var e=s.getButtonProps().upgrade_CTA,t=o.default.createElement("div",{className:"u-font-medium"},s.props.overQuotaStatus===g.OverQuotaStatusType.BASIC_OVER_QUOTA?w.reactFormat(P._("Before you can upload files, you need to <a>get more space</a>."),{a:o.default.createElement("a",{"aria-label":P._("Get more space"),className:"overquota-uploader-link",href:"/out-of-space?oqa=wb_oq_upm_"+s.OQALocationCode,onClick:s.trackCTAClick})}):s.state.user.is_cdm_member&&[g.OverQuotaStatusType.LIMITED_TEAM_USER_OVER_QUOTA,g.OverQuotaStatusType.LIMITED_TEAM_TSD_OVER_QUOTA].includes(s.props.overQuotaStatus)?"":s.props.overQuotaStatus===g.OverQuotaStatusType.LIMITED_TEAM_USER_OVER_QUOTA?w.reactFormat(P._("Before you can upload files, you need to <a>get more space</a>."),{a:o.default.createElement("a",{"aria-label":P._("Get more space"),className:"overquota-uploader-link",href:s._limitedTeamOverquotaLink(!0)})}):P._("Having problems? Please try again.")),r=null,a=null;if(s.props.overQuotaStatus===g.OverQuotaStatusType.BASIC_OVER_QUOTA){var i=L.OUT_OF_SPACE_URL+"?oqa=wb_oq_upm_"+s.OQALocationCode;r=o.default.createElement("a",{className:"dbmodal-button c-btn c-btn--primary",href:i,onClick:s.trackCTAClick},e)}else r=[g.OverQuotaStatusType.LIMITED_TEAM_USER_OVER_QUOTA,g.OverQuotaStatusType.LIMITED_TEAM_TSD_OVER_QUOTA].includes(s.props.overQuotaStatus)?o.default.createElement("a",{className:"dbmodal-button c-btn c-btn--primary",href:s._limitedTeamOverquotaLink(!1)},e):o.default.createElement("button",{ref:"pluFileChooseButton",className:"dbmodal-button c-btn c-btn--primary",onClick:s._handleFileChoose},P._("Choose files"));if(a=o.default.createElement("button",{className:"dbmodal-button c-btn c-btn--secondary u-mar-left-s",onClick:s._handleClose},P._("Cancel")),s.props.overQuotaStatus===g.OverQuotaStatusType.BASIC_OVER_QUOTA||s.props.overQuotaStatus===g.OverQuotaStatusType.LIMITED_TEAM_USER_OVER_QUOTA&&!s.state.user.is_cdm_member){return o.default.createElement("div",{className:"u-mar-vertical-l clearfix"},o.default.createElement("div",{className:"u-l-fr"},r,a),o.default.createElement("div",{className:"upload-overquota-banner__container"},o.default.createElement("div",{id:"upload-overquota-banner",className:"c-banner c-banner--warning upload-overquota-banner__content"},t)))}return o.default.createElement("div",{className:"u-mar-top-l"},o.default.createElement(v.Flag,{spacing:"s",rightAttachment:o.default.createElement("div",null,r,a)},t))},s._renderFileListModalButtons=function(){var e=s.state.fileList.find(function(e){return e.status===g.FileStatusType.PENDING||e.status===g.FileStatusType.UPLOADING}),t=e?"tertiary":"primary",r=o.default.createElement("button",{ref:"pluFileChooseButton",className:"dbmodal-button c-btn c-btn--secondary",onClick:s._handleFileChoose},P._("Add more files")),a=o.default.createElement("button",{className:"dbmodal-button c-btn c-btn--"+t,onClick:s._handleClose},e?P._("Hide"):P._("Done"));return o.default.createElement("div",{className:"u-mar-top-s"},o.default.createElement(v.Flag,{spacing:"s",leftAttachment:r,rightAttachment:a},o.default.createElement("div",{className:"u-font-small"},!e&&P._("Having problems? Please try again."))))},s._renderIntroMessage=function(){var e=M({user:s.state.user,path:s.state.path}),t=F.Viewer.get_viewer().team_name;if(s.state.user.is_cdm_member&&[g.OverQuotaStatusType.LIMITED_TEAM_USER_OVER_QUOTA,g.OverQuotaStatusType.LIMITED_TEAM_TSD_OVER_QUOTA].includes(s.props.overQuotaStatus)){var r=void 0;return r=s.props.overQuotaStatus===g.OverQuotaStatusType.LIMITED_TEAM_USER_OVER_QUOTA?P._("Your member folder is full, so no new files can be added"):P._("The %(team_name)s shared workspace is full, so no new files can be added").format({team_name:t}),s.state.user.is_team_admin||!s.props.numTeamAdmins?w.reactFormat(P.ungettext("%(dropbox_full_message)s. To get more space, <upgradeLink>upgrade your account </upgradeLink>.","%(dropbox_full_message)s. To get more space, <upgradeLink>upgrade to %(trademark_business)s</upgradeLink>.",s.props.numTeamMembers),{dropbox_full_message:r,trademark_business:U.TRADEMARK_BUSINESS,upgradeLink:o.default.createElement("a",{href:s._limitedTeamOverquotaLink(!1)})}):P.ungettext("%(dropbox_full_message)s. To get more space, ask your Dropbox admin (%(admin_email)s).","%(dropbox_full_message)s. To get more space, ask your Dropbox admins (%(admin_email)s and %(num_other_admins)s others).",s.props.numTeamAdmins).format({dropbox_full_message:r,admin_email:s.props.teamAdminEmail,num_other_admins:s.props.numTeamAdmins-1})}return[g.OverQuotaStatusType.BASIC_OVER_QUOTA,g.OverQuotaStatusType.LIMITED_TEAM_USER_OVER_QUOTA].includes(s.props.overQuotaStatus)?P._("You can’t upload files because you’re out of space. Before you can upload to Dropbox, you need to get more space."):s.props.isTeamOnboarding?P._("Choose files to add to the %(team_name)s team folder. You can also drag and drop files onto this page to upload them. Anyone who joins the %(team_name)s Dropbox will have access to files in the team folder.").format({team_name:t}):s.props.dragAndDropEnabled?P._("Choose files to %(upload_folder_name)s. You can select more than one file at a time. You can also drag and drop files anywhere on this page to start uploading.",{comment:'upload_folder_name contains a snippet such as " upload to your Dropbox"'}).format({upload_folder_name:e}):P._("Choose files to %(upload_folder_name)s. You can select more than one file at a time.",{comment:'upload_folder_name contains a snippet such as " upload to your Dropbox"'}).format({upload_folder_name:e})},s._renderDropzone=function(){return o.default.createElement("div",{ref:"dropzone",id:t.DROPZONE_ID,style:{display:"none"}},o.default.createElement("div",null,P.ungettext("Drop your file to %(upload_action)s","Drop your files to %(upload_action)s",s.state.numDraggingFiles,{comment:"upload_action is a phrase like 'upload to folder 'XYZ'"}).format({upload_action:M({user:s.state.user,path:s.state.path,maxLength:20})})))},s._renderFileListRowStatus=function(e){var t=function(t){return t.preventDefault(),s._handleCancel(e)}
;return e.status===g.FileStatusType.UPLOADING&&100===e.percentUploaded?o.default.createElement(A.Image,{src:C.static_url("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),srcHiRes:C.static_url("/static/images/icons/ajax-loading-small@2x-vflAxdZTP.gif")}):e.status===g.FileStatusType.PENDING||e.status===g.FileStatusType.UPLOADING?o.default.createElement("button",{className:"button-as-link",onClick:t},o.default.createElement(R.Sprite,{group:"web",name:"xclose",alt:P._("Cancel")})):e.status===g.FileStatusType.COMPLETE?o.default.createElement(R.Sprite,{group:"web",name:"s_check",alt:P._("Upload successful")}):e.status===g.FileStatusType.CANCELLED?o.default.createElement(A.Image,{src:C.static_url("/static/images/cancelsync-vflGFIEUK.png"),srcHiRes:C.static_url("/static/images/cancelsync@2x-vflzmHGI0.png"),alt:P._("Upload cancelled")}):e.status===g.FileStatusType.FAILED?o.default.createElement(A.Image,{src:C.static_url("/static/images/nosync-vfl18cuTS.png"),srcHiRes:C.static_url("/static/images/nosync@2x-vflgS4F07.png"),alt:P._("Error")}):void 0},s._renderFileListRowError=function(e){var t=e.errorMessage||P._("Something went wrong while uploading this file.");return o.default.createElement("div",{className:"error-col"},o.default.createElement("span",{className:"error-msg"},e.errorType===g.UploadErrorType.FILE_SIZE_ERROR?P._("File too large"):P._("Upload Error"),o.default.createElement("span",{className:"error-details"},o.default.createElement(D.Tooltip,{position:D.TooltipPosition.RIGHT,tooltip_contents:o.default.createElement("div",null,t),tooltip_classname:"upload-error-tooltip"},o.default.createElement(R.Sprite,{group:"web",name:"information",alt:P._("More information")})))))},s._renderFileListRowDest=function(e){if(e.status===g.FileStatusType.CANCELLED)return P._("Canceled");var r=void 0,a=F.Viewer.get_viewer().get_user_by_id(e.userId);return r=s.props.isContentManager?"":l.get_browse_root_name(a),o.default.createElement("a",{href:l.browse_uri_for_fq_path(a,e.dest).toString()},c.Emstring.em_snippet(""+r+e.dest,t.DEST_SNIPPET_LENGTH,0))},s._renderFileListRow=function(e,r){var i=e.status===g.FileStatusType.UPLOADING?e.percentUploaded:e.status===g.FileStatusType.PENDING?0:100,n={"upload-file":!0,complete:e.status===g.FileStatusType.COMPLETE,cancelled:e.status===g.FileStatusType.CANCELLED,error:e.status===g.FileStatusType.FAILED};return o.default.createElement("li",{className:a.default(n),key:e.uploadId,style:{backgroundSize:i+"% 100%"}},o.default.createElement("div",{className:"upload-file-info",style:{overflow:"hidden"}},o.default.createElement("div",{className:"filename-col"},o.default.createElement(R.Sprite,{group:"web",name:T.file_icon(e.name),alt:""}),o.default.createElement("span",{className:"filename"},c.Emstring.em_snippet(e.name,t.FILENAME_SNIPPET_LENGTH)),null!=e.size&&o.default.createElement("span",{className:"size"}," - ",p.format_bytes(e.size))),e.status!==g.FileStatusType.FAILED&&r&&o.default.createElement("div",{className:"dest-col"},s._renderFileListRowDest(e)),e.status===g.FileStatusType.FAILED&&s._renderFileListRowError(e),o.default.createElement("div",{className:"status-col"},s._renderFileListRowStatus(e))))},s._renderFileList=function(e,t){return void 0===t&&(t=!0),o.default.createElement("ol",{ref:"uploadFilesList",id:"upload-files-list",style:{margin:0,padding:0,maxHeight:228,overflowY:"auto",position:"relative"}},e.map(function(e){return s._renderFileListRow(e,t)}))},s._renderTimeLeft=function(){var e=s.isSomethingUploading()&&s.state.numSecondsLeft?u.format_time_remaining(s.state.numSecondsLeft):"";return o.default.createElement("div",{style:{marginTop:8,textAlign:"right",minHeight:"1.25em",lineHeight:"1.25"}},e)},s.state=s._get_state_from_store(),s.OQALocationCode=f.getOQmodalOQALocationCode(r.pathname),s}return r.__extends(t,e),t.prototype._get_state_from_store=function(){var e=y.uploaderStore.user();return O.assert(null!==e,"Expected non-null user in file_uploader_modal"),{user:e,path:y.uploaderStore.path(),fileList:y.uploaderStore.fileList(),numDraggingFiles:y.uploaderStore.numDraggingFiles(),currentUpload:y.uploaderStore.currentUpload(),numSecondsLeft:y.uploaderStore.numSecondsLeft(),hasPermissionToUploadToFolder:y.uploaderStore.hasPermissionToUploadToFolder()}},t.prototype.componentDidMount=function(){var e=this;y.uploaderStore.add_change_listener(this._onUploaderStoreChanged),this._usingFileUploaderModal()&&(d.require_css("/static/css/scooter/scooter-scoped-vflWuydQl.css"),this._focusChooseButton(),setTimeout(function(){return e.forceUpdate()},250),n.default(window).on("resize.uploaderModal",function(){e._focusChooseButton()}))},t.prototype.componentDidUpdate=function(e,r){if(this._usingFileUploaderModal()){if(this._focusChooseButton(),this.state.numDraggingFiles){n.default(i.findDOMNode(this.refs.modal.refs.modalBox)).find("#"+t.DROPZONE_ID).length||n.default("#"+t.DROPZONE_ID).clone().prependTo(n.default(i.findDOMNode(this.refs.modal.refs.modalBox))).css({width:"100%",height:"100%",position:"absolute",opacity:0}).show().fadeTo(500,1)}else n.default(i.findDOMNode(this.refs.modal)).find("#"+t.DROPZONE_ID).remove();if(this.state.fileList.count()>r.fileList.count()){var a=n.default(i.findDOMNode(this.refs.uploadFilesList)),o=a.find(".upload-file")?a.find(".upload-file").eq(r.fileList.count()):void 0;o&&o.length&&a.scrollTop(a.scrollTop()+o.position().top)}}},t.prototype.componentWillUnmount=function(){y.uploaderStore.remove_change_listener(this._onUploaderStoreChanged),n.default(window).off("resize.uploaderModal")},t.prototype._usingFileUploaderModal=function(){return 0===this.state.fileList.count()},t.prototype.getButtonProps=function(){var e=P._("Upgrade to Upload"),t="upgrade to upload";return this.state.user.is_cdm_member&&(this.state.user.is_team_admin||0===this.props.numTeamAdmins?(e=P._("Get more space"),t="get more space"):(e=P._("Ask for more space"),t="ask for more space")),{upgrade_CTA:e,tracking_upgrade_CTA:t}},t.prototype.render=function(){var e;e=this.props.isTeamOnboarding?P._("Which files would you like to add?"):!this.state.user.is_cdm_member||this.props.overQuotaStatus!==g.OverQuotaStatusType.LIMITED_TEAM_USER_OVER_QUOTA&&this.props.overQuotaStatus!==g.OverQuotaStatusType.LIMITED_TEAM_TSD_OVER_QUOTA?P._("Upload to Dropbox"):P._("More space needed");var t=null;if(null!=this.state.fileList.find(function(e){return e.status===g.FileStatusType.COMPLETE})&&this.props.overQuotaStatus===g.OverQuotaStatusType.BASIC_NEAR_QUOTA){var r=S.getNearquotaUploadAltActionOQA(this.props.lastFileUploadMethod,s.get_uri().path);t=o.default.createElement(S.NearquotaUploadAltAction,{oqa:r})}return o.default.createElement("div",{ref:"container"},this._renderDropzone(),this._usingFileUploaderModal()?o.default.createElement(I.Modal,{ref:"modal",title:e,showX:!1,id:"file-uploader-modal",clickOutToClose:!0,altAction:t,buttonComponent:0===this.state.fileList.count()?this._renderIntroModalButtons():this._renderFileListModalButtons(),onDismiss:this._handleOnDismiss},0===this.state.fileList.count()?o.default.createElement("span",null,this._renderIntroMessage()):this._renderFileList(this.state.fileList.toArray(),this.props.shouldShowDestinationLink),this._renderTimeLeft()):o.default.createElement(b.UploaderModal,{dragAndDropEnabled:this.props.dragAndDropEnabled,shouldShowDestinationLink:this.props.shouldShowDestinationLink,onModalDismissed:this.props.onModalDismissed,overQuotaStatus:this.props.overQuotaStatus,isContentManager:this.props.isContentManager,isTeamOnboarding:this.props.isTeamOnboarding,uploaderExperiments:this.props.uploaderExperiments,lastFileUploadMethod:this.props.lastFileUploadMethod}))},t.DROPZONE_ID="upload-modal-dropzone",t.FILENAME_SNIPPET_LENGTH=15,t.DEST_SNIPPET_LENGTH=13,t})(o.default.PureComponent);t.FileUploaderModal=x}),define("modules/clean/react/file_uploader/inline_upload_status",["require","exports","tslib","react","modules/clean/datetime","modules/clean/em_string","modules/clean/react/file_uploader/actions","modules/clean/react/snackbar","modules/clean/react/file_uploader/constants","modules/core/i18n","modules/constants/trademark","modules/core/accessible_announce"],function(e,t,r,a,o,i,n,s,l,d,u,p){"use strict";function c(e){return e.some(function(e){return e.status===l.FileStatusType.PENDING||e.status===l.FileStatusType.UPLOADING})?v.UPLOADING:e.some(function(e){return e.status===l.FileStatusType.FAILED})?v.ERROR:v.COMPLETE}function h(e,t){var r=c(e);return r===v.UPLOADING&&t?t.percentUploaded:r===v.COMPLETE||r===v.ERROR?100:0}function m(e,t){return e.count(function(e){return e.status===t})}function _(e){return e.count(function(e){return e.status!==l.FileStatusType.CANCELLED})}function f(e){switch(e){case l.UploadErrorType.OVER_QUOTA_ERROR:return d._("out of space");case l.UploadErrorType.FILE_SIZE_ERROR:return d._("file too large");case l.UploadErrorType.CONNECTION_ERROR:return d._("lost connection");case l.UploadErrorType.HTTP_ERROR:return d._("server error");case l.UploadErrorType.EMPTY_OR_FOLDER:return d._("can’t upload folders or empty files");case l.UploadErrorType.FOLDER_SAFARI:return d._("try uploading files separately");case l.UploadErrorType.PACKAGE_FILE:return d._("OSX package file");case l.UploadErrorType.UPLOAD_PRECHECK_INVALID_CHAR_ERROR:return d._("filename contains invalid character");case l.UploadErrorType.BLOCKS_MISSING_ERROR:case l.UploadErrorType.COMMIT_HTTP_ERROR:case l.UploadErrorType.UPLOAD_BLOCK_ERROR:case l.UploadErrorType.SERVER_RESPONSE_ERROR:case l.UploadErrorType.SERVER_TOKEN_EMPTY_ERROR:case l.UploadErrorType.SERVER_TOKENS_MISSING_ERROR:case l.UploadErrorType.SERVER_HASH_RESPONSE_ERROR:case l.UploadErrorType.SERVER_HASH_EMPTY_ERROR:case l.UploadErrorType.HASHES_NOT_EQUAL_ERROR:case l.UploadErrorType.UPLOAD_PRECHECK_ERROR:return d._("server error");case l.UploadErrorType.CHUNKS_NOT_ENABLED_ERROR:case l.UploadErrorType.CLIENT_HASH_EMPTY_ERROR:case l.UploadErrorType.BLOCK_RUNTIME_ID_MISSING_ERROR:case l.UploadErrorType.BLOCK_INDEX_ERROR:case l.UploadErrorType.BLOCK_EMPTY_ERROR:case l.UploadErrorType.BLOB_EMPTY_ERROR:case l.UploadErrorType.BLOB_MISSING_ERROR:case l.UploadErrorType.CLIENT_HASH_DIGEST_ERROR:case l.UploadErrorType.FILE_READER_NULL_RESULT_ERROR:case l.UploadErrorType.COMMIT_READINESS_ERROR:return d._("upload processing error");default:return""}}function g(e){var t=m(e,l.FileStatusType.PENDING),r=d.ungettext("%(num_pending_files)d file left","%(num_pending_files)d files left",t).format({num_pending_files:t});return t>0?r:d._("View details")}function S(e,t){var r=c(e),a=_(e);if(t)return d._("Uploading %(filename)s").format({filename:i.Emstring.em_snippet(t.name,20)});if(r===v.UPLOADING)return d._("Starting upload...");if(r===v.COMPLETE){if(a>1)return d._("Uploaded %(num_files)d files").format({num_files:a});if(1===a){var o=e.filter(function(e){return e.status!==l.FileStatusType.CANCELLED}).last();return d._("Uploaded %(filename)s").format({filename:i.Emstring.em_snippet(o.name,20)})}return d._("Upload cancelled")}return""}function E(e){var t=_(e),r=m(e,l.FileStatusType.FAILED);if(t>1){var a=m(e,l.FileStatusType.COMPLETE);return d.ungettext("Uploaded %(num_completed)d of %(num_files)d files","Uploaded %(num_completed)d of %(num_files)d files",a,{comment:'`num_completed` is the singular/plural variable in this string. It will always be > 1, so in English this string will always be "Uploaded N of M files". However, this gives the opportunity for translations to other languages to pluralize appropriately when they are of the form "N files of M uploaded".'}).format({num_completed:a,num_files:t})+" - "+d.ungettext("%(num_errors)d error","%(num_errors)d errors",r).format({num_errors:r})}var o=e.last().errorType;return o===l.UploadErrorType.GENERIC?d._("Unable to upload %(filename)s").format({filename:i.Emstring.em_snippet(e.last().name,20)}):o===l.UploadErrorType.LOCKED_TEAM_ERROR?d._("Can’t upload. Your team no longer has full use of %(trademark_business)s features.").format({trademark_business:u.TRADEMARK_BUSINESS}):d._("Unable to upload %(filename)s: %(reason)s").format({filename:i.Emstring.em_snippet(e.last().name,20),reason:f(o)})}function y(e,t){var r=c(e);return t||r!==v.ERROR?S(e,t):E(e)}function b(e){var t,r=e.fileList,i=e.currentUpload,l=e.numSecondsLeft,u=e.onViewDetails,m=e.onShown,_=e.onClosed,f=c(r);t=f===v.UPLOADING?"sync":f===v.ERROR?"fail":"complete";var S="",E="";f===v.UPLOADING&&l?E=" - "+o.format_time_remaining(l):S=d._("Close");var b=y(r,i);"complete"!==t&&"fail"!==t||p.AccessibleAnnounce.polite(b),s.Snackbar.update(a.default.createElement(s.Snackbar,{closeButtonText:S,onCloseClick:function(){n.UploaderActions.setInlineStatusShouldBeDismissed({inlineStatusShouldBeDismissed:!0})},onTimeout:function(){n.UploaderActions.setInlineStatusShouldBeDismissed({inlineStatusShouldBeDismissed:!0})},actionButtonText:g(r),onActionClick:u,title:b+E,variant:t,timeoutDelayMsForCompleteVariant:15e3,externalProgress:h(r,i),onClosed:_,onShown:m}))}Object.defineProperty(t,"__esModule",{value:!0}),a=r.__importDefault(a),o=r.__importStar(o);var v;(function(e){e.UPLOADING="uploading",e.ERROR="error",e.COMPLETE="complete"})(v||(v={})),t.showInlineUploadStatusSnackbar=b}),define("modules/clean/react/file_uploader/mapper",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(){this.fileIdMap={}}return e.prototype.uploadIdOf=function(e){return this.fileIdMap[e]||null},e.prototype.set=function(e,t){this.fileIdMap[e]=t},e})();t.uploaderMapper=new r}),define("modules/clean/react/file_uploader/nearquota_upload_alt_action",["require","exports","tslib","react","modules/clean/react/css","modules/clean/react/image","modules/clean/static_urls","modules/core/i18n","modules/clean/react_format"],function(e,t,r,a,o,i,n,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=r.__importDefault(a),t.getNearquotaUploadAltActionOQA=function(e,t){var r="/h"===t?"ho":"fb";return e&&t?"wb_nq_"+e+"_"+r:"upl_nq"};var d=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.render=function(){var e=this.props.oqa?"?oqa="+this.props.oqa:"";return a.default.createElement("div",{className:"nearquota-alt-action"},a.default.createElement("div",null,a.default.createElement(i.Image,{className:"nearquota-alt-action__warning",src:n.static_url("/static/images/browse/warning-vflZsXcW-.svg"),alt:s._("Warning")})),a.default.createElement("p",{className:"nearquota-alt-action__copy"},l.reactFormat(s._("Thanks for adding stuff to Dropbox! Just so you know, you’re getting close\n          to your space limit. <overQuotaLink>Learn more</overQuotaLink> about what to do if you\n          run out of space."),{overQuotaLink:a.default.createElement("a",{key:"nq-link",href:"/low-space"+e})})))},t})(a.default.Component);t.NearquotaUploadAltAction=o.requireCssWithComponent(d,["/static/css/nearquota_upload_alt_action-vfln2t6dC.css"])}),define("modules/clean/react/file_uploader/oq_drag_drop_modal",["require","exports","tslib","react","modules/clean/react/css","modules/clean/react/image","modules/core/i18n","modules/clean/react/modal","modules/clean/react_format","modules/clean/analytics","modules/clean/react/file_uploader/utils","modules/clean/static_urls","modules/constants/payments","modules/constants/trademark","modules/clean/viewer","modules/clean/analytics"],function(e,t,r,a,o,i,n,s,l,d,u,p,c,h,m,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=r.__importDefault(a),c=r.__importStar(c);var f=(function(e){function t(t){var r=e.call(this,t)||this;return r.trackClose=function(){d.NQOQLogger.logCloseModal("wb_oq_dnd",{modal_type:"billboard"})},r.trackCTAClick=function(){var e=r.getButtonProps(),t=e.locationCode,a=e.tracking_button_label;d.NQOQLogger.logAcceptModal("wb_oq_dnd",{modal_type:"billboard",cta_text:a}),"ho"!==t&&"fb"!==t||_.ProEventsLogger.log("wb_oq_dnd_"+t+"_click")},r.trackOpen=function(){var e=u.getOQmodalOQALocationCode(r.props.pathname);"ho"!==e&&"fb"!==e||_.ProEventsLogger.log("wb_oq_dnd_"+e+"_view")},r.state={showTeamMemberContent:r.props.isTeamUser&&!r.props.isContentManager},r}return r.__extends(t,e),t.prototype.componentWillReceiveProps=function(e){this.setState({showTeamMemberContent:e.isTeamUser&&!e.isContentManager})},t.prototype.render=function(){return a.default.createElement("div",{className:"drag-drop-oq"},a.default.createElement(s.Modal,{style:"clean",className:"drag-drop-oq--modal",buttonComponent:this.renderButtons(),width:480,onDismiss:this.trackClose,onShow:this.trackOpen},a.default.createElement("div",null,a.default.createElement(i.Image,{src:p.static_url("/static/images/pro/overquota/overquota-folder-vflgFxxXj.png"),srcHiRes:p.static_url("/static/images/pro/overquota/overquota-folder@2x-vfloUmya6.png")})),this.renderTitle(),this.renderBody()))},t.prototype.renderBody=function(){var e=l.reactFormat(n._("In order to finish uploading %(filename)s, you need to add more storage to your Dropbox."),{filename:this.props.oqFilename});return this.props.isLockedTeam?e=m.Viewer.get_viewer().work_user.is_team_admin?l.reactFormat(n._("Your team no longer has full use of %(trademark_business)s features. Add your billing info now and you can pick up right where you left off.").format({trademark_business:h.TRADEMARK_BUSINESS})):l.reactFormat(n._("Your team no longer has full use of %(trademark_business)s features. To keep using %(trademark_business)s, contact your admin.").format({trademark_business:h.TRADEMARK_BUSINESS})):this.state.showTeamMemberContent&&(e=l.reactFormat(n._("Your Dropbox account is full. To add this file, remove files or ask your admin for more space."))),a.default.createElement("div",{className:"drag-drop-oq--copy"},e)},t.prototype.renderTitle=function(){var e=n._("Your Dropbox is full");return this.props.isLockedTeam?e=n._("Can’t upload to Dropbox"):this.state.showTeamMemberContent&&(e=n._("Can’t upload file")),a.default.createElement("div",{className:"drag-drop-oq--header"},e)},t.prototype.getButtonProps=function(){var e=u.getOQmodalOQALocationCode(this.props.pathname),t=c.OUT_OF_SPACE_URL+"?oqa=wb_oq_dnd_"+e,r=n._("Get more space"),a="get more space";return this.props.isLockedTeam?(t="/team/decide",r=n._("See next steps"),a="see next steps"):this.state.showTeamMemberContent&&(t="/help/business/space-limit-full",r=n._("Learn more about Dropbox space"),a="learn more about dropbox space"),{button_url:t,button_label:r,locationCode:e,tracking_button_label:a}},t.prototype.renderButtons=function(){var e=this.getButtonProps(),t=e.button_url,r=e.button_label;return a.default.createElement("div",{className:"drag-drop-oq--buttons"},a.default.createElement("a",{href:t,onClick:this.trackCTAClick,className:"drag-drop-oq--button c-btn c-btn--primary"},r))},t})(a.default.Component);t.OQDragDropModalComponent=f,t.OQDragDropModal=o.requireCssWithComponent(f,["/static/css/browse/oq_drag_drop_upsell-vflgzU8Ie.css"])}),define("modules/clean/react/file_uploader/plu_wrapper",["require","exports","tslib","external/plupload_dev","external/lodash","modules/clean/filepath","modules/clean/logging/hive/schemas/web-modal-activity","modules/clean/react/async_fileops_modals","modules/clean/react/folder_dialog/async","modules/clean/react/file_uploader/action_logger","modules/clean/react/file_uploader/constants","modules/clean/react/file_uploader/mapper","modules/clean/react/file_uploader/store","modules/clean/react/file_uploader/utils","modules/clean/web_upload_action_events","modules/constants/trademark","modules/core/browser_detection","modules/core/cookies","modules/core/exception","modules/core/i18n","modules/clean/react/async_file_modal_controller"],function(e,t,r,a,o,i,n,s,l,d,u,p,c,h,m,_,f,g,S,E,y){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=r.__importStar(a),o=r.__importStar(o),i=r.__importStar(i),s=r.__importStar(s),l=r.__importStar(l),d=r.__importStar(d),f=r.__importStar(f),y=r.__importStar(y);var b=function(e,t){var r=o.assignIn({},t,e);return new u.FileUpload({uploadId:r.uploadId,dest:r.dest,name:r.name,size:r.size,userId:r.userId,percentUploaded:null!=r.percent?r.percent:0,ns_id:r.nsIdForRouting,batchId:r.batchId})},v=(function(){function e(){var e=this;this.queuedFiles=[],this.setAjaxInterceptor=function(t){e.ajaxInterceptor=t},this.init=this.init.bind(this),this.addFiles=this.addFiles.bind(this),this.start=this.start.bind(this),this.setAjaxParams=this.setAjaxParams.bind(this),this.showFilePicker=this.showFilePicker.bind(this),this.onBeforeFilesAdded=this.onBeforeFilesAdded.bind(this),this.onFilesAdded=this.onFilesAdded.bind(this),this.onUploadProgress=this.onUploadProgress.bind(this),this.onFileUploaded=this.onFileUploaded.bind(this),this.onUploadComplete=this.onUploadComplete.bind(this),this.onError=this.onError.bind(this),this.onBeforeUpload=this.onBeforeUpload.bind(this),this.bytesPerSec=this.bytesPerSec.bind(this),this.removeFiles=this.removeFiles.bind(this),this.isInitialized=!1}return e.prototype.init=function(e,t,r){var o=this;if(void 0===e&&(e=!1),void 0===t&&(t=!1),void 0===r&&(r=!1),!this.isInitialized){this.isInitialized=!0,this.useInvalidExtensionWarningModal=r,this.secretFilePickerButton=document.createElement("button"),this.secretFilePickerButton.setAttribute("class","secret-file-uploader-button"),this.secretFilePickerButton.style.display="none",document.body.appendChild(this.secretFilePickerButton),this.secretFolderPickerButton=document.createElement("input"),this.secretFolderPickerButton.setAttribute("type","file"),this.secretFolderPickerButton.setAttribute("webkitdirectory","true"),this.secretFolderPickerButton.style.display="none",this.secretFolderPickerButton.addEventListener("change",function(e){var t=e.target,r=t.files;if(r&&r.length>0){for(var a=h.generateBatchId(),n=Object.create(null),s=[],l=0;l<r.length;l++){var d=r.item(l);s.push(d),d.batchId=a;var u=i.parent_dir(d.webkitRelativePath),p=n[u];p?p.push(d):n[u]=[d]}o.tryAddFiles(s,function(){for(var e in n){var t=n[e];o.uploader.addFile(t,e)}})}t.value=""}),document.body.appendChild(this.secretFolderPickerButton),this.pluContainer=document.createElement("div"),this.pluContainer.id="flash-upload-container",this.pluContainer.style.display="none",this.pluContainer.style.position="absolute",this.pluContainer.style.left="-2000",document.body.appendChild(this.pluContainer);var n=!t&&!e,s=t&&!e,l={url:"https://dl-web.dropbox.com/chunked_upload",upload_block_url:"https://dl-web.dropbox.com/upload_web_file_block",commit_file_url:"https://dl-web.dropbox.com/commit_web_upload_file",waterfall_upload_block_url:"https://dl-web.dropbox.com/put_block_returning_token",waterfall_commit_upload_url:"https://www.dropbox.com/commit_web_upload_by_token",file_data_name:"file",runtimes:"html5",multipart_params:{},multipart:!1,max_retries:2,browse_button:this.secretFilePickerButton,max_file_size:"50000mb",chunk_size:e?"8mb":"4mb",parallel_uploads:n,waterfall_parallel_uploads:s,container:"flash-upload-container",init:{ChunkUploaded:function(e,t,r){var a=p.uploaderMapper.uploadIdOf(t.id);S.assert(null!=a,"uploadId is null"),S.assert(JSON.parse(r.response).upload_id===a,"uploadId in the response does not match the current uploadId");var i=c.uploaderStore.fileList().get(a);S.assert(null!=i,"fileUpload is null");var n=i,s=n.dest,l=n.size,d=n.userId,u=n.ns_id;return o.setAjaxParams(n,{dest:s,reported_total_size:l,upload_id:a,_subject_uid:d,offset:r.offset,ns_id_for_routing:u,overwrite:1,t:g.Cookies.read("__Host-js_csrf")})}}};S.assert("string"==typeof l.chunk_size&&l.chunk_size in u.ValidChunkSizeStrings,"we only allow a valid chunk size specified as a string"),this.uploader=new a.Uploader(l),this.uploader.init()}},e.prototype.addFiles=function(e){var t=e.files,r=e.path;this.isInitialized||this.init(),this.uploader.addFile(t,r)},e.prototype.start=function(){this.isInitialized||this.init(),this.uploader.start()},e.prototype.setAjaxParams=function(e,t){this.isInitialized||this.init(),this.ajaxInterceptor&&(t=this.ajaxInterceptor.interceptUpload(e,t)),this.uploader.settings.multipart_params=t},e.prototype.showFilePicker=function(){this.isInitialized||this.init(),this.secretFilePickerButton.click()},e.prototype.showFolderPicker=function(){this.isInitialized||this.init(),this.secretFolderPickerButton.click()},e.prototype.getErrorOnStatus507=function(e){var t=u.UploadErrorType.OVER_QUOTA_ERROR;try{"locked_team"===JSON.parse(e.response).error&&(t=u.UploadErrorType.LOCKED_TEAM_ERROR)}catch(e){}return t},e.prototype.getParallelUploadHttpErrorType=function(e){var t=u.UploadErrorType.GENERIC;if(0===e.status)t=f.safari&&0===e.file.loaded&&""===e.file.type&&e.file.size>0?u.UploadErrorType.FOLDER_SAFARI:u.UploadErrorType.CONNECTION_ERROR;else switch(e.code){case a.UPLOAD_BLOCK_ERROR:t=u.UploadErrorType.UPLOAD_BLOCK_ERROR;break;case a.COMMIT_HTTP_ERROR:t=u.UploadErrorType.COMMIT_HTTP_ERROR}return t},e.prototype.onBeforeFilesAdded=function(){var e=this;this.isInitialized||this.init(),this.uploader.bind("BeforeFilesAdded",function(t,r){return e.tryAddFiles(r,function(){e.uploader.addFile(r)}),!1})},e.prototype.onFilesAdded=function(e){var t=this,a=e.isContentManager,o=e.rootNSIDForCM,u=e.setPathAndFolderNsId,_=e.resetFolderNsId,f=e.expUploadWithFolderPicker,g=e.cb;this.isInitialized||this.init(),this.uploader.bind("FilesAdded",function(e,y){var v=c.uploaderStore.user();S.assert(y&&y.length>=1,"FilesAdded should be called with an array of PluploadFile with at least one entry");for(var T=!!y[0].batchId,A=y[0].batchId?y[0].batchId:h.generateBatchId(),I=0,R=y;I<R.length;I++){var D=R[I];T?S.assert(D.batchId===A,"All entries should have the same batchId"):(S.assert(void 0===D.batchId,"No entries should have their batchId set"),D.batchId=A)}t.queuedFiles=t.queuedFiles.concat(y);var w=function(){S.assert(null!=c.uploaderStore.user(),"UploaderStore.user() is null");var e=t.queuedFiles;t.queuedFiles=[];var r=e.map(function(t){var r=c.uploaderStore.user(),a=h.generateUploadId(),o=c.uploaderStore.path();t.dest=i.normalize(o)+i.normalize(t.dest),p.uploaderMapper.set(t.id,a),S.assert(!!t.batchId,"At this point, a PluploadFile should have a batchId set");var n={uploadId:a,userId:r.id},s=c.uploaderStore.folderNsId();""===i.normalize(o)?(n.nsIdForRouting=r.root_ns_id,n.nsId=r.root_ns_id):null!==s&&(n.nsIdForRouting=s,n.nsId=s);var l=b(t,n);return d.logUploadAction(r.id,m.WebUploadActionEvent.UPLOAD_ATTEMPT,l,void 0,void 0,e.length),l});null!==c.uploaderStore.folderNsId()&&_&&_(),g(r)},C=function(){t.queuedFiles.forEach(function(t){return e.removeFile(t)}),t.queuedFiles=[]};if(u){var F={user:v,onAccept:u,onSuccess:w,onCancel:C};if(a)s.showAdminUpload(r.__assign({},F,{rootNSID:o,isRootSelectable:!0}));else if(f)l.showFolderDialog({modalName:n.ModalName.UPLOAD,user:v,title:E._("Upload to…"),primaryActionLabel:E._("Upload"),onSuccess:function(e,t){u(e,t),w()},onCancel:C});else{var L=r.__assign({},F,{showUploadWithFolderPicker:f});s.showUpload(r.__assign({},L))}}else w()})},e.prototype.onUploadProgress=function(e){this.isInitialized||this.init(),this.uploader.bind("UploadProgress",function(t,r,a){var o=p.uploaderMapper.uploadIdOf(r.id);S.assert(null!=o,"uploadIs is null");var i=c.uploaderStore.fileList().get(o);S.assert(null!=i,"existingUpload is null"),e(i.set("percentUploaded",r.percent),a)})},e.prototype.onFileUploaded=function(e){this.isInitialized||this.init(),this.uploader.bind("FileUploaded",function(t,r,a){var o=p.uploaderMapper.uploadIdOf(r.id);S.assert(null!=o,"uploadIs is null"),e(c.uploaderStore.fileList().get(o),a)})},e.prototype.onUploadComplete=function(e){this.isInitialized||this.init(),this.uploader.bind("UploadComplete",function(t,r){e(r)})},e.prototype.onError=function(e){var t=this;this.isInitialized||this.init(),this.uploader.bind("Error",function(r,o){if(null==o.file)throw new Error("PLU error without an associated file.");var i;switch(o.code){case a.FILE_SIZE_ERROR:i=u.UploadErrorType.FILE_SIZE_ERROR;break;case a.BLOCKS_MISSING_ERROR:i=u.UploadErrorType.BLOCKS_MISSING_ERROR,S.reportException({err:new Error("Blocks missing from web upload."),tags:["web_upload","blocks_missing"],severity:S.SEVERITY.CRITICAL,exc_extra:{filename:o.file.name,size:o.file.size}});break;case a.COMMIT_HTTP_ERROR:i=507===o.status?t.getErrorOnStatus507(o):t.getParallelUploadHttpErrorType(o);break;case a.UPLOAD_BLOCK_ERROR:507===o.status?i=t.getErrorOnStatus507(o):(i=t.getParallelUploadHttpErrorType(o),i===u.UploadErrorType.UPLOAD_BLOCK_ERROR&&S.reportException({err:new Error("Server error encountered when trying to upload a block."),tags:["web_upload","upload_block_error"],severity:S.SEVERITY.CRITICAL,exc_extra:{filename:o.file.name,size:o.file.size}}));break;case a.CHUNKS_NOT_ENABLED_ERROR:i=u.UploadErrorType.CHUNKS_NOT_ENABLED_ERROR,S.reportException({err:new Error("Chunks not enabled."),tags:["web_upload","chunks_not_enabled_error"],severity:S.SEVERITY.CRITICAL,exc_extra:{filename:o.file.name,size:o.file.size}});break;case a.SERVER_RESPONSE_ERROR:i=u.UploadErrorType.SERVER_RESPONSE_ERROR,S.reportException({err:new Error("Server response error."),tags:["web_upload","server_response_error"],severity:S.SEVERITY.CRITICAL,exc_extra:{filename:o.file.name,size:o.file.size,index:o.blockIndex}});break;case a.SERVER_TOKEN_EMPTY_ERROR:i=u.UploadErrorType.SERVER_TOKEN_EMPTY_ERROR,S.reportException({err:new Error("Server token empty error."),tags:["web_upload","server_token_empty_error"],severity:S.SEVERITY.CRITICAL,exc_extra:{filename:o.file.name,size:o.file.size,index:o.blockIndex}});break;case a.SERVER_TOKENS_MISSING_ERROR:i=u.UploadErrorType.SERVER_TOKENS_MISSING_ERROR,S.reportException({err:new Error("Server tokens missing error."),tags:["web_upload","server_tokens_missing_error"],severity:S.SEVERITY.CRITICAL,exc_extra:{filename:o.file.name,size:o.file.size}});break;case a.SERVER_HASH_RESPONSE_ERROR:i=u.UploadErrorType.SERVER_HASH_RESPONSE_ERROR,S.reportException({err:new Error("Server hash response error."),tags:["web_upload","server_hash_response_error"],severity:S.SEVERITY.CRITICAL,exc_extra:{filename:o.file.name,size:o.file.size,index:o.blockIndex}});break;case a.BLOCK_RUNTIME_ID_MISSING_ERROR:i=u.UploadErrorType.BLOCK_RUNTIME_ID_MISSING_ERROR,S.reportException({err:new Error("Block runtime id missing."),tags:["web_upload","block_runtime_id_missing"],severity:S.SEVERITY.CRITICAL,exc_extra:{filename:o.file.name,size:o.file.size}});break;case a.CLIENT_HASH_EMPTY_ERROR:i=u.UploadErrorType.CLIENT_HASH_EMPTY_ERROR,S.reportException({err:new Error("Client hash is empty or undefined."),tags:["web_upload","client_hash_empty"],severity:S.SEVERITY.CRITICAL,exc_extra:{filename:o.file.name,size:o.file.size}});break;case a.SERVER_HASH_EMPTY_ERROR:i=u.UploadErrorType.SERVER_HASH_EMPTY_ERROR,S.reportException({err:new Error("Server hash is empty or undefined."),tags:["web_upload","server_hash_empty"],severity:S.SEVERITY.CRITICAL,exc_extra:{filename:o.file.name,size:o.file.size,index:o.blockIndex}});break;case a.HASHES_NOT_EQUAL_ERROR:i=u.UploadErrorType.HASHES_NOT_EQUAL_ERROR,S.reportException({err:new Error("Client and server hashes are not equal."),tags:["web_upload","hashes_not_equal"],severity:S.SEVERITY.CRITICAL,exc_extra:{filename:o.file.name,size:o.file.size,index:o.blockIndex}});break;case a.BLOCK_INDEX_ERROR:i=u.UploadErrorType.BLOCK_INDEX_ERROR,S.reportException({err:new Error("Block index error."),tags:["web_upload","block_index_error"],severity:S.SEVERITY.CRITICAL,exc_extra:{filename:o.file.name,size:o.file.size,index:o.blockIndex}});break;case a.BLOCK_EMPTY_ERROR:i=u.UploadErrorType.BLOCK_EMPTY_ERROR,S.reportException({err:new Error("Empty block error."),tags:["web_upload","block_empty_error"],severity:S.SEVERITY.CRITICAL,exc_extra:{filename:o.file.name,size:o.file.size,index:o.blockIndex,offset:o.offset}});break;case a.BLOB_MISSING_ERROR:i=u.UploadErrorType.BLOB_MISSING_ERROR,S.reportException({err:new Error("Blob missing error."),tags:["web_upload","blob_missing_error"],severity:S.SEVERITY.CRITICAL,exc_extra:{filename:o.file.name,size:o.file.size}});break;case a.BLOB_EMPTY_ERROR:
i=u.UploadErrorType.BLOB_EMPTY_ERROR,S.reportException({err:new Error("Empty blob error."),tags:["web_upload","blob_empty_error"],severity:S.SEVERITY.CRITICAL,exc_extra:{filename:o.file.name,size:o.file.size}});break;case a.CLIENT_HASH_DIGEST_ERROR:i=u.UploadErrorType.CLIENT_HASH_DIGEST_ERROR,S.reportException({err:new Error("Client hash digest error."),tags:["web_upload","client_hash_digest_error"],severity:S.SEVERITY.CRITICAL,exc_extra:{filename:o.file.name,size:o.file.size,index:o.blockIndex,digestError:o.message}});break;case a.FILE_READER_NULL_RESULT_ERROR:i=u.UploadErrorType.FILE_READER_NULL_RESULT_ERROR,S.reportException({err:new Error("File reader null result error."),tags:["web_upload","file_reader_null_result_error"],severity:S.SEVERITY.CRITICAL,exc_extra:{filename:o.file.name,size:o.file.size,index:o.blockIndex}});break;case a.COMMIT_READINESS_ERROR:i=u.UploadErrorType.COMMIT_READINESS_ERROR,S.reportException({err:new Error("Commit readiness error."),tags:["web_upload","commit_readiness_error"],severity:S.SEVERITY.CRITICAL,exc_extra:{filename:o.file.name,size:o.file.size,reason:o.message}});break;case a.HTTP_ERROR:i=0===o.status?f.safari&&0===o.file.loaded&&""===o.file.type&&o.file.size>0?u.UploadErrorType.FOLDER_SAFARI:u.UploadErrorType.CONNECTION_ERROR:507===o.status?t.getErrorOnStatus507(o):u.UploadErrorType.HTTP_ERROR;break;default:i=u.UploadErrorType.GENERIC}var n;switch(i){case u.UploadErrorType.OVER_QUOTA_ERROR:n=E._("This file can’t be uploaded because you are over your                       storage quota. If you believe this message to be in error, try                       refreshing the page.");break;case u.UploadErrorType.LOCKED_TEAM_ERROR:n=E._("Can’t upload. Your team no longer has full use of %(trademark_business)s features.").format({trademark_business:_.TRADEMARK_BUSINESS});break;case u.UploadErrorType.FILE_SIZE_ERROR:n=E._("This file is too large to upload using the Dropbox website.                       Please use the desktop client.");break;case u.UploadErrorType.HTTP_ERROR:n=E._("Something went wrong while uploading this file. There was a                       server error during the upload request.");break;case u.UploadErrorType.CONNECTION_ERROR:n=E._("Something went wrong while uploading this file. Check your                       connection to the internet and try again.");break;case u.UploadErrorType.FOLDER_SAFARI:n=E._("Can’t upload folders in Safari. Upload the files separately or try another browser.");break;case u.UploadErrorType.BLOCKS_MISSING_ERROR:case u.UploadErrorType.CHUNKS_NOT_ENABLED_ERROR:case u.UploadErrorType.BLOCK_INDEX_ERROR:case u.UploadErrorType.BLOCK_EMPTY_ERROR:case u.UploadErrorType.BLOB_EMPTY_ERROR:case u.UploadErrorType.BLOB_MISSING_ERROR:case u.UploadErrorType.CLIENT_HASH_DIGEST_ERROR:case u.UploadErrorType.FILE_READER_NULL_RESULT_ERROR:n=E._("Something went wrong while uploading this file.");break;case u.UploadErrorType.COMMIT_HTTP_ERROR:case u.UploadErrorType.UPLOAD_BLOCK_ERROR:case u.UploadErrorType.SERVER_RESPONSE_ERROR:case u.UploadErrorType.SERVER_TOKEN_EMPTY_ERROR:case u.UploadErrorType.SERVER_TOKENS_MISSING_ERROR:case u.UploadErrorType.SERVER_HASH_RESPONSE_ERROR:case u.UploadErrorType.BLOCK_RUNTIME_ID_MISSING_ERROR:case u.UploadErrorType.CLIENT_HASH_EMPTY_ERROR:case u.UploadErrorType.SERVER_HASH_EMPTY_ERROR:case u.UploadErrorType.HASHES_NOT_EQUAL_ERROR:n=E._("Something went wrong while uploading this file. There was a                             server error during the upload request.");break;default:n=E._("Something went wrong while uploading this file.")}var s,l=p.uploaderMapper.uploadIdOf(o.file.id);s=l&&c.uploaderStore.fileList().has(l)?c.uploaderStore.fileList().get(l):b(o.file,{uploadId:h.generateUploadId()});var g=c.uploaderStore.user();s&&d.logUploadAction(g.id,m.WebUploadActionEvent.UPLOAD_FAILURE,s),e(s,i,n)})},e.prototype.onBeforeUpload=function(e){this.isInitialized||this.init(),this.uploader.bind("BeforeUpload",function(t,r){var o=p.uploaderMapper.uploadIdOf(r.id);return S.assert(null!=o,"uploadId is null"),e(c.uploaderStore.fileList().get(o),function(){r.status=a.UPLOADING,t.trigger("UploadFile",r)}),!1})},e.prototype.bytesPerSec=function(){return this.isInitialized||this.init(),null!=this.uploader.total?this.uploader.total.bytesPerSec:void 0},e.prototype.removeFiles=function(e){var t=e.files;this.isInitialized||this.init();for(var r=function(e){var t=o.find(a.uploader.files,function(t){return p.uploaderMapper.uploadIdOf(t.id)===e.uploadId});a.uploader.removeFile(t)},a=this,i=0,n=t;i<n.length;i++){r(n[i])}this.uploader.stop(),this.uploader.start()},e.prototype.tryAddFiles=function(e,t){if(this.isInitialized||this.init(),!this.useInvalidExtensionWarningModal)return void t();for(var r=[],a=0,o=e;a<o.length;a++){var n=o[a];u.INVALID_EXTENSIONS.includes(i.file_extension(n.name))&&r.push(n.name)}var s="",l="";if(r.length>0){if(1===r.length)s=E._("Unable to upload %(file)s").format({file:r[0]}),l=E._("This file is not supported by Dropbox and cannot be uploaded.");else if(s=E._("Unable to upload one or more files"),r.length<=3)l=E._("The following files are not supported by Dropbox and cannot be uploaded: %(files)s").format({files:r.join(", ")});else{var d=r.length-3;l=E.ungettext("The following files are not supported by Dropbox and cannot be uploaded: %(files)s and %(count)d more","The following files are not supported by Dropbox and cannot be uploaded: %(files)s and %(count)d more",d).format({files:r.slice(0,3).join(", "),count:d})}y.showFileSystemWarningsModal({confirmText:E.ungettext("Skip this file","Skip these files",r.length),fsws:[{id:"action_upload_invalid_extension",blocking:r.length===e.length,title:s,text:l,learn_more:"https://www.dropbox.com/help/"}],onFinalAccept:t})}else t()},e})(),T=new v;t.default=T}),define("modules/clean/react/file_uploader/uploader_modal",["require","exports","tslib","external/classnames","external/react-dom","react","spectrum/file_icon","spectrum/button","spectrum/icon_action","spectrum/modal","spectrum/popover","jquery","modules/clean/browse_interface","modules/core/browser","modules/core/browser_detection","modules/clean/datetime","modules/clean/display_format","modules/clean/em_string","modules/clean/filepath","modules/clean/web_user_action_events","modules/clean/react/file_uploader/action_logger","modules/clean/react/file_uploader/actions","modules/clean/react/file_uploader/constants","modules/clean/react/file_uploader/nearquota_upload_alt_action","modules/clean/react/file_uploader/store","modules/clean/react/file_uploader/plu_wrapper","modules/clean/react/image","modules/clean/react/tooltip","modules/clean/react/sprite","modules/core/i18n","modules/clean/viewer","modules/clean/static_urls","modules/core/exception","modules/clean/react_format","modules/clean/react/file_uploader/types","modules/clean/ux_analytics_modal_tracking"],function(e,t,r,a,o,i,n,s,l,d,u,p,c,h,m,_,f,g,S,E,y,b,v,T,A,I,R,D,w,C,F,L,U,O,P,N){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=r.__importDefault(a),o=r.__importStar(o),i=r.__importDefault(i),p=r.__importDefault(p),h=r.__importStar(h),_=r.__importStar(_),f=r.__importStar(f),S=r.__importStar(S),y=r.__importStar(y),I=r.__importDefault(I);var M=(function(e){function t(t){var r=e.call(this,t)||this;return r.focusChooseButton=function(){p.default(".mc-util-modal-actions-buttons .mc-button-secondary").focus()},r.handleStoreChanged=function(){r.setState(r.getStateFromStores())},r.handleFileChoose=function(e){var t=A.uploaderStore.user();e?(I.default.showFolderPicker(),t&&y.logUploadAction(t.id,E.WebUserActionLogEvent.UPLOAD_FOLDER_CLICK,void 0,P.ChooserType.FOLDER,P.UploadMethod.CHOOSER)):(I.default.showFilePicker(),t&&y.logUploadAction(t.id,E.WebUserActionLogEvent.UPLOAD_FILES_CLICK,void 0,P.ChooserType.FILE,P.UploadMethod.CHOOSER))},r.handleClose=function(){var e=r.isSomethingUploading(),t=A.uploaderStore.user();e||b.UploaderActions.setInlineStatusShouldBeDismissed({inlineStatusShouldBeDismissed:!0}),b.UploaderActions.setIsUploadModalOpen({isUploadModalOpen:!1}),r.props.onModalDismissed&&r.props.onModalDismissed(),t&&y.logUploadAction(t.id,E.WebUserActionLogEvent.CLOSE_MODAL_CLICK)},r.handleCancel=function(e){var t=A.uploaderStore.user();return t&&y.logUploadAction(t.id,E.WebUserActionLogEvent.CANCEL_UPLOAD_CLICK),b.UploaderActions.cancelUploads({files:[e]})},r.handleDismiss=function(){b.UploaderActions.setIsUploadModalOpen({isUploadModalOpen:!1})},r.renderLink=function(e){return i.default.createElement("div",{className:"upload-modal-link"},O.reactFormat(C._("Having problems? Please try again or see our Help center <a>here</a>."),{a:i.default.createElement("a",{href:"/help/space/upload-limitations",rel:"noopener noreferrer",target:"_blank"})}))},r.logAddMoreFilesClick=function(){var e=A.uploaderStore.user();e&&y.logUploadAction(e.id,E.WebUserActionLogEvent.ADD_MORE_FILES_CLICK)},r.renderAddMoreFilesButton=function(e){return i.default.createElement(u.Popover,{onSelection:r.handleFileChoose},i.default.createElement(u.PopoverTrigger,null,i.default.createElement(s.Button,{variant:"secondary",onClick:r.logAddMoreFilesClick},C._("Add more files"))),i.default.createElement(u.PopoverContent,{position:"above"},i.default.createElement(u.PopoverContentItem,{key:"Files",value:!1,className:"action-upload-files",disabled:!1},i.default.createElement(l.IconAction,{name:"upload-file",className:"popover-item-icon"}),C._("Files")),i.default.createElement(u.PopoverContentItem,{key:"Folder",value:!0,className:"action-upload-folder",disabled:!1},i.default.createElement(l.IconAction,{name:"upload-folder",className:"popover-item-icon"}),C._("Folder"))))},r.handleFileChooseOnlyFiles=function(){r.handleFileChoose(!1),r.logAddMoreFilesClick()},r.state=r.getStateFromStores(),r}return r.__extends(t,e),t.prototype.getStateFromStores=function(){return{path:A.uploaderStore.path(),user:A.uploaderStore.user(),fileList:A.uploaderStore.fileList(),numDraggingFiles:A.uploaderStore.numDraggingFiles(),currentUpload:A.uploaderStore.currentUpload(),numSecondsLeft:A.uploaderStore.numSecondsLeft(),hasPermissionToUploadToFolder:A.uploaderStore.hasPermissionToUploadToFolder(),isUploadModalOpen:A.uploaderStore.isUploadModalOpen()}},t.prototype.componentDidMount=function(){A.uploaderStore.add_change_listener(this.handleStoreChanged)},t.prototype.componentDidUpdate=function(e,t){var r=this,a=p.default(".mc-modal").find("#upload-modal-dropzone");this.state.numDraggingFiles?a.length||p.default("#upload-modal-dropzone").clone().prependTo(p.default(".mc-modal")).css({width:"100%",height:"100%",position:"absolute",opacity:0}).show().fadeTo(500,1):a.remove(),this.state.fileList.count()>t.fileList.count()&&(this.focusChooseButton(),setTimeout(function(){var e,a=p.default(o.findDOMNode(r.refs.uploadFilesList));a.find(".upload-file")&&(e=a.find(".upload-file").eq(t.fileList.count())),e&&e.length&&a.scrollTop(a.scrollTop()+e.position().top)},0))},t.prototype.componentWillUnmount=function(){A.uploaderStore.remove_change_listener(this.handleStoreChanged),p.default(window).off("resize.uploaderModal")},t.prototype.isSomethingUploading=function(){return this.state.fileList.some(function(e){return e.status===v.FileStatusType.PENDING||e.status===v.FileStatusType.UPLOADING})},t.prototype.makeUploadSnippet=function(e){var t,r=this.state,a=r.user,o=r.path,i=F.Viewer.get_viewer();return U.assert(null!=a,"user is null"),i.is_paired&&a.is_team&&(t=i.team_name),i.is_paired?a.is_team?this.makeTeamSnippet(o,e,t):this.makePersonalSnippet(o,e):this.makeUnpairedSnippet(o,e)},t.prototype.makeTeamSnippet=function(e,t,r){var a=g.Emstring.em_snippet(S.filename(e),t);return"/"===e?C._("upload to your %(team_name)s Dropbox").format({team_name:r}):C._("upload to the folder ‘%(folder)s’ in your %(team_name)s Dropbox").format({folder:a,team_name:r})},t.prototype.makePersonalSnippet=function(e,t){var r=g.Emstring.em_snippet(S.filename(e),t);return"/"===e?C._("upload to your personal Dropbox"):C._("upload to the folder ‘%(folder)s’ in your personal Dropbox").format({folder:r})},t.prototype.makeUnpairedSnippet=function(e,t){var r=g.Emstring.em_snippet(S.filename(e),t);return"/"===e?C._("upload to your Dropbox"):C._("upload to the folder ‘%(folder)s’").format({folder:r})},t.prototype.renderDropzone=function(){var e=C.ungettext("Drop your file to %(upload_action)s","Drop your files to %(upload_action)s",this.state.numDraggingFiles).format({upload_action:this.makeUploadSnippet(20)});return i.default.createElement("div",{ref:"dropzone",id:"upload-modal-dropzone",style:{display:"none"}},e)},t.prototype.createCancelFileHandler=function(e){var t=this;return function(r){return r.preventDefault(),t.handleCancel(e)}},t.prototype.renderFileListRowStatus=function(e){return e.status===v.FileStatusType.UPLOADING&&100===e.percentUploaded?i.default.createElement("div",{className:"status-col"},i.default.createElement(R.Image,{src:L.static_url("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),srcHiRes:L.static_url("/static/images/icons/ajax-loading-small@2x-vflAxdZTP.gif")})):e.status===v.FileStatusType.PENDING||e.status===v.FileStatusType.UPLOADING?i.default.createElement("div",{className:"status-col"},i.default.createElement("button",{className:"button-as-link",onClick:this.createCancelFileHandler(e)},i.default.createElement(w.Sprite,{group:"web",name:"xclose",alt:C._("Cancel")}))):e.status===v.FileStatusType.COMPLETE?i.default.createElement("div",{className:"status-col"},i.default.createElement(w.Sprite,{group:"web",name:"s_check",alt:C._("Upload successful")})):e.status===v.FileStatusType.CANCELLED?i.default.createElement("div",{className:"status-col"},i.default.createElement(R.Image,{src:L.static_url("/static/images/cancelsync-vflGFIEUK.png"),srcHiRes:L.static_url("/static/images/cancelsync@2x-vflzmHGI0.png"),alt:C._("Upload cancelled")})):e.status===v.FileStatusType.FAILED?i.default.createElement("div",{className:"status-col"},i.default.createElement(R.Image,{src:L.static_url("/static/images/nosync-vfl18cuTS.png"),srcHiRes:L.static_url("/static/images/nosync@2x-vflgS4F07.png"),alt:C._("Error")})):i.default.createElement("div",{className:"status-col"})},t.prototype.renderFileListRowError=function(e){var t;t=e.errorMessage&&e.errorMessage.length>0?e.errorMessage:C._("Something went wrong while uploading this file.");var r;return r=e.errorType===v.UploadErrorType.FILE_SIZE_ERROR?C._("File too large"):C._("Upload Error"),U.assert(null!=this.state.user,"user is null"),this.state.user.is_team&&e.errorType===v.UploadErrorType.OVER_QUOTA_ERROR&&!this.props.isContentManager&&(t=C._("Your Dropbox account is full. To add this file, remove files or ask your admin for more space."),r=C._("Can’t upload file")),i.default.createElement("div",{className:"error-col"},i.default.createElement("span",{className:"error-msg"},r),i.default.createElement("span",{className:"error-details"},i.default.createElement(D.Tooltip,{position:D.TooltipPosition.RIGHT,tooltip_contents:i.default.createElement("div",{},t),tooltip_classname:"upload-error-tooltip"},i.default.createElement(w.Sprite,{group:"web",name:"information",alt:C._("More information")}))))},t.prototype.renderFileListRowDest=function(e){if(e.status===v.FileStatusType.CANCELLED)return i.default.createElement("div",{className:"dest-col"},C._("Canceled"));var t=void 0,r=F.Viewer.get_viewer().get_user_by_id(e.userId);t=this.props.isContentManager?"":c.get_browse_root_name(r);var a=g.Emstring.em_snippet(t+e.dest,13,0);return i.default.createElement("div",{className:"dest-col"},i.default.createElement("a",{href:c.browse_uri_for_fq_path(r,e.dest).toString()},a))},t.prototype.renderFileListRowContent=function(e,t){return e.status!==v.FileStatusType.FAILED&&t?this.renderFileListRowDest(e):this.renderFileListRowError(e)},t.prototype.renderFileListRow=function(e,t){var r;r=e.status===v.FileStatusType.UPLOADING?e.percentUploaded:e.status===v.FileStatusType.PENDING?0:100;var o={"upload-file":!0,complete:e.status===v.FileStatusType.COMPLETE,cancelled:e.status===v.FileStatusType.CANCELLED,error:e.status===v.FileStatusType.FAILED},s=a.default(o),l=g.Emstring.em_snippet(e.name,15),d=e.size?f.format_bytes(e.size):"";return i.default.createElement("li",{className:s,key:e.uploadId,style:{backgroundSize:r+"% 100%"}},i.default.createElement("div",{className:"upload-file-info",style:{overflow:"hidden"}},i.default.createElement("div",{className:"filename-col"},i.default.createElement(n.FileIcon,{className:"brws-file-name-cell-icon",path:e.name}),i.default.createElement("span",{className:"filename"}," ",l," "),i.default.createElement("span",{className:"size"}," ",d," ")),this.renderFileListRowContent(e,t),this.renderFileListRowStatus(e)))},t.prototype.renderFileList=function(e,t){var r=this;return i.default.createElement("ol",{ref:"uploadFilesList",id:"upload-files-list",style:{margin:0,padding:0,maxHeight:228,overflowY:"auto",position:"relative"}},e.map(function(e){return r.renderFileListRow(e,t)}))},t.prototype.renderTimeLeft=function(){var e=this.isSomethingUploading()&&this.state.numSecondsLeft?_.format_time_remaining(this.state.numSecondsLeft):"";return i.default.createElement("div",{style:{marginTop:8,textAlign:"right",minHeight:"1.25em",lineHeight:"1.25"}},e)},t.prototype.renderTitle=function(){return U.assert(null!=this.state.user,"user is null"),this.props.isTeamOnboarding?C._("Which files would you like to add?"):this.state.user.is_cdm_member&&this.props.overQuotaStatus in[v.OverQuotaStatusType.LIMITED_TEAM_USER_OVER_QUOTA,v.OverQuotaStatusType.LIMITED_TEAM_TSD_OVER_QUOTA]?C._("More space needed"):C._("Upload details")},t.prototype.getAltAction=function(){if(this.state.fileList.some(function(e){return e.status===v.FileStatusType.COMPLETE})&&this.props.overQuotaStatus===v.OverQuotaStatusType.BASIC_NEAR_QUOTA){var e=T.getNearquotaUploadAltActionOQA(this.props.lastFileUploadMethod,h.get_uri().path);return i.default.createElement(T.NearquotaUploadAltAction,{oqa:e})}return null},t.prototype.render=function(){var e=this.isSomethingUploading()?C._("Hide"):C._("Done"),t=this.renderTitle(),a=m.is_input_webkitdirectory_supported()?{secondaryAction:this.renderAddMoreFilesButton}:{secondaryAction:C._("Add more files"),onSecondaryAction:this.handleFileChooseOnlyFiles};return i.default.createElement("div",{ref:"container"},this.renderDropzone(),i.default.createElement(d.UtilityModal,r.__assign({},a,{ariaLabel:t,title:t,open:this.state.isUploadModalOpen,width:"640px",overlayClickClose:!0,shouldRequestCloseOnActions:!1,onRequestClose:this.handleDismiss,primaryAction:e,onPrimaryAction:this.handleClose,link:this.renderLink,onReady:this.focusChooseButton,appElement:document.getElementById("embedded-app")}),i.default.createElement(N.UXAnalyticsModalTracking,{id:"uploader-modal"}),this.renderFileList(this.state.fileList.toArray(),this.props.shouldShowDestinationLink),this.renderTimeLeft(),this.getAltAction()))},t})(i.default.PureComponent);t.UploaderModal=M}),define("modules/clean/react/file_uploader/uploader_new",["require","exports","tslib","react","external/lodash","jquery","modules/clean/ajax","modules/clean/analytics","modules/clean/browse/browse_drag_utils","modules/clean/em_string","modules/clean/ajax_as_promised","modules/clean/filepath","modules/clean/web_upload_action_events","modules/clean/web_user_action_events","modules/clean/react/fileops_actions","modules/clean/analytics","modules/clean/react/file_uploader/action_logger","modules/clean/react/file_uploader/actions","modules/clean/react/file_uploader/constants","modules/clean/react/file_uploader/file_uploader_modal","modules/clean/react/file_uploader/inline_upload_status","modules/clean/react/file_uploader/oq_drag_drop_modal","modules/clean/react/file_uploader/plu_wrapper","modules/clean/react/file_uploader/store","modules/clean/react/file_uploader/types","modules/clean/react/modal","modules/clean/viewer","modules/constants/trademark","modules/core/browser","modules/core/browser_detection","modules/core/exception","modules/core/i18n","modules/core/notify","modules/core/uri","modules/clean/react/browse/client_download_modal","modules/core/exception","modules/clean/react/snackbar","modules/clean/react/file_uploader/utils","modules/clean/react/folder_dialog/async"],function(e,t,r,a,o,i,n,s,l,d,u,p,c,h,m,_,f,g,S,E,y,b,v,T,A,I,R,D,w,C,F,L,U,O,P,N,M,x,k){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=r.__importDefault(a),o=r.__importStar(o),i=r.__importDefault(i),n=r.__importStar(n),l=r.__importStar(l),p=r.__importStar(p),m=r.__importStar(m),f=r.__importStar(f),y=r.__importStar(y),v=r.__importDefault(v),w=r.__importStar(w),C=r.__importStar(C),k=r.__importStar(k);var B=null,q=(function(t){function F(e){var i=t.call(this,e)||this;return i._dragEnterCount=0,i._lastEnteredElement=null,i.handleStoreChanged=function(){i.setState(i.getStateFromStores())},i.handleDropOver=function(e){e.preventDefault(),e.stopPropagation()},i.handleDropEnter=function(e){if(e.preventDefault(),e.stopPropagation(),e.target!==i._lastEnteredElement){i._lastEnteredElement=e.target,i._dragEnterCount++;var t=e.originalEvent,r=t.dataTransfer,a=r.mozItemCount,n=0;r.items&&(n=Object.keys(r.items).length);var s=1;a?s=a:n&&(s=n);var l=r.types,d=["Files","application/x-moz-file",C.INTERNAL_FILE_DATA_TRANSFER_TYPE,"text/x-moz-url","text/uri-list","Url"];if(l&&l.indexOf&&o.intersection(l,d).length||l instanceof DOMStringList&&(l.contains("Files")||l.contains("text/x-moz-url")||l.contains(C.INTERNAL_FILE_DATA_TRANSFER_TYPE)||C.msie&&(l.contains("Text")||l.contains("text/plain")))){var u=i.isInternalTransfer(l);g.UploaderActions.setNumDraggingFiles({numDraggingFiles:s,isInternalTransfer:u})}}},i.handleDragLeave=function(e){e.preventDefault(),e.stopPropagation(),i._lastEnteredElement=null,i._dragEnterCount--,i._dragEnterCount<1&&(i._dragEnterCount=0,g.UploaderActions.setNumDraggingFiles({numDraggingFiles:0}))},i.handleUnload=function(e){if(i.isSomethingUploading(i.state)&&i.state.fileList.count()){var t=L._("Leaving this page will cancel your uploads.");return e.returnValue=t,t}},i.handleFileDrop=function(e){var t=T.uploaderStore.user(),r=A.ChooserType.FILE,o=x.generateBatchId();i.setState({fileWasDragged:!0,lastFileUploadMethod:"dnd"}),e.preventDefault(),e.stopPropagation(),i._dragEnterCount=0,i._lastEnteredElement=null,g.UploaderActions.setNumDraggingFiles({numDraggingFiles:0});var n=e.originalEvent.dataTransfer,s=n.getData(C.INTERNAL_FILE_DATA_TRANSFER_TYPE),d=i.state.user;if(N.assert(null!=d,"user is null"),s)try{var u=JSON.parse(s),p=u.userId,_=u.fromPath,E=u.filePaths;if(E&&E.length&&_&&p){if(i.props.isContentManager)return;if(!i.state.hasPermissionToUploadToFolder)return void U.Notify.error(L._("You don’t have permission to add to this folder."));if(p!==d.id)return void U.Notify.error(L._("You can’t move or copy files here from another Dropbox."));return void(e.ctrlKey||e.altKey?m.copyFiles({user:d,files:E.map(function(e){return{fq_path:e}}),newPath:i.state.path,checkFSWs:!0}):_!==i.state.path&&m.moveFiles({user:d,path:_,files:E.map(function(e){return{fq_path:e}}),newPath:i.state.path,checkFSWs:!0}))}}catch(e){}if(R.Viewer.get_viewer().team_is_locked)return void i.showOOQModal(!0);if(i.state.hasPermissionToUploadToFolder){if(i.state.overQuotaStatus===S.OverQuotaStatusType.BASIC_OVER_QUOTA)return void i.showOOQModal();var y=l.getDraggedLink(n);if(y){var b=l.buildUrlLinkfileContents(y),I=new Blob([b],{type:"text/plain"}),D=O.URI.parse(y).getAuthority();if(D===w.get_hostname()||"dl-web.dropbox.com"===D||D===["www.dropboxstatic.com","cf.dropboxstatic.com","cfl.dropboxstatic.com","www.dropbox.com","dl-web.dropbox.com","dl.dropboxusercontent.com","previews.dropboxusercontent.com","previews.dropbox.com"][0]||D===["www.dropboxstatic.com","cf.dropboxstatic.com","cfl.dropboxstatic.com","www.dropbox.com","dl-web.dropbox.com","dl.dropboxusercontent.com","previews.dropboxusercontent.com","previews.dropbox.com"][1]||D===["www.dropboxstatic.com","cf.dropboxstatic.com","cfl.dropboxstatic.com","www.dropbox.com","dl-web.dropbox.com","dl.dropboxusercontent.com","previews.dropboxusercontent.com","previews.dropbox.com"][2])return;return I.name="#"+D+".url",I.overwrite=!1,I.batchId=o,void g.UploaderActions.addFilesToPLU({files:[I],dropTarget:e.target})}var F=n.items,P=n.files;if(F&&F[0].webkitGetAsEntry){for(var k=[],B=0;B<F.length;B++)k.push(F[B].webkitGetAsEntry());for(var q=[],H=[],Q=0,G=k;Q<G.length;Q++){var W=G[Q];W&&W.isFile&&q.push(W),W&&W.isDirectory&&(H.push(W),r=A.ChooserType.FOLDER)}q.length>0&&H.length>0&&(r=A.ChooserType.FILE_FOLDER),f.logUploadAction(t.id,h.WebUserActionLogEvent.UPLOAD_BUTTON_CLICK,void 0,r,A.UploadMethod.DRAG);for(var V=Object.create(null),z=[],j=q.length+H.length,K=function(t){for(var r=0,a=t;r<a.length;r++){var o=a[r];z.push(o.entry);var i=o.dest?o.dest:"",n=V[i];n?n.push(o.entry):V[i]=[o.entry]}if(0===--j){var s=function(){for(var t in V){var r=V[t];g.UploaderActions.addFilesToPLU({files:r,path:t?t:void 0,dropTarget:e.target})}};v.default.tryAddFiles(z,s)}},Y=0,X=q;Y<X.length;Y++){var Z=X[Y];Z.file&&Z.file(function(e){var r=e;r.batchId=o,K([{entry:r,dest:void 0}]),f.logUploadAction(t.id,c.WebUploadActionEvent.UPLOAD_ATTEMPT,r,A.ChooserType.FILE,A.UploadMethod.DRAG,q.length)})}H.length&&(g.UploaderActions.addDirectoriesToPLU({directoryEntries:H,batchId:o,onFinish:K}),f.logUploadAction(t.id,c.WebUploadActionEvent.UPLOAD_ATTEMPT,void 0,A.ChooserType.FOLDER,A.UploadMethod.DRAG,void 0,H.length))}else if(P&&P.length){for(var J=[],B=0;B<P.length;B++){var $=P.item(B);$.batchId=o,J.push($)}r=A.ChooserType.UNKNOWN,f.logUploadAction(t.id,h.WebUserActionLogEvent.UPLOAD_BUTTON_CLICK,void 0,r,A.UploadMethod.DRAG),v.default.tryAddFiles(J,function(){g.UploaderActions.addFilesToPLU({files:J,dropTarget:e.target})});for(var ee=0,te=J;ee<te.length;ee++){var $=te[ee];f.logUploadAction(t.id,c.WebUploadActionEvent.UPLOAD_ATTEMPT,$,r,A.UploadMethod.DRAG,J.length)}}else C.msie&&P&&0===P.length&&(r=A.ChooserType.FOLDER,M.Snackbar.show(a.default.createElement(M.Snackbar,{title:L._("Can’t upload folders in Internet Explorer. Upload the files separately or try another browser."),variant:"fail",closeButtonText:"Close"})),f.logUploadAction(t.id,h.WebUserActionLogEvent.UPLOAD_BUTTON_CLICK,void 0,r,A.UploadMethod.DRAG))}},i.state=r.__assign({},i.getStateFromStores(),{isTeamOnboarding:!1,userQuotaUsageRatio:0,tsdQuotaUsageRatio:0,inExcludedNses:!1,numTeamMembers:0,numTeamAdmins:0,teamAdminEmail:"",teamAdminFname:"",promptAdminToUpgradeEmailTemplateUrl:"",overQuotaStatus:S.OverQuotaStatusType.NONE,fileWasDragged:!1,isInlineStatusShowing:!1}),i}return r.__extends(F,t),F.prototype.getStateFromStores=function(){return{path:T.uploaderStore.path(),user:T.uploaderStore.user(),hasOverquotaError:T.uploaderStore.hasOverquotaError(),fileList:T.uploaderStore.fileList(),numDraggingFiles:T.uploaderStore.numDraggingFiles(),isInternalTransfer:T.uploaderStore.isInternalTransfer(),currentUpload:T.uploaderStore.currentUpload(),isUploadModalOpen:T.uploaderStore.isUploadModalOpen(),numSecondsLeft:T.uploaderStore.numSecondsLeft(),inlineStatusShouldBeDismissed:T.uploaderStore.inlineStatusShouldBeDismissed(),hasPermissionToUploadToFolder:T.uploaderStore.hasPermissionToUploadToFolder()}},F.showModal=function(){B&&B.showModal()},F.showOOQModal=function(e){void 0===e&&(e=!1),B&&B.showOOQModal(e)},F.showModalWithTeamOnboarding=function(){B&&B.setState({isTeamOnboarding:!0},B.showModal)},F.prototype.handleUploadButtonClick=function(e){var t=T.uploaderStore.user();this.setState({lastFileUploadMethod:"upm"}),this.state.overQuotaStatus!==S.OverQuotaStatusType.NONE&&this.state.overQuotaStatus!==S.OverQuotaStatusType.BASIC_NEAR_QUOTA?this.showModal():(this.props.uploaderExperiments&&this.props.uploaderExperiments.expUploadWithFolderPicker&&k.prewarmFolderDialog(),e?(v.default.showFolderPicker(),f.logUploadAction(t.id,h.WebUserActionLogEvent.UPLOAD_FOLDER_CLICK,void 0,A.ChooserType.FOLDER,A.UploadMethod.CHOOSER)):(v.default.showFilePicker(),f.logUploadAction(t.id,h.WebUserActionLogEvent.UPLOAD_FILES_CLICK,void 0,A.ChooserType.FILE,A.UploadMethod.CHOOSER)))},F.prototype.showModal=function(){if(this.setState({fileWasDragged:!1}),this.fetchQuotaUpsellInfo(),R.Viewer.get_viewer().team_is_locked)this.showOOQModal(!0);else if(this.state.fileList.count()||this.state.overQuotaStatus!==S.OverQuotaStatusType.NONE&&this.state.overQuotaStatus!==S.OverQuotaStatusType.BASIC_NEAR_QUOTA){var t=this.props.uploaderExperiments||{},o=this.props.uploaderPostTTIExperiments||{},i=o.expProOQUploadModal;if(u.SilentBackgroundRequest({url:"/log/stormcrow_exposures",data:{stormcrow_name:"subgrowth_pro_oq_upload_modal",variant:i}}),this.state.user&&!this.state.user.is_team&&"V1"===i){var n=this.props.browseViewType?"wb_oq_upm_fb":"wb_oq_upm_h";new Promise(function(t,r){e(["modules/clean/react/overquota_modal_controller"],t,r)}).then(r.__importStar).then(function(e){e.showOverquota({oqa:n,tagline:L._("Before you can upload to Dropbox, you need to get more space."),ctaText:L._("Upgrade to Upload")})})}else I.Modal.showInstance(a.default.createElement(E.FileUploaderModal,{dragAndDropEnabled:!!this.props.dragAndDropEnabled,shouldShowDestinationLink:!!this.props.shouldShowDestinationLink,onModalDismissed:this.props.onModalDismissed,isTeamOnboarding:this.state.isTeamOnboarding,isContentManager:!!this.props.isContentManager,numTeamMembers:this.state.numTeamMembers,numTeamAdmins:this.state.numTeamAdmins,teamAdminEmail:this.state.teamAdminEmail,teamAdminFname:this.state.teamAdminFname,promptAdminToUpgradeEmailTemplateUrl:this.state.promptAdminToUpgradeEmailTemplateUrl,overQuotaStatus:this.state.overQuotaStatus,uploaderExperiments:t,lastFileUploadMethod:this.state.lastFileUploadMethod})),g.UploaderActions.setIsUploadModalOpen({isUploadModalOpen:!0}),this.state.overQuotaStatus===S.OverQuotaStatusType.BASIC_OVER_QUOTA&&_.NQOQLogger.logViewModal("wb_oq_upm",{modal_type:"utility"})}},F.prototype.showOOQModal=function(e){void 0===e&&(e=!1);var t=this.state.fileList.toArray().filter(function(e){return e.errorType===S.UploadErrorType.OVER_QUOTA_ERROR||e.errorType===S.UploadErrorType.GENERIC||e.errorType===S.UploadErrorType.LOCKED_TEAM_ERROR}),r=t&&t[t.length-1]?t[t.length-1].name:L._("this file"),o=e||this.state.fileList.toArray().filter(function(e){return e.errorType===S.UploadErrorType.LOCKED_TEAM_ERROR}).length>0;I.Modal.showInstance(a.default.createElement(b.OQDragDropModal,{oqFilename:r,isLockedTeam:o,isContentManager:!!this.props.isContentManager,isTeamUser:!!this.state.user.is_team})),_.NQOQLogger.logViewModal("wb_oq_dnd",{modal_type:"billboard"})},F.prototype.componentWillMount=function(){if(B)throw new Error("Only one FileUploader component may be rendered to the page at any time.You have tried to instantiate multiple uploaders.");B=this},F.prototype.componentDidMount=function(){var e=this.props,t=e.ajaxInterceptor,r=e.chooseDestination,a=e.dragAndDropEnabled,o=e.isContentManager,n=e.rootNSIDForCM,s=e.uploaderExperiments,l=void 0===s?{}:s,d=l.expUploadWithFolderPicker,u=l.expWebUploadsWithWaterfall,p=l.expWebUploadsInvalidExtensionWarningModal;T.uploaderStore.add_change_listener(this.handleStoreChanged),g.UploaderActions.initPLU({chooseDestination:r,isContentManager:o,rootNSIDForCM:n,expUploadWithFolderPicker:d,expWebUploadsWithWaterfall:u,expWebUploadsInvalidExtensionWarningModal:p}),g.UploaderActions.setAjaxInterceptor(t),g.UploaderActions.setIsContentManager(o),this._dragEnterCount=0,this._lastEnteredElement=null,a&&i.default(document).on("dragover.fileUploader",this.handleDropOver).on("dragenter.fileUploader",this.handleDropEnter).on("dragleave.fileUploader",this.handleDragLeave).on("drop.fileUploader",this.handleFileDrop),i.default(window).on("beforeunload.fileUploader",this.handleUnload),this.state.user&&this.fetchQuotaUpsellInfo()},F.prototype.updateInlineStatus=function(){
var e=this,t=this.state,r=t.currentUpload,a=t.fileList,o=t.hasOverquotaError,i=t.inlineStatusShouldBeDismissed,n=t.isInlineStatusShowing,s=t.isUploadModalOpen,l=t.numSecondsLeft,d=T.uploaderStore.user(),u=this.isSomethingUploading(this.state),p=!s&&(u||!u&&!i&&a.toArray().filter(function(e){return e.status!==S.FileStatusType.CANCELLED}).length>0);p=!(o&&!u)&&p,p?y.showInlineUploadStatusSnackbar({fileList:a,currentUpload:r,onViewDetails:function(){e.showModal(),f.logUploadAction(d.id,h.WebUserActionLogEvent.VIEW_DETAILS_CLICK)},numSecondsLeft:l,onShown:function(){e.setState({isInlineStatusShowing:!0})},onClosed:function(){e.setState({isInlineStatusShowing:!1})}}):n&&M.Snackbar.close()},F.prototype.componentWillUpdate=function(e,t){if(!t.currentUpload&&this.state.currentUpload&&(this.props.onFileUploadComplete&&this.props.onFileUploadComplete(this.state.currentUpload),this.state.isTeamOnboarding&&s.TeamsWebActionsLogger.log("uploaded_file")),t.fileList!==this.state.fileList){!this.isSomethingUploading(t)&&t.fileList.count()&&(t.fileWasDragged||P.maybeShowClientDownloadModal(!1),this.props.onAllFileUploadsComplete&&this.props.onAllFileUploadsComplete(this.state.fileList))}},F.prototype.componentDidUpdate=function(e,t){var r=this.state,a=r.hasOverquotaError,o=r.hasPermissionToUploadToFolder,n=r.isInternalTransfer,s=r.isUploadModalOpen,l=r.numDraggingFiles,d=r.user,u=i.default(".external-drop-indicator");if(l&&!n){if(t.numDraggingFiles||u.css("opacity",0).fadeTo(500,.6),o?u.removeClass("external-drop-indicator--uploads-disabled"):u.addClass("external-drop-indicator--uploads-disabled"),!s)if(o)if(R.Viewer.get_viewer().team_is_locked)U.Notify.error(L._("Can’t upload. Your team no longer has full use of %(trademark_business)s features.").format({trademark_business:D.TRADEMARK_BUSINESS}));else{var p=L._("Drop your files to %(upload_action)s",{comment:"upload_action is a phrase like 'upload to folder 'XYZ'"}).format({upload_action:this.makeUploadSnippet(1e3)});U.Notify.success(p,60)}else U.Notify.error(L._("You don’t have permission to add to this folder."))}else!l&&t.numDraggingFiles&&(u.hide().removeClass("external-drop-indicator--uploads-disabled"),U.Notify.clear());this.updateInlineStatus(),!t.user&&d&&this.fetchQuotaUpsellInfo(),!t.hasOverquotaError&&a&&this.showOOQModal()},F.prototype.fetchQuotaUpsellInfo=function(){var e=this;N.assert(null!=this.state.user,"user is null"),n.SilentBackgroundRequest({url:"/get_info_for_quota_upsell",data:{_subject_uid:this.state.user.id},success:function(t){t=JSON.parse(t),e.setState({userQuotaUsageRatio:t.user_quota_usage_ratio,tsdQuotaUsageRatio:t.tsd_quota_usage_ratio,inExcludedNses:t.in_excluded_nses,promptAdminToUpgradeEmailTemplateUrl:t.prompt_admin_to_upgrade_email_template_url,numTeamMembers:t.num_team_members,numTeamAdmins:t.num_team_admins,teamAdminEmail:t.team_admin_email,teamAdminFname:t.team_admin_fname},function(){e.fetchOverQuotaStatus()})}})},F.prototype.fetchOverQuotaStatus=function(){var e=this.state,t=e.path,r=e.tsdQuotaUsageRatio,a=e.inExcludedNses,o=e.user,i=e.userQuotaUsageRatio;if(N.assert(null!=o,"user is null"),o.paid||a)return void this.setState({overQuotaStatus:S.OverQuotaStatusType.NONE});if("personal"===o.role){if(i>1)return void this.setState({overQuotaStatus:S.OverQuotaStatusType.BASIC_OVER_QUOTA});if(i>.9)return void this.setState({overQuotaStatus:S.OverQuotaStatusType.BASIC_NEAR_QUOTA})}if(o.is_team&&R.Viewer.get_viewer().team_is_limited){var n=o.cdm_tmf_path;if(!o.is_cdm_member||n&&t.startsWith(n)){if(i>1)return void this.setState({overQuotaStatus:S.OverQuotaStatusType.LIMITED_TEAM_USER_OVER_QUOTA})}else if(r>1)return void this.setState({overQuotaStatus:S.OverQuotaStatusType.LIMITED_TEAM_TSD_OVER_QUOTA})}if(o.is_team&&R.Viewer.get_viewer().team_is_locked)return void this.setState({overQuotaStatus:S.OverQuotaStatusType.LOCKED_TEAM_USER_OVER_QUOTA});this.setState({overQuotaStatus:S.OverQuotaStatusType.NONE})},F.prototype.componentWillUnmount=function(){T.uploaderStore.remove_change_listener(this.handleStoreChanged),i.default(document).off("dragover.fileUploader").off("dragenter.fileUploader").off("dragleave.fileUploader").off("drop.fileUploader"),i.default(window).off("beforeunload.fileUploader"),B=null},F.prototype.isSomethingUploading=function(e){return e.fileList.some(function(e){return e.status===S.FileStatusType.PENDING||e.status===S.FileStatusType.UPLOADING})},F.prototype.makeUploadSnippet=function(e){var t,r=this.state,a=r.user,o=r.path,i=R.Viewer.get_viewer();return N.assert(null!=a,"user is null"),i.is_paired&&a.is_team&&(t=i.team_name),i.is_paired?a.is_team?this.makeTeamSnippet(o,e,t):this.makePersonalSnippet(o,e):this.makeUnpairedSnippet(o,e)},F.prototype.makeTeamSnippet=function(e,t,r){var a=d.Emstring.em_snippet(p.filename(e),t);return"/"===e?L._("upload to your %(team_name)s Dropbox").format({team_name:r}):L._("upload to the folder ‘%(folder)s’ in your %(team_name)s Dropbox").format({folder:a,team_name:r})},F.prototype.makePersonalSnippet=function(e,t){var r=d.Emstring.em_snippet(p.filename(e),t);return"/"===e?L._("upload to your personal Dropbox"):L._("upload to the folder ‘%(folder)s’ in your personal Dropbox").format({folder:r})},F.prototype.makeUnpairedSnippet=function(e,t){var r=d.Emstring.em_snippet(p.filename(e),t);return"/"===e?L._("upload to your Dropbox"):L._("upload to the folder ‘%(folder)s’").format({folder:r})},F.prototype.isInternalTransfer=function(e){return e instanceof DOMStringList?e.contains("Text")||e.contains("text/plain"):e.includes(C.INTERNAL_FILE_DATA_TRANSFER_TYPE)||e.includes("text/plain")},F.prototype.render=function(){return a.default.createElement("div",null)},F.defaultProps={dragAndDropEnabled:!0,shouldShowDestinationLink:!0,isContentManager:!1,chooseDestination:!1},F})(a.default.PureComponent);t.FileUploader=q}),define("modules/clean/react/overquota_modal",["require","exports","tslib","react","spectrum/tertiary_link","modules/clean/react/css","modules/clean/react/image","modules/core/i18n","modules/clean/analytics","modules/clean/static_urls","modules/clean/react/modal","modules/constants/payments","modules/clean/react/overquota_modal_helpers","modules/clean/analytics"],function(e,t,r,a,o,i,n,s,l,d,u,p,c,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=r.__importDefault(a),p=r.__importStar(p);var m=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.dismiss=function(){u.Modal.close(),t.trackCancel()},t.trackCTAClick=function(){var e=t.props.ctaTextUntranslated,r=e?e.toLowerCase():"";if(t.props.activeUser){l.ShareTibEventLogger.log(t.props.activeUser.id,"OUT_OF_QUOTA_MODAL_UPGRADE","OUT_OF_QUOTA_MODAL",{ns_id:t.props.nsId,usage_remaining:t.props.usageRemaining,usage_needed:t.props.usageNeeded})}l.NQOQLogger.logAcceptModal(t.props.oqa,{modal_type:"billboard",cta_text:r}),t.props.isRequestModal&&h.ProEventsLogger.log("oq_fr_click")},t.trackClose=function(){l.NQOQLogger.logCloseModal(t.props.oqa,{modal_type:"billboard"})},t.trackCancel=function(){l.NQOQLogger.logCancelModal(t.props.oqa,{modal_type:"billboard"})},t._renderButtons=function(){var e=t.props.oqa,r=p.OUT_OF_SPACE_URL+"?oqa="+e;return e.search("_nq_")!==-1&&(r=p.LOW_SPACE_URL+"?oqa="+e),a.default.createElement(u.ModalButtons,{className:"oq-modal__buttons"},a.default.createElement("a",{href:r,id:"oq-cta-button",className:"mc-button mc-button-primary",onClick:t.trackCTAClick},t.props.ctaText))},t}return r.__extends(t,e),t.prototype._renderAltAction=function(){return this.props.dismissText?a.default.createElement("div",{className:"overquota_modal__alt-action-container"},a.default.createElement(o.TertiaryLink,{onClick:this.dismiss},this.props.dismissText)):null},t.prototype._renderContentTitle=function(){return a.default.createElement("p",{className:"oq-modal__content--title"},this.props.headline)},t.prototype._renderImage=function(){if(this.props.imageObject){var e=this.props.imageObject,t=e.height,r=e.width,o=e.src,i=e.srcHiRes;return a.default.createElement(n.Image,{height:t,width:r,src:d.static_url(o),srcHiRes:d.static_url(i)})}},t.prototype.render=function(){return a.default.createElement(u.Modal,{className:"overquota_modal",title:this.props.headline,buttonComponent:this._renderButtons(),altAction:this._renderAltAction(),style:"clean",showX:this.props.showX,onDismiss:this.trackClose},a.default.createElement("div",{className:"oq-modal__content"},this._renderImage(),this._renderContentTitle(),a.default.createElement("p",null,this.props.tagline)))},t.defaultProps={headline:s._("Your Dropbox is full"),tagline:s._("Before you can update or move your files, you need more space."),imageObject:c.constructImageObject(),oqa:"",ctaText:s._("Get more space"),ctaTextUntranslated:"Get more space",showX:!0},t})(a.default.Component);t.OverquotaModalElement=m,t.OverquotaModal=i.requireCssWithComponent(m,["/static/css/react/overquota_modal-vflG9lYFj.css"])}),define("modules/clean/sharing/async_folder_settings_modal",["require","exports","tslib","react","modules/clean/flux/dispatcher","modules/clean/viewer","modules/clean/sharing/share_page/action_types","modules/clean/sharing/share_page/store","modules/clean/react/modal"],function(e,t,r,a,o,i,n,s,l){"use strict";function d(t,d,u){return r.__awaiter(this,void 0,void 0,function(){var p;return r.__generator(this,function(c){switch(c.label){case 0:return[4,new Promise(function(t,r){e(["modules/clean/sharing/folder_settings_modal"],t,r)}).then(r.__importStar)];case 1:return p=c.sent().SharedFolderSettingsModal,l.Modal.showInstance(a.default.createElement(p,{folderName:t.name,folderId:t.shared_folder_id,folderPath:t.path_lower,initialHasParentSharedFolder:null!=t.parent_shared_folder_id,initialIsTeamSharedFolder:t.is_team_folder,initialMetadata:t,initialOwnerTeam:t.owner_team,initialPermissions:t.permissions,initialPolicy:u,isConfidentialFolder:t.is_confidential,isLimitedTeam:i.Viewer.get_viewer()&&i.Viewer.get_viewer().team_is_limited,isSharedFolder:!0,linkMetadata:t.link_metadata,onPolicySet:function(e,t){o.Dispatcher.dispatch({type:n.SharePageActionTypes.FETCH_FOLDER_POLICY_SUCCESS,folderPolicy:e,metadata:t,user:d}),l.Modal.close()},teamPolicy:s.SharePageStore.getCurrentTeamPolicy(d.id),user:d})),[2]}})})}Object.defineProperty(t,"__esModule",{value:!0}),a=r.__importDefault(a),t.asyncShowSharedFolderSettingsModal=d}),define("modules/clean/sharing/out_of_quota_modal",["require","exports","tslib","react","modules/clean/analytics","modules/clean/display_format","modules/clean/em_string","modules/clean/growth/experiments/overquota_sharing_helper","modules/clean/react/button","modules/clean/react/modal","modules/clean/react/sprite","modules/clean/sharing/constants","modules/clean/sharing/views/hover_close_button","modules/clean/stormcrow/stormcrow_exposure_logger","modules/clean/viewer","modules/clean/web_timing_logger","modules/constants/payments","modules/core/browser","modules/core/i18n","modules/core/uri","modules/clean/react/overquota_modal","modules/clean/react/overquota_modal_helpers"],function(e,t,r,a,o,i,n,s,l,d,u,p,c,h,m,_,f,g,S,E,y,b){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=r.__importDefault(a),i=r.__importStar(i),s=r.__importStar(s),c=r.__importDefault(c),_=r.__importStar(_),f=r.__importStar(f),g=r.__importStar(g),S=r.__importStar(S);var v=S.i18n_default_project("sharing")._,T=(function(e){function t(t){var r=e.call(this,t)||this;return r.ASK="ask",r.ASKING="asking",r.handleModalClose=function(){var e=r.props.queryParams;o.NQOQLogger.logCloseModal(e,{modal_type:"billboard"}),r.refs.modal.close(),r.logClose()},r.onDismiss=function(){var e=r.props.queryParams;o.NQOQLogger.logCloseModal(e,{modal_type:"billboard"}),r.logClose()},r.logClose=function(){var e=_.start_time(),t=(new Date).getTime();o.ShareTibEventLogger.log(r.props.activeUser.id,"OUT_OF_QUOTA_MODAL_CLOSE",p.SHARE_ACTION_ORIGIN_TYPE.OUT_OF_QUOTA_MODAL,{timing:t-e,ns_id:r.props.nsId})},r._handleDismissText=function(){d.Modal.close(),r.onDismiss()},r.renderContents=function(){var e=r.state.showX;return a.default.createElement("div",{className:"content-link-sync-modal__content u-mar-bottom-xs"},a.default.createElement("div",{className:"content-link-sync-modal__top-panel u-pad-s"},a.default.createElement("div",{className:"content-link-sync-modal__icon"},a.default.createElement(u.Sprite,{alt:"",group:"web",name:"folder_user_32"})),a.default.createElement("div",{className:"content-link-sync-modal__name-size u-l-ib u-pad-left-xs u-pad-top-xs o-flag__flex"},a.default.createElement("h3",{className:"u-font-strong"},n.Emstring.em_snippet(r.props.folderName,p.SNIPPET_SIZES.OUT_OF_QUOTA_FOLDER_NAME)),a.default.createElement("h4",{className:"u-trim-margin u-font-meta"},i.format_bytes(r.props.folderSize))),e&&a.default.createElement("div",{className:"content-link-sync-modal__close u-pad-xs o-flag__fix"},a.default.createElement(c.default,{onClick:r.handleModalClose}))),a.default.createElement("div",{className:"content-link-sync-modal__tip-panel"},a.default.createElement("div",{className:"content-link-sync-modal__access-text"},r.getTitleText()),a.default.createElement("div",{className:"content-link-sync-modal__tip-body"},r.getTipText())))},r.getTipText=function(){return r.isLimitedCdmTeam()?r.getLimitedCdmTeamMessage():r.props.activeUser.is_team?a.default.createElement("div",null,a.default.createElement("div",null,v("Your Dropbox account is full.")),a.default.createElement("div",null,v("To add this folder, remove files or ask your admin for more space."))):"V1"===r.props.expProShareUpsellModalFileAttr?v("To add this folder, you’ll need more space in your Dropbox."):r.props.usageRemaining>0?v("To add this folder, you’ll need %(needed)s of space in your Dropbox.   You currently have %(remaining)s of space left.").format({remaining:i.format_bytes(r.props.usageRemaining),needed:i.format_bytes(r.props.usageNeeded)}):v("To add this folder, you’ll need %(needed)s of space in your Dropbox.   You currently have no space left.").format({needed:i.format_bytes(r.props.usageNeeded)})},r.renderButtons=function(){var e=r.getCtaText();return"OFF"!==r.props.expSubgrowthProShmCtaCopy&&r.state.buttonText&&(e=r.state.buttonText),a.default.createElement("div",{className:"content-link-sync-modal__buttons u-mar-bottom-s"},a.default.createElement(l.button,{importance:"primary",className:"content-link-sync-modal__add-to-dropbox-button",disabled:r.state.state===r.ASKING,onClick:r.onUpgradeButtonClicked},e),r._renderDismissButton())},r.onUpgradeButtonClicked=function(){r.setState({state:r.ASKING});o.ShareTibEventLogger.log(r.props.activeUser.id,"OUT_OF_QUOTA_MODAL_UPGRADE","OUT_OF_QUOTA_MODAL",{ns_id:r.props.nsId,usage_remaining:r.props.usageRemaining,usage_needed:r.props.usageNeeded}),r.isLimitedCdmTeamMember()&&(window.location.href=r.props.promptAdminToUpgradeEmailUrl);var e=r.props.queryParams,t={oqa:e},a="wb_nq_shm_share_w"===e||"wb_nq_shm_share_ro"===e?f.LOW_SPACE_URL:f.OUT_OF_SPACE_URL,i=m.Viewer.get_viewer();r.props.activeUser.is_team&&i.team_is_limited&&r.props.numMembersOnTeam>1?(a="/team/upgrade",r.props.activeUser.is_team_admin||(t.open_admin_prompt_modal="1")):r.props.activeUser.is_team?(a="/help/business/space-limit-full",t={}):o.NQOQLogger.logAcceptModal(e,{modal_type:"billboard",cta_text:"upgrade to add folder"}),g.redirect(new E.URI({path:a}).updateQuery(t).toString())},r.getLimitedCdmTeamMessage=function(){var e=v("You need an additional %(space_needed)s in your Dropbox to add this folder.").format({space_needed:i.format_bytes(r.props.usageNeeded)});return r.props.activeUser.is_team_admin||!r.props.teamAdminInfo.num_admins?e:v("%(space_needed_sentence)s To get more space, ask your Dropbox admin (%(admin_email)s).").format({space_needed_sentence:e,admin_email:r.props.teamAdminInfo.admin_email})},r.getTitleText=function(){return v(r.isLimitedCdmTeam()?"More space needed":r.props.activeUser.is_team?"Can’t add folder":"Not enough space")},r.getCtaText=function(){return r.isLimitedCdmTeam()?r.props.activeUser.is_team_admin||!r.props.teamAdminInfo.num_admins?v("Get more space"):v("Email %(admin_fname)s").format({admin_fname:r.props.teamAdminInfo.admin_fname}):v(r.props.activeUser.is_team?"Learn more about Dropbox space":"Upgrade to add folder")},r.isLimitedCdmTeam=function(){return r.props.activeUser.is_cdm_member&&m.Viewer.get_viewer().team_is_limited},r.isLimitedCdmTeamMember=function(){return r.isLimitedCdmTeam()&&!r.props.activeUser.is_team_admin&&r.props.teamAdminInfo.num_admins>0},r.state={state:r.ASK,showX:!0},r}return r.__extends(t,e),t.prototype.componentWillMount=function(){var e=_.start_time(),t=(new Date).getTime(),a=m.Viewer.get_viewer().get_users(),i=a.length>0?a[0].id:null;if(i){var n=p.SHARE_ACTION_ORIGIN_TYPE.OUT_OF_QUOTA_MODAL;o.ShareTibEventLogger.log(i,"OUT_OF_QUOTA_MODAL_RENDER",n,{timing:t-e,ns_id:this.props.nsId})}var l=this.props.expSubgrowthProShmCtaCopy;if(l&&"OFF"!==l){this.setState(r.__assign({},this.state,s.getModalConfigSubgrowthProShmCtaCopy(l)));(new h.StormcrowExposureLogger).logExposuresOnce({subgrowth_pro_shm_cta_copy:l})}},t.prototype._renderDismissButton=function(){return this.state.secondaryCtaText&&this.state.secondaryCtaText.length?a.default.createElement("button",{className:"content-link-sync-modal__not-now-label button-as-link",onClick:this._handleDismissText},this.state.secondaryCtaText):null},t.prototype.render=function(){return a.default.createElement(d.Modal,{autoClose:!1,buttonComponent:this.renderButtons(),className:"content-link-sync-modal",clickOutToClose:!1,ref:"modal",showX:!1,title:"",onDismiss:this.onDismiss},this.renderContents())},t.displayName="OutOfQuotaModal",t})(a.default.Component);t.OutOfQuotaModal=T;var A=function(e){var t=e.expProShareUpsellModalFileAttr,i=e.expSubgrowthProShareModalIllustration,n=e.expSubgrowthProShmCtaCopy;if(t&&"OFF"!==t||n&&"OFF"!==n||i&&"OFF"!==i){var l=null;t&&"OFF"!==t&&(l={subgrowth_pro_share_upsell_modal_file_attr:t});var u=null;t&&"V2"===t&&i&&"OFF"!==i&&(u={subgrowth_pro_share_modal_illustration:i});var p=null;n&&"OFF"!==n&&(p={subgrowth_pro_shm_cta_copy:n});(new h.StormcrowExposureLogger).logExposuresOnce(r.__assign({},l,u,p))}var c=s.getModalConfigSubgrowthProShmCtaCopy(n),m=c.buttonText,_=c.buttonTextUntranslated,f=c.secondaryCtaText,g=c.showX,S=e.queryParams;if(t&&"V2"===t){var E=b.constructImageObject(i);d.Modal.showInstance(a.default.createElement(y.OverquotaModal,{headline:v("Not enough space"),tagline:v("To add this folder, you’ll need more space in your Dropbox."),oqa:S,imageObject:E,ctaText:m,ctaTextUntranslated:_,dismissText:f,showX:g,activeUser:e.activeUser,nsId:e.nsId,usageRemaining:e.usageRemaining,usageNeeded:e.usageNeeded})),o.NQOQLogger.logViewModal(S,{modal_type:"billboard"})}else e=r.__assign({},e,{dismissText:f,ctaText:m,showX:g}),d.Modal.showInstance(a.default.createElement(T,r.__assign({},e))),o.NQOQLogger.logViewModal(S,{modal_type:"utility"})};t.showOutOfQuotaModal=A}),define("modules/clean/sharing/share_page/actions",["require","exports","tslib","react","external/react-dom","modules/clean/account/email","modules/clean/account/email_verify_reasons","modules/clean/analytics","modules/clean/api_v2/error","modules/clean/api_v2/user_client","modules/clean/flux/dispatcher","modules/clean/flux/store_listener","modules/clean/history","modules/clean/react/modal","modules/clean/sharing/api/client","modules/clean/sharing/api/util/types","modules/clean/sharing/async_folder_settings_modal","modules/clean/sharing/async_share_modal_util","modules/clean/sharing/confirmation_modals/relinquish_membership_confirmation_modal","modules/clean/sharing/confirmation_modals/reset_access_modal","modules/clean/sharing/constants","modules/constants/sharing","modules/clean/sharing/out_of_quota_modal","modules/clean/sharing/share_page/action_types","modules/clean/sharing/share_page/store","modules/clean/sharing/share_page/types","modules/clean/sharing/share_page/util","modules/clean/sharing/share_page/views/share_page","modules/clean/sharing/ui_notifications_util","modules/clean/sharing/wizard/async_wizard_modals","modules/clean/viewer","modules/clean/web_timing_logger","modules/constants/sharing","modules/core/browser","modules/core/i18n"],function(e,t,r,a,o,i,n,s,l,d,u,p,c,h,m,_,f,g,S,E,y,b,v,T,A,I,R,D,w,C,F,L,U,O,P){"use strict";function N(){if(b.SHARING_EXPERIMENTS.ENABLE_SPECTRUM_SHARING_MODAL)return h.Modal.close()}Object.defineProperty(t,"__esModule",{value:!0}),a=r.__importDefault(a),o=r.__importDefault(o),n=r.__importStar(n),c=r.__importDefault(c),f=r.__importStar(f),g=r.__importStar(g),S=r.__importStar(S),R=r.__importStar(R),L=r.__importStar(L),O=r.__importStar(O),P=r.__importStar(P);var M=P.i18n_default_project("sharing")._,x={initialize:function(e){e=e||{};var t=e.containerId,r=e.groupsEnabled||!1,a=e.activeUserId||null,i=e.expProShareUpsellModalFileAttr||null,n=e.expSubgrowthProShareModalIllustration||null,s=e.numMembersOnTeam||0,l=null!=e.pageSize?e.pageSize:100,p=e.teamAdminInfo||null,h=e.promptAdminToUpgradeEmailUrl||null,_=e.disablePrefetchFallback||!1,f=e.searchBarExperiments||null,g=e.logSharePageApplicationCodeStart===!0,S=e.expSubgrowthProOQNewFolder||"CONTROL",E=e.expSubgrowthProShmCtaCopy||"OFF",y={variant:e.expSubgrowthProSharePageUpdates&&e.expSubgrowthProSharePageUpdates.variant?e.expSubgrowthProSharePageUpdates.variant:"CONTROL",quotaType:e.expSubgrowthProSharePageUpdates&&e.expSubgrowthProSharePageUpdates.quotaType?e.expSubgrowthProSharePageUpdates.quotaType:null},b=e.expGrowthBBizWebGrouper||null,v=e.expGrowthBIndWebGrouper||null,A=e.viewer||null;if(g&&L.log_js_modules_application_code_start(),this.expProShareUpsellModalFileAttr=i,this.expSubgrowthProShareModalIllustration=n,this.pageSize=l,this.disablePrefetchFallback=_,this.searchBarExperiments=f,this.expSubgrowthProOQNewFolder=S,this.expSubgrowthProShmCtaCopy=E,this.expSubgrowthProSharePageUpdates=y,this.expGrowthBBizWebGrouper=b,this.expGrowthBIndWebGrouper=v,r&&"groups"===O.get_hash())return L.set_tti_exclusion_flow("groups_tab_redirect"),void O.redirect("/team#groups");null==A&&(A=F.Viewer.get_viewer()),u.Dispatcher.dispatch({type:T.SharePageActionTypes.INITIALIZE,viewer:A});var I=null!=A?A.get_users():void 0;this.folderRowActionsByUserId={},this.fileRowActionsByUserId={},this.folderShareApiClientByUserId={},this.fileShareApiClientByUserId={};for(var R=0,D=I;R<D.length;R++){var w=D[R];this.folderShareApiClientByUserId[w.id]=new m.FolderShareApiClient({userId:w.id,client:new d.UserApiV2Client}),this.folderRowActionsByUserId[w.id]=new k({user:w,client:this.folderShareApiClientByUserId[w.id],expProShareUpsellModalFileAttr:this.expProShareUpsellModalFileAttr,expSubgrowthProShareModalIllustration:this.expSubgrowthProShareModalIllustration,expSubgrowthProShmCtaCopy:this.expSubgrowthProShmCtaCopy,expSubgrowthProSharePageUpdates:this.expSubgrowthProSharePageUpdates,numMembersOnTeam:s,teamAdminInfo:p,promptAdminToUpgradeEmailUrl:h}).actions,this.fileShareApiClientByUserId[w.id]=new m.FileShareApiClient({userId:w.id,client:new d.UserApiV2Client}),this.fileRowActionsByUserId[w.id]=new B({user:w,client:this.fileShareApiClientByUserId[w.id]}).actions}return u.Dispatcher.dispatch({type:T.SharePageActionTypes.SWITCH_USER,userId:a}),c.default.add_callback("/share",this.handleHistoryChange.bind(this),!1),this._fetchInitialData(I),o.default.render(x.getPageElement(),document.getElementById(t))},getPageElement:function(){var e=p.listenToStores(D.SharePage,{SharePageStore:A.SharePageStore},Q);return a.default.createElement(e,{fileTabActions:{onEmailWantToVerify:this.handleEmailWantToVerify.bind(this,n.GENERIC)},fileRowActionsByUserId:this.fileRowActionsByUserId,folderRowActionsByUserId:this.folderRowActionsByUserId,folderTabActions:{onEmailWantToVerify:this.handleEmailWantToVerify.bind(this,n.SHARE_FOLDER),onNewSharedFolderClick:C.asyncShowShareAFolderWizardModal},linkTabActions:{onEmailWantToVerify:this.handleEmailWantToVerify.bind(this,n.GENERIC)},isMaestroDesign:!0,onChangeTab:this.handleChangeTab.bind(this),searchBarExperiments:this.searchBarExperiments,expSubgrowthProOQNewFolder:this.expSubgrowthProOQNewFolder,expSubgrowthProSharePageUpdates:this.expSubgrowthProSharePageUpdates,expGrowthBBizWebGrouper:this.expGrowthBBizWebGrouper,expGrowthBIndWebGrouper:this.expGrowthBIndWebGrouper})},_fetchInitialData:function(e){for(var t=0,r=e;t<r.length;t++){var a=r[t];this._fetchTeamPolicy(a,3)}var o=O.get_uri().getPath();if(0===o.indexOf("/share")){var i=o.substr("/share".length+1);return this.handleHistoryChange(i,{})}return this.handleChangeTab(I.SharePageTab.FOLDER,!0,!1)},_fetchTeamPolicy:function(e,t,r){var a=this;return t<=0?(w.sharingNotificationError(M("There was an error retrieving your account information.")),void("function"==typeof r&&r())):(u.Dispatcher.dispatch({type:T.SharePageActionTypes.FETCH_TEAM_POLICY_REQUEST,user:e}),this.folderShareApiClientByUserId[e.id].getCurrentAccountCached().then(function(t){return u.Dispatcher.dispatch({type:T.SharePageActionTypes.FETCH_TEAM_POLICY_SUCCESS,teamPolicy:null!=t.team?t.team.sharing_policies:void 0,user:e}),"function"==typeof r?r():void 0}).catch(l.catchApiError(function(o){return u.Dispatcher.dispatch({type:T.SharePageActionTypes.FETCH_TEAM_POLICY_ERROR,user:e}),a._fetchTeamPolicy(e,t-1,r)})))},handleHistoryChange:function(e,t){var r=z[e];return null==r&&(c.default.replace_state("/share/"+V[I.SharePageTab.FOLDER]),r=I.SharePageTab.FOLDER),this.handleChangeTab(r,!0,!1)},handleChangeRole:function(e,t){if(void 0===t&&(t=!0),u.Dispatcher.dispatch({type:T.SharePageActionTypes.SWITCH_ROLE,role:e}),t)return this.ensureCurrentListingIsFetched()},handleChangeTab:function(e,t,r){if(void 0===t&&(t=!0),void 0===r&&(r=!0),u.Dispatcher.dispatch({type:T.SharePageActionTypes.SWITCH_TAB,viewingTab:e}),r&&c.default.push_state(W(e)),t)return this.ensureCurrentListingIsFetched()},ensureCurrentListingIsFetched:function(){var e=this;return this.fetchListingIfNeeded(A.SharePageStore.getCurrentUser(),A.SharePageStore.state.viewingTab,A.SharePageStore.getCurrentListing()).then(function(t){return t?e.ensureCurrentListingIsFetched():null})},fetchListingIfNeeded:function(e,t,r){var a=this;return t===I.SharePageTab.LINK?Promise.resolve():r.state!==I.ListingState.NEEDS_LOAD?Promise.resolve():e.is_email_verified?null!=r.nextResultCallback?r.nextResultCallback():new((function(){switch(t){case I.SharePageTab.FOLDER:return H;case I.SharePageTab.FILE:return q;default:throw new Error("unknown tab")}})())({client:(function(){switch(t){case I.SharePageTab.FOLDER:return a.folderShareApiClientByUserId[e.id];case I.SharePageTab.FILE:return a.fileShareApiClientByUserId[e.id];default:throw new Error("unknown tab")}})(),pageSize:this.pageSize,user:e,disablePrefetchFallback:this.disablePrefetchFallback}).fetch():(u.Dispatcher.dispatch({type:T.SharePageActionTypes.EMAIL_UNVERIFIED,user:e}),Promise.resolve())},handleEmailWantToVerify:function(e){var t=A.SharePageStore.getCurrentUser();return i.EmailVerification.get_for_user(t).verified_or_send_and_show(e,t.is_email_verified?void 0:O.reload)}};t.SharePageActions=x;var k=(function(){function e(e){e=e||{},this.logClickFolder=this.logClickFolder.bind(this),this.user=e.user,this.client=e.client||null,this.expProShareUpsellModalFileAttr=e.expProShareUpsellModalFileAttr||null,this.expSubgrowthProShareModalIllustration=e.expSubgrowthProShareModalIllustration||null,this.expSubgrowthProShmCtaCopy=e.expSubgrowthProShmCtaCopy||null,this.expSubgrowthProSharePageUpdates=e.expSubgrowthProSharePageUpdates||null,this.numMembersOnTeam=e.numMembersOnTeam||0,this.teamAdminInfo=e.teamAdminInfo||null,this.promptAdminToUpgradeEmailUrl=e.promptAdminToUpgradeEmailUrl||null,null==this.client&&(this.client=new m.FolderShareApiClient({userId:this.user.id,client:new d.UserApiV2Client})),this.actions={logClickFolder:this.logClickFolder,onFolderSettingsClick:this.handleFolderSettingsClick.bind(this),onMountClick:this.handleMountClick.bind(this),onRelinquishMembershipClick:this.handleRelinquishMembershipClick.bind(this),onShareClick:this.handleShareClick.bind(this),onUnmountClick:this.handleUnmountClick.bind(this),onUnshareClick:this.handleUnshareClick.bind(this),onViewFolderClick:this.handleViewFolderClick.bind(this)}}return e.prototype.handleFolderSettingsClick=function(e){var t=U.TRUELINK.TRUELINK_UI[this.user.id]?_.getCombinedPolicy(e.policy,e.link_metadata):e.policy;return f.asyncShowSharedFolderSettingsModal(e,this.user,t)},e.prototype.handleMountClick=function(e){var t=this;return u.Dispatcher.dispatch({type:T.SharePageActionTypes.MOUNT_FOLDER_REQUEST,metadata:e,user:this.user}),this.client.mount({contentId:e.shared_folder_id}).then(function(r){w.sharingNotificationSuccess(M("This folder has been successfully added to your Dropbox."));var a=r.set("permissions",e.permissions);return e.is_team_folder||(a=a.setIn(["permissions","unmount","allow"],!0)),u.Dispatcher.dispatch({type:T.SharePageActionTypes.MOUNT_FOLDER_SUCCESS,user:t.user,metadata:a})}).catch(l.catchApiError(function(r){if(u.Dispatcher.dispatch({type:T.SharePageActionTypes.MOUNT_FOLDER_ERROR,user:t.user,metadata:e}),"insufficient_quota"===(null!=r.error?r.error[".tag"]:void 0)&&null!=(null!=r.error?r.error.space_left:void 0)){var a=R.getOutOfQuotaVars(e,r);return a.numMembersOnTeam=t.numMembersOnTeam,a.teamAdminInfo=t.teamAdminInfo,a.promptAdminToUpgradeEmailUrl=t.promptAdminToUpgradeEmailUrl,a.activeUser=t.user,a.expProShareUpsellModalFileAttr=t.expProShareUpsellModalFileAttr,a.expSubgrowthProShareModalIllustration=t.expSubgrowthProShareModalIllustration,a.expSubgrowthProShmCtaCopy=t.expSubgrowthProShmCtaCopy,v.showOutOfQuotaModal(a)}return w.sharingNotificationError(M("We were unable to complete your request."))}))},e.prototype.handleRelinquishMembershipClick=function(e){var t=this,r=function(){return t.relinquishMembership(e),h.Modal.close()},a=null!=e.parent_shared_folder_id,o=null!=e.path_lower;return S.showRelinquishMembershipConfirmationModal(!0,a,r,N,o)},e.prototype.relinquishMembership=function(e){var t=this;return u.Dispatcher.dispatch({type:T.SharePageActionTypes.RELINQUISH_FOLDER_MEMBERSHIP_REQUEST,metadata:e,user:this.user}),this.client.relinquishMembership({contentId:e.shared_folder_id}).then(function(){return w.sharingNotificationSuccess(M("You have removed your own access to this folder.")),u.Dispatcher.dispatch({type:T.SharePageActionTypes.RELINQUISH_FOLDER_MEMBERSHIP_SUCCESS,metadata:e,user:t.user})}).catch(l.catchApiError(function(){return w.sharingNotificationError(M("We were unable to complete your request.")),u.Dispatcher.dispatch({type:T.SharePageActionTypes.RELINQUISH_FOLDER_MEMBERSHIP_ERROR,metadata:e,user:t.user})}))},e.prototype.handleShareClick=function(e){return g.asyncShowShareModal(this.user,{fqPath:e.path_lower,isFolder:!0,isTeamSharedFolder:e.is_team_folder,origin:"SHARE",targetNsId:e.shared_folder_id})},e.prototype.handleUnmountClick=function(e){var t=this;return u.Dispatcher.dispatch({type:T.SharePageActionTypes.UNMOUNT_FOLDER_REQUEST,metadata:e,user:this.user}),this.client.unmount({contentId:e.shared_folder_id}).then(function(){var r=e.set("path_lower",null).setIn(["permissions","unmount","allow"],!1);return u.Dispatcher.dispatch({type:T.SharePageActionTypes.UNMOUNT_FOLDER_SUCCESS,metadata:r,user:t.user}),w.sharingNotificationSuccess(M("This folder has been successfully removed from your Dropbox."))}).catch(l.catchApiError(function(r){return u.Dispatcher.dispatch({type:T.SharePageActionTypes.UNMOUNT_FOLDER_ERROR,metadata:e,user:t.user}),w.sharingNotificationError(M("We were unable to complete your request."))}))},e.prototype.handleUnshareClick=function(e){var t=this;return E.confirmResetAccess({allowLeaveACopy:null!=e.permissions.leave_a_copy?e.permissions.leave_a_copy.allow:void 0,contentName:e.name,isFolder:!0,isNestedSharedFolder:null!=e.parent_shared_folder_id,onCancel:N,onConfirm:function(r){return t.unshareFolder(e,r),h.Modal.close()}})},e.prototype.unshareFolder=function(e,t){var r=this;return void 0===t&&(t=!1),
u.Dispatcher.dispatch({type:T.SharePageActionTypes.UNSHARE_FOLDER_REQUEST,metadata:e,user:this.user}),this.client.unshare({contentId:e.shared_folder_id,leaveACopy:t}).then(function(){return u.Dispatcher.dispatch({type:T.SharePageActionTypes.UNSHARE_FOLDER_SUCCESS,metadata:e,user:r.user}),w.sharingNotificationSuccess(M("This folder has been successfully unshared."))}).catch(l.catchApiError(function(t){return u.Dispatcher.dispatch({type:T.SharePageActionTypes.UNSHARE_FOLDER_ERROR,metadata:e,user:r.user}),w.sharingNotificationError(M("We were unable to complete your request."))}))},e.prototype.handleViewFolderClick=function(e){return this.logClickFolder(e),O.open_tab(e.preview_url)},e.prototype.logClickFolder=function(e){return s.ShareTibEventLogger.log(this.user.id,"SHARE_PAGE_CLICK_FOLDER","SHARE",{ns_id:e.shared_folder_id})},e})();t.FolderRowActions=k;var B=(function(){function e(e){e=e||{},this.user=e.user,this.client=e.client||null,null==this.client&&(this.client=new m.FileShareApiClient({userId:this.user.id,client:new d.UserApiV2Client})),this.actions={onRelinquishMembershipClick:this.handleRelinquishMembershipClick.bind(this),onViewFileClick:this.handleViewFileClick.bind(this)}}return e.prototype.handleViewFileClick=function(e){return s.ShareTibEventLogger.log(this.user.id,"SHARE_PAGE_CLICK_FILE","SHARE",{file_id:e.id}),O.open_tab(e.preview_url)},e.prototype.handleRelinquishMembershipClick=function(e){var t=this,r=function(){return t.relinquishMembership(e),h.Modal.close()};return S.showRelinquishMembershipConfirmationModal(!1,!1,r,N,!1)},e.prototype.relinquishMembership=function(e){var t=this;return u.Dispatcher.dispatch({type:T.SharePageActionTypes.RELINQUISH_FILE_MEMBERSHIP_REQUEST,metadata:e,user:this.user}),this.client.relinquishMembership({contentId:e.id}).then(function(){return u.Dispatcher.dispatch({type:T.SharePageActionTypes.RELINQUISH_FILE_MEMBERSHIP_SUCCESS,metadata:e,user:t.user}),w.sharingNotificationSuccess(M("You have removed your own access to this file."))}).catch(l.catchApiError(function(){return u.Dispatcher.dispatch({type:T.SharePageActionTypes.RELINQUISH_FILE_MEMBERSHIP_ERROR,metadata:e,user:t.user}),w.sharingNotificationError(M("We were unable to complete your request."))}))},e})();t.FileRowActions=B;var q=(function(){function e(e){e=e||{},this.user=e.user,this.client=e.client||null,this.pageSize=null!=e.pageSize?e.pageSize:100,null==this.client&&(this.client=new m.FileShareApiClient({userId:this.user.id,client:new d.UserApiV2Client}))}return e.prototype.fetch=function(e){return void 0===e&&(e=null),u.Dispatcher.dispatch({type:T.SharePageActionTypes.LOAD_FILE_DATA_REQUEST,user:this.user}),(null!=e?this.client.listReceivedFilesContinue({cursor:e}):this.client.listReceivedFiles({actions:Object.keys(y.FILE_METADATA_PERMISSIONS),limit:this.pageSize})).then(this.handleSuccess.bind(this)).catch(this.handleError.bind(this))},e.prototype.handleSuccess=function(e){var t=e.cursor?this.fetch.bind(this,e.cursor):null;return u.Dispatcher.dispatch({type:T.SharePageActionTypes.LOAD_FILE_DATA_SUCCESS,cursor:e.cursor,entries:e.entries,nextResultCallback:t,user:this.user}),Promise.resolve(null!=t)},e.prototype.handleError=function(e){return w.sharingNotificationError(M("We were unable to retrieve all of your shared files")),u.Dispatcher.dispatch({type:T.SharePageActionTypes.LOAD_FILE_DATA_ERROR,user:this.user,error:e}),Promise.reject(e)},e})();t.FileListingFetcher=q;var H=(function(){function e(e){e=e||{},this.user=e.user,this.client=e.client||null,this.pageSize=null!=e.pageSize?e.pageSize:100,this.disablePrefetchFallback=e.disablePrefetchFallback||!1,null==this.client&&(this.client=new m.FolderShareApiClient({userId:this.user.id,client:new d.UserApiV2Client}))}return e.prototype.fetch=function(e){return void 0===e&&(e=null),u.Dispatcher.dispatch({type:T.SharePageActionTypes.LOAD_FOLDER_DATA_REQUEST,user:this.user}),null==e&&window.__REGISTER_SHARE_FOLDERS_PRELOAD_HANDLER?this.fetchFoldersFromPreloadHandler():this.fetchFoldersFromAPI(e)},e.prototype.fetchFoldersFromPreloadHandler=function(){var e=this;return new Promise(function(e,t){var r=function(r){try{var a=JSON.parse(r);return e(_.listFoldersResultApiToRecord(a))}catch(e){return t(e)}},a=function(e){return t(e)};return window.__REGISTER_SHARE_FOLDERS_PRELOAD_HANDLER(r,a)}).then(this.handleSuccess.bind(this)).catch(function(t){if(e.disablePrefetchFallback)throw t;return e.fetchFoldersFromAPI()})},e.prototype.fetchFoldersFromAPI=function(e){return void 0===e&&(e=null),(null!=e?this.client.listMountableFoldersContinueAlpha({cursor:e}):this.client.listMountableFoldersAlpha({actions:Object.keys(y.ALPHA_FOLDER_METADATA_PERMISSIONS),limit:this.pageSize,show_mounted:!1})).then(this.handleSuccess.bind(this)).catch(this.handleError.bind(this))},e.prototype.handleSuccess=function(e){var t=e.cursor?this.fetch.bind(this,e.cursor):null;return u.Dispatcher.dispatch({type:T.SharePageActionTypes.LOAD_FOLDER_DATA_SUCCESS,cursor:e.cursor,entries:e.entries,nextResultCallback:t,user:this.user}),Promise.resolve(null!=t)},e.prototype.handleError=function(e){return w.sharingNotificationError(M("We were unable to retrieve all of your shared folders")),u.Dispatcher.dispatch({type:T.SharePageActionTypes.LOAD_FOLDER_DATA_ERROR,user:this.user,error:e}),Promise.reject(e)},e})();t.FolderListingFetcher=H;var Q=function(e,t){var r=t.SharePageStore.getCurrentUser();return{fileRowActions:e.fileRowActionsByUserId[r.id],fileTabActions:e.fileTabActions,folderRowActions:e.folderRowActionsByUserId[r.id],folderTabActions:e.folderTabActions,linkTabActions:e.linkTabActions,isMaestroDesign:!0,isTeamPolicyLoaded:t.SharePageStore.isTeamPolicyLoaded(r.id),listing:t.SharePageStore.getCurrentListing(),onChangeTab:e.onChangeTab,teamPolicy:t.SharePageStore.getCurrentTeamPolicy(r.id),user:r,viewingTab:t.SharePageStore.state.viewingTab,searchBarExperiments:e.searchBarExperiments,expSubgrowthProOQNewFolder:e.expSubgrowthProOQNewFolder,expSubgrowthProSharePageUpdates:e.expSubgrowthProSharePageUpdates,expGrowthBBizWebGrouper:e.expGrowthBBizWebGrouper,expGrowthBIndWebGrouper:e.expGrowthBIndWebGrouper}};t.sharePagePropsFromStores=Q;var G,W=function(e){switch(e){case I.SharePageTab.FOLDER:return"/share/folders";case I.SharePageTab.FILE:return"/share/files";case I.SharePageTab.LINK:return"/share/links";default:throw new Error("Unknown tabType "+e)}},V=(G={},G[I.SharePageTab.FOLDER]="folders",G[I.SharePageTab.FILE]="files",G[I.SharePageTab.LINK]="links",G),z={folders:I.SharePageTab.FOLDER,files:I.SharePageTab.FILE,links:I.SharePageTab.LINK}}),define("modules/clean/sharing/share_page/store",["require","exports","tslib","external/immutable","modules/clean/flux/dispatcher","modules/clean/flux/base_store","modules/clean/sharing/share_page/action_types","modules/clean/sharing/share_page/types","modules/clean/viewer"],function(e,t,r,a,o,i,n,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=r.__importStar(a);var d=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.getCurrentListing=function(){return this.getListing(this.state.viewingTab,this.state.viewingUserId)},t.prototype.getCurrentUser=function(){return this.state.viewer.get_user_by_id(this.state.viewingUserId)},t.prototype.getCurrentTeamPolicy=function(e){return this.state.teamPolicy[e]},t.prototype.isTeamPolicyLoaded=function(e){return e in this.state.teamPolicy},t.prototype.getListing=function(e,t){var r=this.state.listingByUserByType.getIn([e,t]);return null!=r?r:new s.SharedContentListing},t.prototype._init=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e[0],o=null!=r?r:{},i=o.viewer,n=null!=i?i:null,d=o.viewingRole,u=null!=d?d:null,p=o.viewingTab,c=null!=p?p:s.SharePageTab.FOLDER;null==n&&(n=l.Viewer.get_viewer());var h=null!=n?n.get_users():void 0,m=null;if(null!=n&&h.length>0){if(null!=u){var _=n.get_user_by_role(u);null!=_&&(m=_.id)}null==m&&(m=n.get_users()[0].id)}return this.state={listingByUserByType:a.Map([[s.SharePageTab.FOLDER,a.Map()],[s.SharePageTab.FILE,a.Map()]]),teamPolicy:{},viewer:n,viewingTab:c,viewingUserId:m}},t.prototype._new_payload=function(e){switch(e.action.type){case n.SharePageActionTypes.INITIALIZE:return this._init(e.action),this.emit_change();case n.SharePageActionTypes.EMAIL_UNVERIFIED:return this._setEmailUnverified(e.action.user.id),this.emit_change();case n.SharePageActionTypes.SWITCH_TAB:return this.state.viewingTab=e.action.viewingTab,this.emit_change();case n.SharePageActionTypes.SWITCH_ROLE:var t=this.state.viewer.get_user_by_role(e.action.role);return this.state.viewingUserId=t.id,this.emit_change();case n.SharePageActionTypes.SWITCH_USER:return this.state.viewingUserId=e.action.userId,this.emit_change();case n.SharePageActionTypes.LOAD_FOLDER_DATA_REQUEST:return this._loadDataRequest(s.SharePageTab.FOLDER,e.action);case n.SharePageActionTypes.LOAD_FOLDER_DATA_SUCCESS:return this._loadDataSuccess(s.SharePageTab.FOLDER,e.action);case n.SharePageActionTypes.LOAD_FOLDER_DATA_ERROR:return this._loadDataError(s.SharePageTab.FOLDER,e.action);case n.SharePageActionTypes.LOAD_FILE_DATA_REQUEST:return this._loadDataRequest(s.SharePageTab.FILE,e.action);case n.SharePageActionTypes.LOAD_FILE_DATA_SUCCESS:return this._loadDataSuccess(s.SharePageTab.FILE,e.action);case n.SharePageActionTypes.LOAD_FILE_DATA_ERROR:return this._loadDataError(s.SharePageTab.FILE,e.action);case n.SharePageActionTypes.MOUNT_FOLDER_REQUEST:return this._mountFolderRequest(e.action);case n.SharePageActionTypes.MOUNT_FOLDER_SUCCESS:return this._mountFolderSuccess(e.action);case n.SharePageActionTypes.MOUNT_FOLDER_ERROR:return this._mountFolderError(e.action);case n.SharePageActionTypes.UNMOUNT_FOLDER_REQUEST:return this._unmountFolderRequest(e.action);case n.SharePageActionTypes.UNMOUNT_FOLDER_SUCCESS:return this._unmountFolderSuccess(e.action);case n.SharePageActionTypes.UNMOUNT_FOLDER_ERROR:return this._unmountFolderError(e.action);case n.SharePageActionTypes.UNSHARE_FOLDER_REQUEST:return this._unshareFolderRequest(e.action);case n.SharePageActionTypes.UNSHARE_FOLDER_SUCCESS:return this._unshareFolderSuccess(e.action);case n.SharePageActionTypes.UNSHARE_FOLDER_ERROR:return this._unshareFolderError(e.action);case n.SharePageActionTypes.FETCH_TEAM_POLICY_REQUEST:return delete this.state.teamPolicy[e.action.user.id],this.emit_change();case n.SharePageActionTypes.FETCH_TEAM_POLICY_SUCCESS:return this._fetchTeamPolicySuccess(e.action);case n.SharePageActionTypes.FETCH_TEAM_POLICY_ERROR:return null;case n.SharePageActionTypes.FETCH_FOLDER_POLICY_SUCCESS:return this._fetchFolderPolicySuccess(e.action);case n.SharePageActionTypes.FETCH_METADATA_SUCCESS:return this._fetchMetadataSuccess(e.action);case n.SharePageActionTypes.RELINQUISH_FOLDER_MEMBERSHIP_REQUEST:return this._relinquishMembershipRequest(s.SharePageTab.FOLDER,e.action);case n.SharePageActionTypes.RELINQUISH_FOLDER_MEMBERSHIP_SUCCESS:return this._relinquishMembershipSuccess(s.SharePageTab.FOLDER,e.action);case n.SharePageActionTypes.RELINQUISH_FOLDER_MEMBERSHIP_ERROR:return this._relinquishMembershipError(s.SharePageTab.FOLDER,e.action);case n.SharePageActionTypes.RELINQUISH_FILE_MEMBERSHIP_REQUEST:return this._relinquishMembershipRequest(s.SharePageTab.FILE,e.action);case n.SharePageActionTypes.RELINQUISH_FILE_MEMBERSHIP_SUCCESS:return this._relinquishMembershipSuccess(s.SharePageTab.FILE,e.action);case n.SharePageActionTypes.RELINQUISH_FILE_MEMBERSHIP_ERROR:return this._relinquishMembershipError(s.SharePageTab.FILE,e.action)}},t.prototype._setListing=function(e,t,r){return this.state.listingByUserByType=this.state.listingByUserByType.setIn([e,t],r)},t.prototype._loadDataRequest=function(e,t){var r=this.getListing(e,t.user.id).set("state",s.ListingState.FETCHING);return this._setListing(e,t.user.id,r),this.emit_change()},t.prototype._loadDataSuccess=function(e,t){var r=this.getListing(e,t.user.id),a=new s.SharedContentListing({cursor:t.cursor,listingEntries:r.listingEntries.merge(t.entries),nextResultCallback:t.nextResultCallback,state:null!=t.cursor?s.ListingState.NEEDS_LOAD:s.ListingState.FINISHED});return this._setListing(e,t.user.id,a),this.emit_change()},t.prototype._loadDataError=function(e,t){var r=this.getListing(e,t.user.id).set("state",s.ListingState.ERROR);return this._setListing(e,t.user.id,r),this.emit_change()},t.prototype._setEmailUnverified=function(e){var t=this.state.viewingTab,r=this.getListing(t,e).set("state",s.ListingState.EMAIL_UNVERIFIED);return this._setListing(t,e,r)},t.prototype._mountFolderRequest=function(e){var t=this.getListing(s.SharePageTab.FOLDER,e.user.id).setIn(["entryPendingStates",e.metadata.shared_folder_id],s.EntryPendingState.MOUNTING);return this._setListing(s.SharePageTab.FOLDER,e.user.id,t),this.emit_change()},t.prototype._mountFolderSuccess=function(e){var t=this.getListing(s.SharePageTab.FOLDER,e.user.id).setIn(["listingEntries",e.metadata.shared_folder_id],e.metadata).removeIn(["entryPendingStates",e.metadata.shared_folder_id]);return this._setListing(s.SharePageTab.FOLDER,e.user.id,t),this.emit_change()},t.prototype._mountFolderError=function(e){var t=this.getListing(s.SharePageTab.FOLDER,e.user.id).removeIn(["entryPendingStates",e.metadata.shared_folder_id]);return this._setListing(s.SharePageTab.FOLDER,e.user.id,t),this.emit_change()},t.prototype._unmountFolderRequest=function(e){var t=this.getListing(s.SharePageTab.FOLDER,e.user.id).setIn(["entryPendingStates",e.metadata.shared_folder_id],s.EntryPendingState.UNMOUNTING);return this._setListing(s.SharePageTab.FOLDER,e.user.id,t),this.emit_change()},t.prototype._unmountFolderSuccess=function(e){var t=this.getListing(s.SharePageTab.FOLDER,e.user.id).setIn(["listingEntries",e.metadata.shared_folder_id],e.metadata).removeIn(["entryPendingStates",e.metadata.shared_folder_id]);return this._setListing(s.SharePageTab.FOLDER,e.user.id,t),this.emit_change()},t.prototype._unmountFolderError=function(e){var t=this.getListing(s.SharePageTab.FOLDER,e.user.id).removeIn(["entryPendingStates",e.metadata.shared_folder_id]);return this._setListing(s.SharePageTab.FOLDER,e.user.id,t),this.emit_change()},t.prototype._unshareFolderRequest=function(e){var t=this.getListing(s.SharePageTab.FOLDER,e.user.id).setIn(["entryPendingStates",e.metadata.shared_folder_id],s.EntryPendingState.UNSHARING);return this._setListing(s.SharePageTab.FOLDER,e.user.id,t),this.emit_change()},t.prototype._unshareFolderSuccess=function(e){var t=this.getListing(s.SharePageTab.FOLDER,e.user.id).removeIn(["listingEntries",e.metadata.shared_folder_id]).removeIn(["entryPendingStates",e.metadata.shared_folder_id]);return this._setListing(s.SharePageTab.FOLDER,e.user.id,t),this.emit_change()},t.prototype._unshareFolderError=function(e){var t=this.getListing(s.SharePageTab.FOLDER,e.user.id).removeIn(["entryPendingStates",e.metadata.shared_folder_id]);return this._setListing(s.SharePageTab.FOLDER,e.user.id,t),this.emit_change()},t.prototype._fetchTeamPolicySuccess=function(e){return this.state.teamPolicy[e.user.id]=e.teamPolicy,this.emit_change()},t.prototype._fetchMetadataSuccess=function(e){var t=e.metadata.isSharedFolder()?s.SharePageTab.FOLDER:s.SharePageTab.FILE,r=this._getContentId(t,e),a=this.getListing(t,e.user.id),o=a.set("listingEntries",a.listingEntries.set(r,e.metadata));return this._setListing(t,e.user.id,o),this.emit_change()},t.prototype._fetchFolderPolicySuccess=function(e){var t=this.getListing(s.SharePageTab.FOLDER,e.user.id),r=t.listingEntries.get(e.metadata.shared_folder_id);r=r.set("policy",e.folderPolicy);var a=t.set("listingEntries",t.listingEntries.set(e.metadata.shared_folder_id,r));return this._setListing(s.SharePageTab.FOLDER,e.user.id,a),this.emit_change()},t.prototype._relinquishMembershipRequest=function(e,t){var r=this._getContentId(e,t),a=this.getListing(e,t.user.id).setIn(["entryPendingStates",r],s.EntryPendingState.RELINQUISHING_MEMBERSHIP);return this._setListing(e,t.user.id,a),this.emit_change()},t.prototype._relinquishMembershipSuccess=function(e,t){var r=this._getContentId(e,t),a=this.getListing(e,t.user.id).removeIn(["listingEntries",r]).removeIn(["entryPendingStates",r]);return this._setListing(e,t.user.id,a),this.emit_change()},t.prototype._relinquishMembershipError=function(e,t){var r=this._getContentId(e,t),a=this.getListing(e,t.user.id).removeIn(["entryPendingStates",r]);return this._setListing(e,t.user.id,a),this.emit_change()},t.prototype._getContentId=function(e,t){switch(e){case s.SharePageTab.FOLDER:return t.metadata.shared_folder_id;case s.SharePageTab.FILE:return t.metadata.id}},t})(i.Store);t.SharePageStore=new d(o.Dispatcher)}),define("modules/clean/sharing/share_page/types",["require","exports","tslib","external/immutable","modules/clean/sharing/share_page/constants","modules/clean/sharing/share_page/constants"],function(e,t,r,a,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=r.__importStar(a);(function(e){e.MOUNTING="unmounting",e.UNMOUNTING="unmounting",e.UNSHARING="unsharing",e.RELINQUISHING_MEMBERSHIP="relinquishing-membership"})(t.EntryPendingState||(t.EntryPendingState={}));var n=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t})(a.Record({cursor:null,listingEntries:a.Map(),entryPendingStates:a.Map(),nextResultCallback:null,state:o.ListingState.NEEDS_LOAD},"SharedContentListing"));t.SharedContentListing=n;(function(e){e.NAME="name",e.TIME_INVITED="time_invited"})(t.SortField||(t.SortField={})),t.SharePageTab=i.SharePageTab,t.ListingState=i.ListingState}),define("modules/clean/sharing/share_page/util",["require","exports","modules/clean/sharing/access_level","modules/clean/sharing/share_page/types","modules/clean/sharing/share_page/views/share_column_header"],function(e,t,r,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){return null!=e.path_lower};t.isMetadataMounted=i;var n=function(e){return e.groupBy(i)};t.groupEntriesByMounted=n;var s=function(e){return"time_invited"===e?"created_ts":"filename"};t.convertShareColumnHeaderKeyToLinkField=s;var l=function(e,t,r,i){void 0===i&&(i=null);var n=(function(){if(t===a.SortField.TIME_INVITED)return function(e){return e.time_invited};if(t===a.SortField.NAME||t===a.SortField.INVITER)return function(e){return e.name.toLowerCase()};throw Error("Unexpected sort field")})(),s=r===o.SortDirection.DESCENDING?function(e,t){return t<e?-1:e===t?0:1}:function(e,t){return e<t?-1:e===t?0:1},l=e.sortBy(n,s);return null!=i?l.take(i).valueSeq():l.valueSeq()};t.sortedEntries=l;var d=function(e,t){var a="wb"+(0===t.error.space_left?"_oq":"_nq")+"_shm_share"+(e.access_type===r.ACCESS_LEVEL.READER?"_ro":"_w");return{folderName:e.name,folderSize:t.error.space_needed,queryParams:a,usageRemaining:t.error.space_left,usageNeeded:t.error.space_needed,nsId:e.shared_folder_id}};t.getOutOfQuotaVars=d}),define("modules/clean/sharing/share_page/views/file_listing",["require","exports","tslib","external/classnames","react","external/react-dom-factories","modules/clean/react/columnheader","modules/clean/sharing/share_page/types","modules/clean/sharing/share_page/util","modules/clean/sharing/share_page/views/file_row","modules/clean/sharing/share_page/views/share_column_header","modules/core/i18n"],function(e,t,r,a,o,i,n,s,l,d,u,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=r.__importDefault(a),o=r.__importDefault(o),i=r.__importStar(i),p=r.__importStar(p);var c=o.default.createElement,h=p.i18n_default_project("sharing")._,m=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={sortDirection:t.props.initialSortDirection,sortField:t.props.initialSortField},t.handlePopoverSelection=function(e){return t._handleSortChange(e.newSortField,e.newSortDirection)},t._renderNewColumnHeader=function(e){return e.label?c(u.ShareColumnHeader,{headerClassName:e.headerClassName,onSelection:t.handlePopoverSelection,sortField:e.sortField,activeSortField:t.state.sortField,label:e.label,activeSortDirection:t.state.sortDirection}):i.span({})},t.renderHeader=function(){var e;e=[];for(var r=0,a=Array.from(t._getColumns());r<a.length;r++){var o=a[r];e.push(t._renderNewColumnHeader(o))}return i.ul({role:"row",className:"c-column-header mcl-style-header u-trim-margin u-trim-padding"},e)},t._getColumns=function(){return[{canToggleSortDirection:!0,headerClassName:a.default("filename-col","filename-col--pagelet"),label:t.props.label,sortField:s.SortField.NAME,type:n.ColumnTypes.SINGLE},{canToggleSortDirection:!0,headerClassName:a.default("time-invited-col","time-invited-col--pagelet"),label:h("Shared on",{comment:"As in, this item was shared on {date}"}),sortField:s.SortField.TIME_INVITED,type:n.ColumnTypes.SINGLE},{headerClassName:a.default("actions-col","actions-col--pagelet"),label:null,type:n.ColumnTypes.STATIC}]},t._getSortedEntries=function(){return l.sortedEntries(t.props.entries,t.state.sortField,t.state.sortDirection)},t._handleSortChange=function(e,r){return t.setState({sortDirection:r,sortField:e})},t._handlePreRedesignSortChange=function(e,r){return t._handleSortChange(e,t._convertBrowseSortDirectionToShareSortDirection(r))},t._convertShareSortDirectionToBrowseSortDirection=function(e){return e===u.SortDirection.DESCENDING?n.SortDirections.DESCENDING:n.SortDirections.ASCENDING},t._convertBrowseSortDirectionToShareSortDirection=function(e){return e===n.SortDirections.DESCENDING?u.SortDirection.DESCENDING:u.SortDirection.ASCENDING},t}return r.__extends(t,e),t.prototype.render=function(){var e=this;return i.div({"aria-readonly":"true",role:"grid",className:"mu-mar-bottom-5x"},this.renderHeader(),i.ol({className:"o-list-ui o-list-ui--dividers u-trim-margin",role:"presentation"},this._getSortedEntries().map(function(t){return c(d.FileRow,r.__assign({key:t.id,metadata:t,pendingState:e.props.entryPendingStates.get(t.id)},e.props.fileRowActions||{}))}).toArray()))},t.displayName="FileListing",t.defaultProps={initialSortDirection:u.SortDirection.DESCENDING,initialSortField:s.SortField.TIME_INVITED},t})(o.default.Component);t.FileListing=m}),define("modules/clean/sharing/share_page/views/file_row",["require","exports","tslib","external/classnames","react","external/react-dom-factories","modules/clean/datetime","modules/clean/react/bubble_menu","modules/clean/react/css","modules/clean/sharing/share_page/views/row_actions","modules/clean/sharing/share_page/views/shared_file_icon","modules/core/i18n"],function(e,t,r,a,o,i,n,s,l,d,u,p){"use strict";function c(e,t){return void 0!==e&&null!==e?t(e):void 0}Object.defineProperty(t,"__esModule",{value:!0}),a=r.__importDefault(a),o=r.__importDefault(o),i=r.__importStar(i),n=r.__importStar(n),p=r.__importStar(p);var h=o.default.createElement,m=p.i18n_default_project("sharing")._,_=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isHovered:!1},t._handleMouseEnter=function(){return t.setState({isHovered:!0})},t._handleMouseLeave=function(){return t.setState({isHovered:!1})},t._renderIconAndName=function(){return[h(u.SharedFileIcon,{sharedFileMetadata:t.props.metadata,className:"share-page-file-row__file-icon u-l-ib u-l-ib--m u-mar-right-xs mu-mar-right-2x"}),i.span({className:"share-page-file-row__file-name u-l-ib u-l-ib--m",key:"file-row-name"},t.props.metadata.name)]},t._renderFileActions=function(){var e=c(null!=t.props.metadata.permissions?t.props.metadata.permissions.relinquish_membership:void 0,function(e){return e.allow})?h(s.BubbleMenuItem,{key:"relinquish-membership",onClick:null!=t.props.onRelinquishMembershipClick?t.props.onRelinquishMembershipClick.bind(t,t.props.metadata):void 0},i.span({className:"u-font-black"},m("Remove"))):null,r=[];return null!==e&&r.push(e),h(d.RowActions,{disabled:null!=t.props.pendingState,importance:"secondary",overflowActions:r,rowIsHovered:t.state.isHovered})},t}return r.__extends(t,e),t.prototype.render=function(){var e=new Date(this.props.metadata.time_invited);return i.li({className:a.default(["share-page-file-row",["mu-lh-8x","mu-height-8x","mu-pad-horizontal-2x"]]),key:"shared-file-"+this.props.metadata.id,role:"row",title:this.props.metadata.name,onMouseEnter:this._handleMouseEnter,onMouseLeave:this._handleMouseLeave},i.div({className:a.default("filename-col u-l-ib u-l-ib--m","filename-col--pagelet"),role:"rowheader"},i.button({className:"u-l-b button-as-link share-page-file-row__file-name-col",onClick:null!=this.props.onViewFileClick?this.props.onViewFileClick.bind(this,this.props.metadata):void 0},this._renderIconAndName())),i.div({className:a.default("share-page-file-row__time-invited","time-invited-col","time-invited-col--pagelet","u-l-ib","u-l-ib--m","u-font-meta"),role:"gridcell",title:null!=this.props.metadata.time_invited?n.ago(e):void 0},null!=this.props.metadata.time_invited?n.format_date(e,n.localized_datetime_format):""),i.div({className:a.default("actions-col u-l-ib u-l-ib--m u-font-right","actions-col--pagelet"),role:"gridcell"},this._renderFileActions()))},t.displayName="FileRow",t})(o.default.Component);t.FileRow=l.requireCssWithComponent(_,["/static/css/sharing/share_page-vfl48Vdji.css","/static/css/scooter/scooter-scoped-vflWuydQl.css"])}),define("modules/clean/sharing/share_page/views/files_tab",["require","exports","tslib","react","modules/clean/sharing/share_page/types","modules/clean/sharing/share_page/views/file_listing","modules/clean/sharing/share_page/views/tab_states","modules/core/i18n"],function(e,t,r,a,o,i,n,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=r.__importDefault(a),s=r.__importStar(s);var l=a.default.createElement,d=s.i18n_default_project("sharing")._,u=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.render=function(){return l(n.PageTab,{className:"share-page-files-tab",header:null,listingState:this.props.listing.state,onEmailWantToVerify:this.props.onEmailWantToVerify,user:this.props.user,tabType:o.SharePageTab.FILE},this.props.listing.listingEntries.count()>0?l(i.FileListing,{entries:this.props.listing.listingEntries,entryPendingStates:this.props.listing.entryPendingStates,fileRowActions:this.props.fileRowActions,label:d("Name",{comment:"As in, a filename"})}):null)},t.displayName="FilesTab",t})(a.default.Component);t.FilesTab=u}),define("modules/clean/sharing/share_page/views/folder_icon_from_metadata",["require","exports","tslib","react","spectrum/icon_content","modules/clean/sharing/ui_util"],function(e,t,r,a,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=r.__importDefault(a),i=r.__importStar(i),t.FolderIconFromMetadata=function(e){var t=e.className,r=e.metadata,n=(e.group,e.showUnmountedAsDisabled),s=i.spectrumFolderIconForMetadata(r),l=null==r.path_lower&&n;return a.default.createElement(o.IconContent,{className:t,disabled:l,name:s,"aria-label":r.name,role:"img"})}}),define("modules/clean/sharing/share_page/views/folder_listing",["require","exports","tslib","external/classnames","react","external/react-dom-factories","modules/clean/react/columnheader","modules/clean/react/sprite","modules/clean/sharing/share_page/types","modules/clean/sharing/share_page/util","modules/clean/sharing/share_page/views/folder_row","modules/clean/sharing/share_page/views/share_column_header","modules/core/i18n"],function(e,t,r,a,o,i,n,s,l,d,u,p,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=r.__importDefault(a),o=r.__importDefault(o),i=r.__importStar(i),c=r.__importStar(c);var h=o.default.createElement,m=c.i18n_default_project("sharing"),_=m._,f=m.ungettext,g=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={collapsed:null!=t.props.maxInitialDisplay,sortDirection:t.props.initialSortDirection,sortField:t.props.initialSortField},t.handlePopoverSelection=function(e){return t._handleSortChange(e.newSortField,e.newSortDirection)},t._renderNewColumnHeader=function(e){return e.label?h(p.ShareColumnHeader,{headerClassName:e.headerClassName,onSelection:t.handlePopoverSelection,sortField:e.sortField,activeSortField:t.state.sortField,label:e.label,activeSortDirection:t.state.sortDirection,showSort:e.showSort}):i.span({})},t.renderHeader=function(){return i.ul({role:"row",className:"c-column-header mcl-style-header u-trim-margin u-trim-padding"},t._getColumns().map(function(e){return t._renderNewColumnHeader(e)}))},t._numberToHide=function(){if(!t.state.collapsed||null==t.props.maxInitialDisplay)return 0;var e=t.props.entries.count();return e<=t.props.maxInitialDisplay?0:e-t.props.maxInitialDisplay},t._getColumns=function(){var e=t.props.expSubgrowthProSharePageUpdates&&t.props.expSubgrowthProSharePageUpdates.variant&&"V1"===t.props.expSubgrowthProSharePageUpdates.variant,r={canToggleSortDirection:!0,headerClassName:a.default("filename-col",e?"filename-col--subgrowth_pro_share_page_updates":void 0,t.props.isMaestroDesign?"filename-col--pagelet":void 0),label:t.props.label,sortField:l.SortField.NAME,type:n.ColumnTypes.SINGLE},o=_("Shared on",{comment:"As in, this item was shared on {date}"}),i={canToggleSortDirection:!0,headerClassName:a.default("time-invited-col",e?"time-invited-col--subgrowth_pro_share_page_updates":void 0,t.props.isMaestroDesign?"time-invited-col--pagelet":void 0),label:o,sortField:l.SortField.TIME_INVITED,type:n.ColumnTypes.SINGLE},s=null;if(e){var d=_("Size",{comment:"Size of folder"});s={canToggleSortDirection:!1,headerClassName:a.default("size-col",t.props.isMaestroDesign?"size-col--pagelet":void 0),label:d,sortField:null,type:n.ColumnTypes.SINGLE,showSort:!1}}return[r,s,i,{headerClassName:a.default("actions-col",e?"actions-col--subgrowth_pro_share_page_updates":void 0,t.props.isMaestroDesign?"actions-col--pagelet":void 0),label:null,type:n.ColumnTypes.STATIC}].filter(function(e){return e})},t._getSortedEntries=function(){return d.sortedEntries(t.props.entries,t.state.sortField,t.state.sortDirection,t.state.collapsed?t.props.maxInitialDisplay:null)},t._handleShowAllFoldersClick=function(){return t.setState({collapsed:!1})},t._handleSortChange=function(e,r){return t.setState({sortDirection:r,sortField:e})},t._handlePreRedesignSortChange=function(e,r){return t._handleSortChange(e,t._convertBrowseSortDirectionToShareSortDirection(r))},t._convertShareSortDirectionToBrowseSortDirection=function(e){return e===p.SortDirection.DESCENDING?n.SortDirections.DESCENDING:n.SortDirections.ASCENDING},t._convertBrowseSortDirectionToShareSortDirection=function(e){return e===n.SortDirections.DESCENDING?p.SortDirection.DESCENDING:p.SortDirection.ASCENDING},t}return r.__extends(t,e),t.prototype.render=function(){var e=this,t=this._numberToHide();return i.div({"aria-readonly":"true",role:"grid",className:this.props.isMaestroDesign?"mu-mar-bottom-5x":"u-mar-bottom-m"},this.renderHeader(),i.ol({className:"o-list-ui o-list-ui--dividers u-trim-margin",role:"presentation"},this._getSortedEntries().map(function(t){return h(u.FolderRow,r.__assign({isMaestroDesign:e.props.isMaestroDesign,key:t.shared_folder_id,metadata:t,pendingState:e.props.entryPendingStates.get(""+t.shared_folder_id),user:e.props.user,isTeamPolicyLoaded:e.props.isTeamPolicyLoaded,expSubgrowthProSharePageUpdates:e.props.expSubgrowthProSharePageUpdates,expGrowthBBizWebGrouper:e.props.expGrowthBBizWebGrouper,expGrowthBIndWebGrouper:e.props.expGrowthBIndWebGrouper},e.props.folderRowActions))}).toArray(),t?i.li({role:"row",className:"u-pad-vertical-s"},i.button({className:"share-page-folder-listing__show-more button-as-link",onClick:this._handleShowAllFoldersClick},i.div({className:"u-l-ib u-mar-right-xs mu-trim-margin"},i.div({className:"share-page-folder-listing__show-more-caret mu-width-8x mu-trim-padding mu-mar-horizontal-auto u-pad-horizontal-xxs u-mar-horizontal-xxs u-l-ib",onClick:this._handleShowAllFoldersClick},h(s.Sprite,{alt:"",group:"web",name:"caret_gray"}))),i.span({},f("Show one more folder","Show %(num_extra)s more folders",t).format({num_extra:t})))):void 0))},
t.displayName="FolderListing",t.defaultProps={initialSortDirection:p.SortDirection.DESCENDING,initialSortField:l.SortField.TIME_INVITED,maxInitialDisplay:void 0},t})(o.default.Component);t.FolderListing=g}),define("modules/clean/sharing/share_page/views/folder_row",["require","exports","tslib","external/classnames","react","external/react-dom-factories","modules/clean/browse_interface","modules/clean/datetime","modules/clean/react/bubble_menu","modules/clean/react/css","modules/clean/sharing/share_page/views/folder_icon_from_metadata","modules/clean/sharing/share_page/views/row_actions","modules/core/i18n","modules/clean/display_format","modules/core/browser"],function(e,t,r,a,o,i,n,s,l,d,u,p,c,h,m){"use strict";function _(e,t){return void 0!==e&&null!==e?t(e):void 0}Object.defineProperty(t,"__esModule",{value:!0}),a=r.__importDefault(a),o=r.__importDefault(o),i=r.__importStar(i),s=r.__importStar(s),c=r.__importStar(c),h=r.__importStar(h),m=r.__importStar(m);var f=o.default.createElement,g=c.i18n_default_project("sharing")._,S=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isHovered:!1},t._handleMouseEnter=function(){return t.setState({isHovered:!0})},t._handleMouseLeave=function(){return t.setState({isHovered:!1})},t._renderIconAndName=function(){return[t._getIcon(),i.span({className:"share-page-folder-row__folder-name u-l-ib u-l-ib--m",key:"folder-row-name"},t.props.metadata.name)]},t._getIcon=function(){return f(u.FolderIconFromMetadata,{className:"u-l-ib u-l-ib--m u-mar-right-xs mu-mar-right-2x",metadata:t.props.metadata,group:"web",showUnmountedAsDisabled:!1})},t._renderMountedFolderActions=function(){var e,r=[];return _(null!=t.props.metadata.permissions?t.props.metadata.permissions.change_options:void 0,function(e){return e.allow})&&r.push(f(l.BubbleMenuItem,{key:"folder-settings",onClick:t._bindHandler(t.props.onFolderSettingsClick),disabled:!t.props.isTeamPolicyLoaded},i.span({className:"u-font-black"},g("Folder settings")))),_(null!=t.props.metadata.permissions?t.props.metadata.permissions.unmount:void 0,function(e){return e.allow})&&r.push(f(l.BubbleMenuItem,{key:"unmount",onClick:t._bindHandler(t.props.onUnmountClick)},i.span({className:"u-font-error"},g("Remove from Dropbox")))),t.props.isMaestroDesign?(e=null,r.unshift(f(l.BubbleMenuItem,{key:"share",onClick:t._bindHandler(t.props.onShareClick)},i.span({className:"u-font-black"},g("Share"))))):e={disabled:null!=t.props.pendingState,label:g("Share"),onClick:t._bindHandler(t.props.onShareClick)},f(p.RowActions,{importance:"tertiary",mainAction:e,overflowActions:r,rowIsHovered:t.state.isHovered})},t.getOqa=function(){var e="";return t.props.expSubgrowthProSharePageUpdates&&t.props.expSubgrowthProSharePageUpdates.quotaType&&("reader"===t.props.metadata.access_type?e="oq"===t.props.expSubgrowthProSharePageUpdates.quotaType?"wb_oq_share_ro":"wb_nq_share_ro":"writer"===t.props.metadata.access_type&&(e="oq"===t.props.expSubgrowthProSharePageUpdates.quotaType?"wb_oq_share_w":"wb_nq_share_w")),e?"?oqa="+e:""},t._renderUnmountedFolderActions=function(){var e=t.props.metadata.can_mount,r=t.props.expSubgrowthProSharePageUpdates&&t.props.expSubgrowthProSharePageUpdates.variant&&"V1"===t.props.expSubgrowthProSharePageUpdates.variant,a=[],o={disabled:null!=t.props.pendingState,label:g("Add",{comment:'As in "Add to Dropbox"'}),onClick:t._bindHandler(t.props.onMountClick)};if(r&&!e&&"owner"!==t.props.metadata.access_type){var n=t.getOqa(),s="/low-space-sharing"+n;"V1"===t.props.expGrowthBBizWebGrouper&&(s="/business/pricing"),"V1"===t.props.expGrowthBIndWebGrouper&&(s="/buy"),o={disabled:null!=t.props.pendingState,label:g("Get more space"),onClick:function(){return m.redirect(s)}}}return _(null!=t.props.metadata.permissions?t.props.metadata.permissions.edit_contents:void 0,function(e){return e.allow})||a.push(f(l.BubbleMenuItem,{key:"view-folder",onClick:t._bindHandler(t.props.onViewFolderClick)},i.span({className:"u-font-black"},g("View folder")))),_(null!=t.props.metadata.permissions?t.props.metadata.permissions.relinquish_membership:void 0,function(e){return e.allow})&&a.push(f(l.BubbleMenuItem,{key:"relinquish-membership",onClick:t._bindHandler(t.props.onRelinquishMembershipClick)},i.span({className:"u-font-black"},g("Remove")))),_(null!=t.props.metadata.permissions?t.props.metadata.permissions.unshare:void 0,function(e){return e.allow})&&a.push(f(l.BubbleMenuItem,{key:"unshare-folder",onClick:t._bindHandler(t.props.onUnshareClick)},i.span({className:"u-font-error"},g("Unshare folder")))),f(p.RowActions,{disabled:null!=t.props.pendingState,importance:"secondary",mainAction:o,overflowActions:a,rowIsHovered:t.state.isHovered})},t._bindHandler=function(e){return null!=e?e.bind(t,t.props.metadata):null},t}return r.__extends(t,e),t.prototype.render=function(){var e=this,t=null!=this.props.metadata.path_lower,r=this.props.metadata.time_invited,o=this.props.metadata.folder_size,l=this.props.metadata.can_mount,d=this.props.expSubgrowthProSharePageUpdates&&this.props.expSubgrowthProSharePageUpdates.variant&&"V1"===this.props.expSubgrowthProSharePageUpdates.variant;return d&&!o&&(o=0),i.li({className:a.default("share-page-folder-row","share-page-folder-row--invitation",this.props.isMaestroDesign?[d?void 0:"mu-lh-8x",d?"share-folder-row--subgrowth_pro_share_page_updates":"mu-height-8x",d?void 0:"mu-pad-horizontal-2x"]:"u-pad-vertical-xs"),key:"shared-folder-"+this.props.metadata.shared_folder_id,role:"row",title:this.props.metadata.name,onMouseEnter:this._handleMouseEnter,onMouseLeave:this._handleMouseLeave},i.div({className:a.default("filename-col u-l-ib u-l-ib--m",d?"filename-col--subgrowth_pro_share_page_updates":void 0,this.props.isMaestroDesign?"filename-col--pagelet":void 0),role:"rowheader"},t?i.a({className:"u-l-b mu-height-8x",href:n.browse_uri_for_fq_path(this.props.user,this.props.metadata.path_lower).toString(),onClick:function(){return e.props.logClickFolder(e.props.metadata)},target:"_blank"},this._renderIconAndName()):this._renderIconAndName()),d&&i.div({className:a.default("size-col",this.props.isMaestroDesign?"size-col--pagelet":void 0,"u-l-ib","u-l-ib--m","u-font-meta"),role:"gridcell",title:h.format_bytes(o,0)},i.div({className:l?"size-col__text":"size-col__text--warning"},h.format_bytes(o,0)),!l&&i.div({className:a.default("not-enough-space")},g("Not enough space to access folder"))),i.div({className:a.default("time-invited-col",d?"time-invited-col--subgrowth_pro_share_page_updates":void 0,this.props.isMaestroDesign?"time-invited-col--pagelet":void 0,"u-l-ib","u-l-ib--m","u-font-meta"),role:"gridcell",title:s.ago(r)},s.format_date(r,s.localized_datetime_format)),i.div({className:a.default("actions-col u-l-ib u-l-ib--m u-font-right",d?"actions-col--subgrowth_pro_share_page_updates":void 0,this.props.isMaestroDesign?"actions-col--pagelet":void 0),role:"gridcell"},t?this._renderMountedFolderActions():this._renderUnmountedFolderActions()))},t.displayName="FolderRow",t.defaultProps={logClickFolder:function(){return!0}},t})(o.default.Component);t.FolderRow=d.requireCssWithComponent(S,["/static/css/sharing/share_page-vfl48Vdji.css","/static/css/scooter/scooter-scoped-vflWuydQl.css"])}),define("modules/clean/sharing/share_page/views/folders_tab",["require","exports","tslib","react","external/react-dom-factories","modules/clean/sharing/share_page/types","modules/clean/sharing/share_page/util","modules/clean/sharing/share_page/views/folder_listing","modules/clean/sharing/share_page/views/tab_states","modules/core/i18n"],function(e,t,r,a,o,i,n,s,l,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=r.__importDefault(a),o=r.__importStar(o),d=r.__importStar(d);var u=a.default.createElement,p=d.i18n_default_project("sharing")._,c=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._renderListing=function(){if(0===t.props.listing.listingEntries.count())return null;var e=n.groupEntriesByMounted(t.props.listing.listingEntries);return e.has(!1)&&0!==e.get(!1).count()?o.div({},e.has(!1)?u(s.FolderListing,{entries:e.get(!1),entryPendingStates:t.props.listing.entryPendingStates,folderRowActions:t.props.folderRowActions,isMaestroDesign:!0,maxInitialDisplay:void 0,label:p("Folders you can add to your Dropbox"),user:t.props.user,expSubgrowthProSharePageUpdates:t.props.expSubgrowthProSharePageUpdates,expGrowthBBizWebGrouper:t.props.expGrowthBBizWebGrouper,expGrowthBIndWebGrouper:t.props.expGrowthBIndWebGrouper}):void 0,void 0):null},t}return r.__extends(t,e),t.prototype.render=function(){return o.div({},u(l.PageTab,{className:"share-page-folders-tab",header:void 0,listingState:this.props.listing.state,onEmailWantToVerify:this.props.onEmailWantToVerify,user:this.props.user,tabType:i.SharePageTab.FOLDER},this._renderListing()))},t.displayName="FoldersTab",t})(a.default.Component);t.FoldersTab=c}),define("modules/clean/sharing/share_page/views/share_column_header",["require","exports","tslib","external/classnames","react","spectrum/icon_form","spectrum/popover","modules/core/i18n"],function(e,t,r,a,o,i,n,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=r.__importDefault(a),o=r.__importDefault(o),s=r.__importStar(s);var l;(function(e){e[e.ASCENDING=0]="ASCENDING",e[e.DESCENDING=1]="DESCENDING"})(l=t.SortDirection||(t.SortDirection={}));var d=s.i18n_default_project("sharing")._,u=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.render=function(){return o.default.createElement(n.Popover,{className:this.props.headerClassName,onSelection:this.props.onSelection},o.default.createElement(n.PopoverTrigger,{className:a.default({"column-header-menu-trigger-active":this.props.sortField===this.props.activeSortField}),title:this.props.label},o.default.createElement("span",null,this.props.label),this.props.showSort&&o.default.createElement("span",{className:"column-header-menu-label-icon-wrapper"},o.default.createElement(i.IconForm,{name:this.computeSortIcon()}))),this.props.showSort&&o.default.createElement(n.PopoverContent,null,o.default.createElement(n.PopoverItemGroup,null,o.default.createElement(n.PopoverItemGroupTitle,null,d("Order")),o.default.createElement(n.PopoverSelectableItem,{selected:this.isSortingByThisColumn(l.ASCENDING),value:{newSortDirection:l.ASCENDING,newSortField:this.props.sortField}},d("Ascending")),o.default.createElement(n.PopoverSelectableItem,{selected:this.isSortingByThisColumn(l.DESCENDING),value:{newSortDirection:l.DESCENDING,newSortField:this.props.sortField}},d("Descending")))))},t.prototype.isSortingByThisColumn=function(e){return this.props.sortField===this.props.activeSortField&&e===this.props.activeSortDirection},t.prototype.computeSortIcon=function(){return this.isSortingByThisColumn(l.ASCENDING)?"sort-arrow-up":this.isSortingByThisColumn(l.DESCENDING)?"sort-arrow-down":"caret-down"},t.defaultProps={showSort:!0},t})(o.default.Component);t.ShareColumnHeader=u}),define("modules/clean/sharing/share_page/views/share_page",["require","exports","tslib","react","external/classnames","modules/clean/web_timing_logger","modules/clean/pagelet_logger","modules/clean/react/app_actions_view","modules/clean/react/css","modules/clean/react/async/loadable","modules/clean/react/maestro/header","modules/clean/react/maestro/layout","modules/clean/react/maestro/tab_nav","modules/clean/react/tabs/tab_util","modules/clean/sharing/share_page/types","modules/clean/sharing/share_page/views/files_tab","modules/clean/sharing/share_page/views/folders_tab","modules/core/i18n"],function(e,t,r,a,o,i,n,s,l,d,u,p,c,h,m,_,f,g){"use strict";var S=this;Object.defineProperty(t,"__esModule",{value:!0}),a=r.__importDefault(a),o=r.__importDefault(o),i=r.__importStar(i),g=r.__importStar(g);var E=g.i18n_default_project("sharing")._,y=d.Loadable({loader:function(){return r.__awaiter(S,void 0,void 0,function(){var t;return r.__generator(this,function(a){switch(a.label){case 0:return[4,new Promise(function(t,r){e(["modules/clean/sharing/share_page/views/links_tab"],t,r)}).then(r.__importStar)];case 1:return t=a.sent().LinksTab,[2,t]}})})}}),b=(function(t){function l(o){var i=t.call(this,o)||this;return i._createSharedFolderHandler=function(){"V1"===i.state.expSubgrowthProOQNewFolder?new Promise(function(t,r){e(["modules/clean/growth/experiments/overquota_helper"],t,r)}).then(r.__importStar).then(function(e){e.OverquotaHelper.showSubgrowthProOQNewFolderModal({oqa:"wb_oq_ad_shfo_fi"})}):i.props.folderTabActions&&i.props.folderTabActions.onNewSharedFolderClick&&(i.props.folderTabActions.onNewSharedFolderClick.bind(i,i.props.user,null)(),"CONTROL"===i.state.expSubgrowthProOQNewFolder&&new Promise(function(t,r){e(["modules/clean/growth/experiments/overquota_helper"],t,r)}).then(r.__importStar).then(function(e){e.OverquotaHelper.logExposureSubgrowthProOQNewFolderModal("CONTROL")}))},i._renderActionMenu=function(){return a.default.createElement(s.AppActionsView,{primaryMenuItems:[{displayName:E("Create shared folder"),handleClick:i._createSharedFolderHandler}]})},i._handleTabSelect=function(e){return i.props.onChangeTab(e)},i.pageletLogger=new n.PageletLogger("sharing",["SharePage"]),i.state={expSubgrowthProOQNewFolder:"OFF"},i}return r.__extends(l,t),l.prototype.checkTTI=function(){if(this.props.viewingTab!==m.SharePageTab.LINK)return i.mark_time_to_view(),"finished"===this.props.listing.state||0!==this.props.listing.listingEntries.count()?this.pageletLogger.componentReady(l.displayName):void 0},l.prototype.componentDidMount=function(){var t=this;return new Promise(function(t,r){e(["modules/clean/growth/experiments/overquota_helper"],t,r)}).then(r.__importStar).then(function(e){var r=e.OverquotaHelper;r.getVariantSubgrowthProOQNewFolder().then(function(e){t.setState({expSubgrowthProOQNewFolder:e.toString()})}),r.maybeShowSubgrowthProOQRecurringModal("wb_oq_ups_recur_fb")}),this.checkTTI()},l.prototype.componentDidUpdate=function(){return this.checkTTI()},l.prototype.render=function(){var e=this.props,t=e.user,r=e.isMaestroDesign,o=e.searchBarExperiments;return r?a.default.createElement(p.MaestroChrome,{user:t,titleRegion:a.default.createElement(u.MaestroHeaderTitle,null,E("Sharing")),embeddedAppRegion:this._renderBody(),actionSidebarRegion:this._renderActionMenu(),searchBarProps:{searchBarExperiments:o}}):a.default.createElement("div",{className:"share-page"},a.default.createElement("main",null,this._renderBody()))},l.prototype._renderBody=function(){var e=[{value:m.SharePageTab.FOLDER,label:E("Folders")},{value:m.SharePageTab.FILE,label:E("Files")}];this.props.isMaestroDesign&&e.push({value:m.SharePageTab.LINK,label:E("Links")});var t;switch(this.props.viewingTab){case m.SharePageTab.FOLDER:t=0;break;case m.SharePageTab.FILE:t=1;break;case m.SharePageTab.LINK:t=2;break;default:t=0}return a.default.createElement(c.TabNav,{className:o.default({"share-page-view":!0,"maestro-pagelet-tab-nav":this.props.isMaestroDesign}),defaultSelectedIndex:t,onChange:this._handleTabSelect,tabs:e,variant:h.TabVariant.UNDERLINE},this._renderTab())},l.prototype._renderTab=function(){switch(this.props.viewingTab){case m.SharePageTab.FOLDER:return a.default.createElement(f.FoldersTab,r.__assign({folderRowActions:this.props.folderRowActions,listing:this.props.listing,user:this.props.user,isTeamPolicyLoaded:this.props.isTeamPolicyLoaded,expSubgrowthProSharePageUpdates:this.props.expSubgrowthProSharePageUpdates,expGrowthBBizWebGrouper:this.props.expGrowthBBizWebGrouper,expGrowthBIndWebGrouper:this.props.expGrowthBIndWebGrouper},this.props.folderTabActions));case m.SharePageTab.FILE:return a.default.createElement(_.FilesTab,r.__assign({fileRowActions:this.props.fileRowActions,listing:this.props.listing,user:this.props.user},this.props.fileTabActions));case m.SharePageTab.LINK:return a.default.createElement(y,r.__assign({user:this.props.user},this.props.linkTabActions));default:return}},l.displayName="SharePage",l.defaultProps={fileTabActions:{},folderTabActions:{},inviteCount:0,isTeamPolicyLoaded:!1,linkTabActions:{}},l})(a.default.Component);t.SharePage=l.requireCssWithComponent(b,["/static/css/scooter/scooter-scoped-vflWuydQl.css","/static/css/sharing/maestro-components-vflPs63AA.css","/static/css/sharing/maestro-layout-vflvEmc2B.css","/static/css/sharing/share_page-vfl48Vdji.css"],[s.AppActionsView,_.FilesTab,f.FoldersTab,c.TabNav])}),define("modules/clean/sharing/share_page/views/shared_file_icon",["require","exports","tslib","react","spectrum/file_icon"],function(e,t,r,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=r.__importDefault(a);var i=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.render=function(){return a.default.createElement(o.FileIcon,{path:this.props.sharedFileMetadata.name,"aria-label":this.props.sharedFileMetadata.name,role:"img",className:this.props.className})},t})(a.default.Component);t.SharedFileIcon=i});
//# sourceMappingURL=pkg-file_uploader_and_sharing.min.js-vflpuuehC.map