define(["require","exports","tslib","react","modules/clean/photos/thumbnail_url_util","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/full_screen_helpers","modules/clean/react/previews/image_helpers","modules/clean/react/previews/preview_zoom_container","modules/core/i18n","modules/core/notify","file-viewer/preview_image","file-viewer/preview_image/img_layer"],function(e,t,o,i,n,r,l,a,s,c,u,p,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=o.__importDefault(i),a=o.__importStar(a);var m=[function(e){return i.default.createElement(d.ImageLayer,o.__assign({},e,{css:{smallImg:e.css.smallImg,loader:e.css.loader,fullSizeImg:e.css.fullSizeImg}}))}],v=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={minScaleFactor:0,scaleFactor:0,windowWidth:0,windowHeight:0,dragDisabled:!0},t.onWindowResize=function(){t.setState({windowWidth:window.innerWidth,windowHeight:window.innerHeight})},t.onFullResolutionImageLoaded=function(){t.logFilePreviewEvent(r.EventType.FilePreviewDownloadSucceeded),t.logFilePreviewEvent(r.EventType.FilePreviewRenderSucceeded),t.props.setRenderStatusSuccess()},t.onFullResolutionImageError=function(){t.logFilePreviewEvent(r.EventType.FilePreviewDownloadFailed),t.props.onError&&t.props.onError()},t.viewActualSize=function(){t.setState({scaleFactor:1})},t.zoomIn=function(){t.zoomWithMultiplier(1.25)},t.zoomOut=function(){t.zoomWithMultiplier(.8)},t.onImageDoubleClick=function(e){var o=t.state,i=o.scaleFactor,n=o.minScaleFactor;t.setState({scaleFactor:i===n?1:n})},t.handleMinScaleFactorChange=function(e){t.setState({minScaleFactor:e,scaleFactor:t.state.scaleFactor||e})},t}return o.__extends(t,e),t.prototype.componentDidMount=function(){this.logFilePreviewEvent(r.EventType.FilePreviewSupportConfirmed),this.logFilePreviewEvent(r.EventType.FilePreviewDownloadAttempted),u.Notify.info(c._("Press esc to exit fullscreen"),3),window.addEventListener("resize",this.onWindowResize),this.onWindowResize()},t.prototype.componentWillReceiveProps=function(e){if(e.thumbnailUrlTmpl!==this.props.thumbnailUrlTmpl){var t=e.filePreviewSession;this.logFilePreviewEvent(r.EventType.FilePreviewSupportConfirmed,t),this.logFilePreviewEvent(r.EventType.FilePreviewDownloadAttempted,t),this.setState({scaleFactor:0,minScaleFactor:0})}},t.prototype.componentWillUnmount=function(){window.removeEventListener("resize",this.onWindowResize),u.Notify.clear()},t.prototype.logFilePreviewEvent=function(e,t){void 0===t&&(t=this.props.filePreviewSession),t&&t.recordEvent(e)},t.prototype.zoomWithMultiplier=function(e){var t=this.state,o=t.scaleFactor,i=t.minScaleFactor;if(1!==e&&o){var n=.5*Math.round(o*e/.5);Math.abs(n-o)<.5&&(n+=e>1?.5:-.5),this.setState({scaleFactor:Math.min(Math.max(n,i||0),16)})}},t.prototype.render=function(){var e=this.props.thumbnailUrlTmpl,t=this.state,o=t.scaleFactor,r=t.minScaleFactor,c=t.windowWidth,u=t.windowHeight;return i.default.createElement(s.PreviewZoomContainer,{fileCount:this.props.fileCount,fileIndex:this.props.fileIndex,renderZoomControls:!0,onClose:l.exitFullScreen,onFlipNext:this.props.onFlipNext,onFlipPrevious:this.props.onFlipPrevious,onZoomOut:this.zoomOut,onZoomIn:this.zoomIn,onViewActualSize:this.viewActualSize,zoomInDisabled:16===o,zoomOutDisabled:o===r,dragDisabled:this.state.dragDisabled,scaleFactor:o},i.default.createElement(p.PreviewImage,{scaleFactor:o,imgProps:{src:a.getFallbackSrc(e),srcSet:a.getSrcSet(e),sizes:a.IMG_SIZES_ATTR,alt:this.props.fileName,fullSizeSrc:n.fullSizeUrl(e),onFullSizeImgLoad:this.onFullResolutionImageLoaded,onError:this.onFullResolutionImageError,onContextMenu:this.props.onContextMenu,onDoubleClick:this.onImageDoubleClick},viewportProps:{width:c,height:u},onMinScaleFactorChanged:this.handleMinScaleFactorChange,layers:m}))},t})(i.default.Component);t.PreviewImageZoom=v});
//# sourceMappingURL=preview_image_zoom.min.js-vflRuKVN9.map