define(["require","exports","tslib","external/lodash","modules/clean/annotations/annotation","modules/clean/react/previews/pdf_viewer/utils","modules/clean/comments/constants","modules/clean/react/comments2/position_utils"],function(t,e,n,o,i,r,a,s){"use strict";function u(t){switch(t){case a.AnnotationTypes.HIGHLIGHT:return"highlight";case a.AnnotationTypes.REGION:return"rectangle";case a.AnnotationTypes.MARKER:return"other";default:throw new Error("Unknown annotation type: "+t)}}function c(t){function e(t,e){var n=t+e;if(t>=0&&n<=1)return[t,e];if(n=Math.min(n,1),t<=0)t=0,e=n;else for(e=n-t;t+e>1;)e-=1e-4;return[t,e]}var n=t.page,o=t.x,i=t.y,r=t.width,a=t.height;return s=e(o,r),o=s[0],r=s[1],u=e(i,a),i=u[0],a=u[1],{page:n,x:o,y:i,width:r,height:a};var s,u}function p(t){var e=t.coordinates,n=e[0],o=n.x,i=n.y;return c({page:1,x:o,y:i,width:e[2].x-o,height:e[2].y-i})}function g(t){var e=t.page,n=t.page_size,i=t.coordinates,r=n.width,a=n.height,s=i.map(function(t){return a-t.y}),u=o.map(i,"x"),p=o.min(u)||0,g=o.min(s)||0;return c({page:e,x:p/r,y:g/a,width:((o.max(u)||0)-p)/r,height:((o.max(s)||0)-g)/a})}function h(t){var e=t.pdf_coordinates,n=t.image_coordinates;if(e)return{type:"document",regionType:u(t.type),regions:e.map(g)};if(t.image_coordinates)return{type:"image",region:p(n[0])};throw new Error("annotation must be for a pdf/image")}function m(t){switch(t){case"highlight":return{type:a.AnnotationTypes.HIGHLIGHT,subtype:a.AnnotationSubtypes.HIGHLIGHT.HIGHLIGHT};case"rectangle":return{type:a.AnnotationTypes.REGION,subtype:a.AnnotationSubtypes.REGION.RECTANGLE};default:throw new Error("Unknown annotation type: "+t)}}function d(t,e,n,i){return o.range(4).map(function(o){return{x:e+(o%3?n:0),y:t-(o>1?i:0)}})}function y(t,e){function n(t){var e=g[t.page-1],n=e[0],o=e[1],i=n*t.width,r=o*t.height,s=o*(1-t.y),c=n*t.x,p=d(s,c,i,r);return u===a.AnnotationTypes.HIGHLIGHT&&(p=p.filter(function(t,e){return e%2===0})),{page:t.page,coordinates:p,page_size:{width:n,height:o}}}var o="document"===t.type?t.regionType:"rectangle",s=m(o),u=s.type,c=s.subtype,p=new i.Annotation(u,c),g=r.expandDimensions(e.dimensions);switch(t.type){case"document":p.pdf_coordinates=t.regions.map(n);break;case"image":p.image_coordinates=[n(t.region)]}return p}function f(t){var e=new i.Annotation(a.AnnotationTypes.REGION,a.AnnotationSubtypes.REGION.RECTANGLE),n=t.region,o=n.x,r=n.y,s=n.width,u=n.height,c=o+s,p=r+u;return e.image_coordinates=[{coordinates:[{x:o,y:r},{x:o,y:p},{x:c,y:p},{x:c,y:r}]}],e}function l(t,e){var n="document"===t.type?t.regions:[t.region],o=n.map(function(t){var n=t.height*e.height,o=t.width*e.width,i=e.top+t.y*e.height,r=e.left+t.x*e.width;return{top:i,left:r,bottom:i+n,right:r+o}});return s.getBoundingClientRectOfRects(o)}Object.defineProperty(e,"__esModule",{value:!0}),o=n.__importStar(o),e.fromFileViewToComments2Annotation=h,e.fromComments2ToPdfFileViewAnnotations=y,e.fromComments2ToImageFileViewAnnotations=f,e.convertFromComments2ToClientRect=l});
//# sourceMappingURL=convert_annotation_coordinates.min.js-vflXYSaiq.map